(function(a){jQuery.fn.imgButton=function(c,b,d,e){return this.each(function(){var f=jQuery(this);f.css("border-width","0");f.css("margin","0");f.css("padding","0");var g=a("<img/>");g.attr({src:c,width:d,height:e});g.addClass("lacertaImgButton");g.prependTo(f);f.hover(function(){a("> img",this).attr({src:b})},function(){a("> img",this).attr({src:c})})})}})(jQuery);jQuery.lacerta={allStepCount:0,getAllStepCount:function(){return this.allStepCount},loader:{readXML:function(a){a=document.getElementById(a);if(null==a||void 0==a)return!1;a=a.text||a.textContent;window.DOMParser?(parser=new DOMParser,xmlDoc=parser.parseFromString(a,"text/xml")):(xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.async="false",xmlDoc.loadXML(a));return xmlDoc},loadLabXML:function(a){(a=this.readXML(a))?this.loadLabwork(a):alert("Отсутсвует разметка контейнера labwork")},stepsCounted:0,
loadLabwork:function(a){var c=1;if(!a)return alert("Файл не является правильным XML файлом."),!1;var b={domXml:a,targetSection:"commonBG"},d=$(a).find("step").length;jQuery.lacerta.allStepCount=d;$.lacerta.design.composeNode(b);var b=$(a).find("settings scoring"),e={};e.showResultTab=b.attr("showResultTab")||"true";e.completion_threshold=parseFloat(b.attr("completion_threshold")||1);if(1<e.completion_threshold||0>e.completion_threshold)e.completion_threshold=1;e.scaled_passing_score=parseFloat(b.attr("scaled_passing_score")||
0.65);e.attempt_degression_score=parseFloat(b.attr("attempt_degression_score")||1);if(1<e.attempt_degression_score||0>e.attempt_degression_score)e.attempt_degression_score=1;e.score_min=parseFloat(b.attr("score_min")||0);e.score_max=parseFloat(b.attr("score_max")||100);e.scoring_rule=b.attr("scoring_rule")||"last";$.lacerta.calculation.setScoringParam(e,d);$(a).find("step").each(function(){var a=$(this),b=!0,d=null,h=1,m=a.attr("type")||null,l=a.attr("short_name")||"";a.attr("scoring")&&"false"==
a.attr("scoring").toLowerCase()&&(b=!1);h=parseFloat(a.attr("weight"));if(isNaN(h))h=1;else if(1<h||0>h)h=1;var d=a.attr("id"),n=parseFloat(a.attr("scaled_passing_score")||e.scaled_passing_score);d?(a={},a.type=m,a.index=c-1,a.stepName="Шаг "+c,d&&(a.id=d),a.weight=h,l&&(a.short_name=l),a.scoring=b,a.scaled_passing_score=n,(b=jQuery.lacerta.loader.readXML(a.id))?($.lacerta.loader.getNameFromStep(b,a),c++):alert("Отсутсвует разметка контейнера step id = "+a.id)):alert('Идентификатор сцены <step id="step_N"/> - обязательный элемент разметки')})},
getNameFromStep:function(a,c){c.dom=a;var b=$(a).find("settings sound");b.is("[allowMultiple=true]")?c.multipleSound=!0:b.is("[allowMultiple=false]")?c.multipleSound=!1:c.multipleSound=null;$.lacerta.navigation.putStep(c)}}};jQuery.lacerta.utils={replaceString:function(a,c,b,d){for(d="";;){var e=a.indexOf(c);if(0<=e)d=d+a.substr(0,e)+b,a=a.substr(e+c.length);else break}return d+a},replaceString2:function(a,c,b,d){result=new String(a);return result=result.replace(c,b)},rtrim:function(a){return a.replace(/\s+$/,"")},getOne:function(a,c){for(var b=-1,d=0;d<c.length;d++)if(c[d]==a){b=d;break}return b},permutateArray:function(a,c){var b=[],d=[];if(a instanceof Array){var e=!1,f=0;if(!c||void 0==c||c>a.length)c=a.length;for(var g=
0;g<c;g++)for(e=!1;!e;)f=Math.round(Math.random()*c),void 0!=f&&f<c&&-1==this.getOne(f,b)&&(e=!0,b.push(f));for(g=0;g<b.length;g++)d.push(a[b[g]]);return d}log("ERROR: permutateArray: originalArray is not an instanceof Array.")},scrambleArray:function(a){if(a instanceof Array){var c=a.slice(0);log("originalArray[0] == "+a[0].right);log("coloneArray[0] == "+c[0].right);for(var b=0,d,e,f,g=a.length,k=!0;k;)e=Math.floor(Math.random()*g),f=Math.floor(Math.random()*g),d=a[e],a[e]=a[f],a[f]=d,b++,b>=2*
g&&this.testOverlap(c,a)&&(k=!1)}else log("ERROR: permutateArray: originalArray is not an instanceof Array.")},testOverlap:function(a,c){for(var b=a.length,d=0,e=0;e<b;e++)a[e]==c[e]&&d++;return d>=b-Math.floor(b/2)?!1:!0},setUnit:function(a){return isNaN(1*a)?a:1*a+0+"px"}};jQuery.lacerta.calculation={allStepCount:0,allStepsResultArray:[],currentStepId:"",currentStepResultObj:void 0,completion_status:"incomplete",progress_measure:0,success_status:"failed",objs_success_status_count:0,score_scaled:0,score_raw:0,completion_depends_on_success:!0,objectivesId:[],objectivesObjL:{},objectivesCount:0,summaryTime:0,showResultTab:"true",startTimeStamp:void 0,setScoringParam:function(a,c){this.objectivesCount=c;this.completion_threshold=a.completion_threshold;this.scaled_passing_score=
a.scaled_passing_score;this.attempt_degression_score=a.attempt_degression_score;this.score_min=a.score_min;this.score_max=a.score_max;this.scoring_rule=a.scoring_rule;this.showResultTab=a.showResultTab},prepareStepsForCalculation:function(a){jQuery.lacerta.scorm.updateGlobalParam(this,!0);for(var c=0;c<a.length;c++){var b=this.addObjectiveToObjList(a[c],c);this.objectivesId.push(b.id);this.objectivesObjL[b.id]=b;jQuery.lacerta.scorm.updateObjectiveParam(b)}},addObjectiveToObjList:function(a,c){return{n:c,
currentAttemptNum:0,id:a.id,type:a.type,weight:a.weight,short_name:a.short_name,completion_threshold:this.completion_threshold,completion_status:"not attempted",progress_measure:0,scaled_passing_score:a.scaled_passing_score,success_status:"failed",score_scaled:0,score_raw:0,score_min:this.score_min,score_max:this.score_max*a.weight,completion_depends_on_success:!0,attempt_degression_score:this.attempt_degression_score,stepStartTime:0,stepElapsedTime:0,stepSummaryTime:0,templatesIdList:[],templatesObjList:{},
templatesCount:0,maxSumTemplScore:0}},onCalculationForStep:function(a){this.currentStepId!=a&&(""!=this.currentStepId&&this.endCalculationForStep(this.currentStepId),this.currentStepId=a,a=this.objectivesObjL[a],a.stepStartTime=(new Date).getTime(),"not attempted"==a.completion_status&&(a.completion_status="incomplete",jQuery.lacerta.scorm.updateObjectiveCompletion_status(a.n,"incomplete")))},endCalculationForStep:function(a){var c=this.objectivesObjL[a];0==c.currentAttemptNum&&(this.update_progress_measure(a),
jQuery.lacerta.scorm.updateObjectiveParam(c),jQuery.lacerta.scorm.updateGlobalParam(this));c.stepElapsedTime=(new Date).getTime()-c.stepStartTime;c.stepSummaryTime+=c.stepElapsedTime},terminateCalculation:function(){""!=this.currentStepId&&(this.endCalculationForStep(this.currentStepId),this.currentStepId="")},enrol_template:function(a,c,b){b=b||1;if(""!=this.currentStepId){var d=this.objectivesObjL[this.currentStepId];-1==jQuery.lacerta.utils.getOne(a,d.templatesIdList)&&(d.templatesCount++,d.maxSumTemplScore+=
b,c={n:d.templatesCount,currentAttemptNum:0,id:a,templateName:c,name:"",short_name:"",score_scaled:0,weight:b},d.templatesIdList.push(a),d.templatesObjList[a]=c)}},update_template:function(a,c){var b=this.currentStepId;""!=b&&0==this.objectivesObjL[b].currentAttemptNum&&(this.objectivesObjL[b].templatesObjList[a].score_scaled=c,this.check_scoring())},update_progress_measure:function(a){a=this.objectivesObjL[a];0==a.progress_measure&&(0==a.templatesIdList.length&&(a.score_scaled=1,a.progress_measure=
1),this.check_scoring())},check_scoring:function(){for(var a=this.objectivesId.length,c=0,b=0,d=0,e=0,f=0,g=0;g<a;g++){var k=this.objectivesObjL[this.objectivesId[g]];if(0!=k.weight){var c=c+k.weight,b=b+k.weight*k.progress_measure,h=k.templatesCount,m=0;if(0<h){for(var l=0;l<h;l++){var n=k.templatesObjList[k.templatesIdList[l]];0!=k.maxSumTemplScore&&(m+=n.weight*n.score_scaled/k.maxSumTemplScore)}k.score_scaled=m}k.score_scaled>=k.scaled_passing_score*k.weight&&(k.success_status="passed",e++,k.completion_status=
"completed",k.progress_measure=1);"completed"==k.completion_status&&d++;f+=k.weight*k.score_scaled;k.score_raw=parseInt(k.score_scaled*(k.score_max-k.score_min))}}this.progress_measure=b/c;if(d>=a||this.progress_measure>=this.completion_threshold)this.completion_status="completed";this.score_scaled=f/c;if(e>=a||this.score_scaled>=this.scaled_passing_score)this.success_status="passed";this.score_raw=parseInt(this.score_scaled*(this.score_max-this.score_min))},getData:function(a){var c="no result";
switch(a){case "%Result%":c=this.getCurrentResult();break;case "%Duration%":c=this.getCurrentTime()}return c},getCurrentResult:function(){return 100*this.score_scaled+"%"},getCurrentTime:function(){void 0==this.startTimeStamp&&(this.startTimeStamp=jQuery.lacerta.timer.getCurrentTime());var a=jQuery.lacerta.timer.getCurrentTime().getTime()-this.startTimeStamp.getTime();return jQuery.lacerta.timer.translateSecondsToString(a)},passTemplateForCalculation:function(a){},get_obj_short_name:function(a){return this.objectivesObjL[this.objectivesId[a]].short_name},
get_obj_completion_status:function(a){return this.convert_completion_status(this.objectivesObjL[this.objectivesId[a]].completion_status)},get_obj_success_status:function(a){return this.convert_success_status(this.objectivesObjL[this.objectivesId[a]].success_status)},current_time:0,get_obj_result_time:function(a){a=this.objectivesId[a];var c=this.objectivesObjL[a],b=0;a==this.currentStepId?(this.current_time=(new Date).getTime()-c.stepStartTime,b=c.stepSummaryTime+this.current_time):b=c.stepSummaryTime;
return jQuery.lacerta.timer.translateSecondsToString(b)},get_obj_result_ball:function(a){return this.objectivesObjL[this.objectivesId[a]].score_raw.toFixed(2)},get_completion_status:function(){return this.convert_completion_status(this.completion_status)},get_success_status:function(){return this.convert_success_status(this.success_status)},get_result_time:function(a){return jQuery.lacerta.timer.translateSecondsToString(this.summaryTime+this.current_time)},get_result_ball:function(){return this.score_raw.toFixed(2)},
get_showResultTab:function(){return this.showResultTab},convert_completion_status:function(a){var c="";switch(a){case "not attempted":c="Не начато";break;case "incomplete":c="Не завершено";break;case "completed":c="Завершено"}return c},convert_success_status:function(a){var c="";switch(a){case "failed":c="Не усвоенo";break;case "passed":c="Усвоенo"}return c},getStepScore:function(){var a=this.currentStepId;return""!=a?this.objectivesObjL[a].score_raw.toFixed(2):0},getScore:function(){return this.score_raw.toFixed(2)},
runAction:function(){jQuery.lacerta.actions.searchEvent("currentStep","currentStep","onCheckStepScore","")}};/*

 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 tester.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.tester={testersObjL:[],programmers:[{name:"Sergey",surname:"Kondrashov"}],purgeTester:function(){this.testersObjL=[]},parseTester:function(a){var c=$(a).attr("id"),b=$(a).attr("delay"),b=parseInt(void 0!=b&&""!=b?b:"50"),d=$("actions",a).find("action");this.testersObjL[c]={id:c,delay:b,actionL:d,testL:[],childsCount:0,childsChecked:0,trueCount:0,trueChecked:0,falseCount:0,falseChecked:0,timer:void 0,weight:1,score_withDegression:1,degression:0.8};a=$(a).children("scoring");b=$(a).attr("weight")||
$(a).attr("weigth");b=parseFloat(b)||1;this.testersObjL[c].weight=b;a=parseFloat($(a).attr("degression"))||-1;0<=a&&1>=a&&(this.testersObjL[c].degression=a)},initTest:function(a,c,b,d,e){a=this.testersObjL[a];var f=d.attr("testResult");switch(f){case "true":case "1":case "":case void 0:f=1;break;case "false":case "0":f=0;break;default:f=parseFloat(f),f=isNaN(f)?1:f}a.childsCount++;0<f&&a.trueCount++;0==f&&a.falseCount++;a.testL[c]={elementId:c,elementClass:b,testDom:d,hintId:e,testResult:f,checked:0};
jQuery.lacerta.calculation.enrol_template(a.id+"_"+c,"tester",a.weight)},checkTest:function(a){var c=this,b=this.testersObjL[a.testerId],d=b.testL[a.elementId];if(0==d.checked&&(1==a.lastStateCheck?(d.checked=1,b.childsChecked++):b.score_withDegression*=b.degression,jQuery.lacerta.calculation.update_template(b.id+"_"+a.elementId,b.childsChecked/b.childsCount*b.score_withDegression),b.childsCount==b.childsChecked)){var e=b.actionL;b.timer=setTimeout(function(){c.startActions(e,a.testerId)},b.delay)}},
startActions:function(a,c,b){b=this.testersObjL[c];for(var d=a.length,e=0;e<d;e++){var f=$(a[e]).attr("event");if("allHintsChecked"==f||"allInputsChecked"==f||"allObjectsChecked"==f){$.lacerta.actions.searchEvInObjArray(c,f);break}}void 0!=b.timer&&clearTimeout(b.timer)}};/*
 
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 shifter.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.shifter={shiftersObjL:[],programmers:[{name:"Sergey",surname:"Kondrashov"}],purgeShifter:function(){shiftersObjL=[]},parseShifter:function(a){var c=$(a).attr("id");a=$("param",a);a=this.initShift(a);this.shiftersObjL[c]=a},initShift:function(a){var c="false"!=a.attr("xRandom")?!0:!1,b="false"!=a.attr("yRandom")?!0:!1,d=a.attr("type"),d="table"==d?d:"free",e="",f="",g=[],k=[],h="",m="",l="",n="";if("free"==d)g=a.attr("x").split(","),k=a.attr("y").split(",");else if("table"==d){m=parseInt(a.attr("columns"));
m=1<m?m:1;h=parseInt(a.attr("rows"));h=1<h?h:1;e=parseInt(a.attr("x"));e=isFinite(e)?e:0;f=parseInt(a.attr("y"));f=isFinite(f)?f:0;l=parseInt(a.attr("xOffset"));l=isFinite(l)?l:0;n=parseInt(a.attr("yOffset"));n=isFinite(n)?n:0;for(a=0;a<h;a++)k.push(f+a*n+"");for(f=0;f<m;f++)g.push(e+f*l+"")}e=[];m=[];c&&(e=1<g.length&&"table"==d?jQuery.lacerta.utils.permutateArray(g):g);b&&(m=1<k.length&&"table"==d?jQuery.lacerta.utils.permutateArray(k):k);if("free"==d){for(var p=[],l=0;l<g.length;l++)p[l]=l;p=c||
b?jQuery.lacerta.utils.permutateArray(p):p}return{type:d,xRandom:c,yRandom:b,xL:g,yL:k,xRandomL:e,yRandomL:m,objIdL:[],xIndex:0,yIndex:0,indexRandomL:p}},getPosition:function(a,c){var b=this.shiftersObjL[a];if(b){var d={x:"0",y:"0"};if("table"==b.type){var d=b.xRandom?b.xRandomL[b.xIndex]:b.xL[b.xIndex],e=b.yRandom?b.yRandomL[b.yIndex]:b.yL[b.yIndex];b.xIndex<b.xL.length?b.yIndex<b.yL.length-1&&1<b.yL.length?b.yIndex++:(b.yIndex=0,1<b.xL.length&&b.xIndex++):b.xIndex=0;d={x:d,y:e}}else b.xIndex<b.indexRandomL.length&&
(d=b.xL[b.indexRandomL[b.xIndex]],e=b.yL[b.indexRandomL[b.xIndex]],d={x:d,y:e},b.xIndex++),b.xIndex==b.indexRandomL.length&&(b.xIndex=0);return d}return!1}};/*
     (c) 2010 Gregor Schwab
 Usage Command Line: $(elem).Touchable() (@see Readme.md)
 @version 0.0.5
 @requires jQuery
*/
(function(a){function c(b,c){function e(b){h.logging&&("undefined"!==typeof console?console.log(b):a("body").append("<br /> * "+b))}function f(b){if(b.originalEvent&&"undefined"!==typeof b.originalEvent.touches){if(1!==b.originalEvent.touches.length&&2!==b.originalEvent.touches.length||h.isCurrentlyTouching)return!1;h.isCurrentlyTouching=!0;1==b.originalEvent.touches.length?(h.isOneFingerGesture=!0,h.startTouch.x=h.previousTouch.x=b.originalEvent.touches[0].clientX,h.startTouch.y=h.previousTouch.y=
b.originalEvent.touches[0].clientY):2==b.originalEvent.touches.length&&(h.isOneFingerGesture=!1,b.originalEvent.touches[0].clientY>b.originalEvent.touches[1].clientY?(h.startTouch.x=h.previousTouch.x=b.originalEvent.touches[0].clientX,h.startTouch.y=h.previousTouch.y=b.originalEvent.touches[0].clientY):(h.startTouch.x=h.previousTouch.x=h.touches[1].clientX,h.startTouch.y=h.previousTouch.y=h.touches[1].clientY))}else e("Touchable Touchstart touches length "+b.pageX+" "+b.pageY),h.startTouch.x=h.previousTouch.x=
b.pageX,h.startTouch.y=h.previousTouch.y=b.pageY,a(document).bind("mousemove",g),a(document).bind("mouseup",k);h.target=b.target;h.currentTarget=b.currentTarget;b=h.startTouch.x;var c=h.startTouch.y;h.hitTarget=document.elementFromPoint?document.elementFromPoint(b,c):"";h.longTapTimer=setTimeout(function(){e("Touchable longTap");a(h.elem).trigger("longTap",h)},1E3);a(h.elem).trigger("tap",h)}function g(b){if(b.originalEvent&&"undefined"!==typeof b.originalEvent.touches){e("Touchable Touchsmove touches length "+
b.originalEvent.touches.length);if(1!==b.originalEvent.touches.length&&2!==b.originalEvent.touches.length)return!1;1==b.originalEvent.touches.length||h.isOneFingerGesture?(h.currentTouch.x=b.originalEvent.touches[0].clientX,h.currentTouch.y=b.originalEvent.touches[0].clientY):2!=b.originalEvent.touches.length||h.isOneFingerGesture||(b.originalEvent.touches[0].clientY>b.originalEvent.touches[1].clientY?(h.currentTouch.x=b.originalEvent.touches[0].clientX,h.currentTouch.y=b.originalEvent.touches[0].clientY):
(h.currentTouch.x=b.originalEvent.touches[1].clientX,h.currentTouch.y=b.originalEvent.touches[1].clientY))}else b.preventDefault(),h.currentTouch.x=b.pageX,h.currentTouch.y=b.pageY;a(h.elem).removeClass("webkitAnimate");h.currentDelta.x=h.currentTouch.x-h.previousTouch.x;h.currentDelta.y=h.currentTouch.y-h.previousTouch.y;h.currentStartDelta.x=h.currentTouch.x-h.startTouch.x;h.currentStartDelta.y=h.currentTouch.y-h.startTouch.y;h.currentPosition.x+=h.currentDelta.x;h.currentPosition.y+=h.currentDelta.y;
h.previousTouch.x=h.currentTouch.x;h.previousTouch.y=h.currentTouch.y;h.target=b.target;h.currentTarget=b.currentTarget;b=h.currentTouch.x;var c=h.currentTouch.y;h.hitTarget=document.elementFromPoint?document.elementFromPoint(b,c):"";a(h.elem).trigger("touchablemove",h);h.longTapTimer&&clearTimeout(h.longTapTimer)}function k(b){if(b.originalEvent&&"undefined"!==typeof b.originalEvent.touches){if(0<b.originalEvent.targetTouches.length)return!1}else a(document).unbind("mousemove",g),a(document).unbind("mouseup",
k);h.isCurrentlyTouching=!1;h.longTapTimer&&clearTimeout(h.longTapTimer);e("Touchable Touchend self "+h.currentStartDelta.x);a(h.elem).trigger("touchableend",h)}this.logging=!1;this.elem=b;this.$elem=a(b);this.isOneFingerGesture=this.is_currentlyTouching=this.is_doubleTap=!1;this.startTouch={x:0,y:0};this.currentTouch={x:0,y:0};this.previousTouch={x:0,y:0};this.currentDelta={x:0,y:0};this.currentStartDelta={x:0,y:0};this.currentPosition={x:0,y:0};this.longTapTimer=this.doubleTapTimer=null;this.touchStartSupported=
!1;"undefined"!==typeof c.callBack&&(this.callBack=c.callBack);var h=this;"undefined"!==typeof c&&("undefined"!==typeof c.logging&&(this.logging=c.logging),"undefined"!==typeof c.preventClick&&(this.preventClick=c.preventClick));this.$elem.bind("touchstart",function(a){h.touchStartSupported=!0;f(a)});this.$elem.bind("mousedown",function(a){h.touchStartSupported||f(a);return!1});this.$elem.bind("touchmove",g);this.$elem.bind("touchend",k);this.preventClick&&this.$elem.bind("click",function(a){a.preventDefault()})}
a.fn.Touchable=function(a){return this.each(function(){return new c(this,a)})}})(jQuery);/*
 
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 tap.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.tap={tapEnabled:!1,loadedId:"screenshot",timer:null,tapObjL:{},tapIdL:[],purgeTap:function(){this.tapEnabled&&($("#"+this.loadedId).remove(),this.tapEnabled=!1,null!=this.timer&&(clearTimeout(this.timer),this.timer=null))},tap:function(a,c){var b=this.tapObjL[c];""!=b.testerId&&(b.lastStateCheck=1,jQuery.lacerta.tester.checkTest(b))},longTap:function(a,c){var b=this.tapObjL[c];!0==isTouchScreen&&!1==b.hintVisible&&b.hintEnabled&&(b.hintVisible=!0,this.showHint(a.startTouch.x,a.startTouch.y,
c))},touchablemove:function(a,c){var b=this.tapObjL[c];!0==b.hintVisible&&!0==isTouchScreen&&b.hintEnabled&&(_this.hideHint(c),b.hintVisible=!1)},touchableend:function(a,c){var b=this.tapObjL[c];!0==b.hintVisible&&!0==isTouchScreen&&b.hintEnabled&&(_this.hideHint(c),b.hintVisible=!1)},hover:function(a,c){},mLeave:function(a,c){},moveHint:function(a,c,b){var d=this.tapObjL[b];b=d.xOffset;var d=d.yOffset,e=$("#"+this.loadedId).css("width").slice(0,-2),e=0<parseInt(e)?parseInt(e):0,f=$("#"+this.loadedId).css("height").slice(0,
-2),f=0<parseInt(f)?parseInt(f):0;c<document.documentElement.clientHeight/2?$("#"+this.loadedId).css("top",c+40+d+"px"):$("#"+this.loadedId).css("top",c-f-45-d+"px");a<document.documentElement.clientWidth/2?$("#"+this.loadedId).css("left",a+15+b+"px"):$("#"+this.loadedId).css("left",a-30-e-b+"px")},hideHint:function(a){this.tapEnabled=!1;this.tapObjL[a].hintVisible=!1;$("#"+this.loadedId).fadeOut(1E3);$("#"+this.loadedId).remove()},showHint:function(a,c,b){this.tapEnabled=!0;var d=this.tapObjL[b],
e=d.hintOwner;links=$("#"+b);var f=d.text,g=d.rel,k=d.relId,h=d.triggerObject,m=d.style,l=d.hoverStyle,n=d.normalStyle,p=d._height,r=d._width,s=d.xOffset,q=d.yOffset,t=!1,w=!1;void 0!=f&&""!=f?t=!0:f="";void 0!=g&&""!=g&&(-1==g.search(/\.jpg|\.png|\.gif|\.jpeg/ig)?alert("Свойством атрибута <b>rel</b><br> может быть только адрес иллюстрации!!!"):w=!0);var u=void 0,y=void 0;w?y="<div id="+this.loadedId+"><img src='"+g+"' alt='url preview' />"+(""!=f?"<br/>"+f:"")+"</div>":t&&(y="<div id="+this.loadedId+
">"+f+"</div>");void 0!=y?u=$(y):void 0!=k&&""!=k&&(u=$("<div id="+this.loadedId+"></div>"),f=$("."+k).clone(),f.appendTo(u),f.show());void 0!=h&&""!=h&&("none"==$("."+h).css("display")?$("."+h).show():"block"==$("."+h).css("display")&&$("."+h).hide());if(void 0!=u){this.hintEnabled=!0;u.attr({hintOwner:e});u.addClass(d.styleDefault);if(void 0!=m&&""!=m)for(m=m.split(","),e=m.length,h=0;h<e;h++)u.addClass(m[h]);if(void 0!=l&&""!=l)for($("#"+b).attr({tempClass:l}),l=l.split(","),e=l.length,h=0;h<e;h++)$("#"+
b).addClass(l[h]);void 0!=n&&""!=n&&$("#"+b).attr({saveNormalClass:n});u.addClass(m);u.appendTo("body");$("#"+this.loadedId).hide();r?$("#"+this.loadedId).css("width",r+"px"):(r=$("#"+this.loadedId).css("width").slice(0,-2),r=0<parseInt(r)?parseInt(r):0);p?$("#"+this.loadedId).css("height",p+"px"):(p=$("#"+this.loadedId).css("height").slice(0,-2),p=0<parseInt(p)?parseInt(p):0);u.css("z-index",1100);c<document.documentElement.clientHeight/2?$("#"+this.loadedId).css("top",c+40+q+"px"):$("#"+this.loadedId).css("top",
c-p-45-q+"px");a<document.documentElement.clientWidth/2?$("#"+this.loadedId).css("left",a+15+s+"px"):$("#"+this.loadedId).css("left",a-30-r-s+"px")}d.hintVisible=!0},activateParser:function(a,c,b,d,e,f){var g=this;c={parentId:c,testerId:d,elementId:a,elementClass:e,thisClass:e,hintEvent:f,isTap:!1,isMouseenter:!1,hintEnabled:b.enabled,hintVisible:!1,lastStateCheck:0};b.enabled&&(c.hintOwner=b.owner,c.styleDefault=b.styleDefault,c.text=b.text,c.rel=b.rel,c.relId=b.relId,c.triggerObject=b.triggerObject,
c.style=void 0!=b.style&&""!=b.style?b.style:"",c.hoverStyle=void 0!=b.hoverStyle&&""!=b.hoverStyle?b.hoverStyle:"",c.normalStyle=void 0!=b.normalStyle&&""!=b.normalStyle?b.normalStyle:"",c._height=parseInt(void 0!=b.height&&""!=b.height?b.height:"20")*gScaleValue,c._width=parseInt(void 0!=b.width&&""!=b.width?b.width:"200")*gScaleValue,c.xOffset=parseInt(void 0!=b.xOffset&&""!=b.xOffset?b.xOffset:"0")*gScaleValue,c.yOffset=parseInt(void 0!=b.yOffset&&""!=b.yOffset?b.yOffset:"0")*gScaleValue,c.delay=
parseInt(void 0!=b.delay&&""!=b.delay?b.delay:"1000"));this.tapObjL[a]=c;this.tapIdL.push(a);$("#"+a).Touchable({preventClick:!0,logging:!1});$("#"+a).bind("tap",function(b,c){g.tap(c,a)});$("#"+a).bind("longTap",function(b,c){g.longTap(c,a)});$("#"+a).bind("touchablestart",function(b,c){g.touchablestart(c,a)});$("#"+a).bind("touchablemove",function(b,c){g.touchablemove(c,a)});$("#"+a).bind("touchableend",function(b,c){g.touchableend(c,a)});b.enabled&&($("#"+a).bind("mouseenter",function(b,c){g.tapObjL[a].isMouseenter=
!0;g.showHint(b.pageX,b.pageY,a);$("#"+a).bind("mousemove",function(b){g.moveHint(b.pageX,b.pageY,a)});g.timer=setTimeout(function(){!0==g.tapObjL[a].isMouseenter&&$("#"+g.loadedId).fadeIn()},g.tapObjL[a].delay)}),$("#"+a).bind("mouseleave",function(b){!0==g.tapObjL[a].isMouseenter&&(g.hideHint(a),clearTimeout(g.timer),g.tapObjL[a].isMouseenter=!1,$("#"+a).unbind("mousemove"))}))}};jQuery.lacerta.hint={hintEnabled:!1,loadedId:"screenshot",checkedLink:void 0,timer:null,pMargenTop:"",purgeHint:function(){this.hintEnabled&&($("#"+this.loadedId).remove(),this.hintEnabled=!1,null!=this.timer&&(clearTimeout(this.timer),this.timer=null))},setMargenTop:function(a){this.pMargenTop=a},removeHint:function(){this.hintEnabled&&this.hoverOff()},activatelinkParser:function(a,c,b,d,e,f){var g=this,k=0,h=0,m=void 0;if("html"==b.owner){var l=$("#"+a).find("a");$("#checkedLinkDefault")&&(g.checkedLink=
$("#checkedLinkDefault"))}else"image"==b.owner||"zone"==b.owner?l=$("#"+a):"area"==b.owner&&(l=$("#"+a));l.hover(function(a){!0!=isTouchScreen&&g.hoverOn(a)},function(){!0!=isTouchScreen&&g.hoverOff()});g.hoverOn=function(c){"block"==$("#"+g.loadedId).css("display")&&g.hoverOff();var l=b.owner,r=c.target,s=$(r).attr("href");if("html"==l){var q=$(r).attr("rel"),t=$(r).attr("relId"),w=$(r).attr("label"),u=b.style,y=$(r).attr("hintStyle"),u=void 0!=y&&""!=y?y:void 0!=u&&""!=u?u:"",y=b.height,x=$(r).attr("hintHeight"),
y=parseInt(void 0!=x&&""!=x?x:void 0!=y&&""!=y?y:"0"),x=b.width,A=$(r).attr("hintWidth"),x=parseInt(void 0!=A&&""!=A?A:void 0!=x&&""!=x?x:"0"),A=b.xOffset,v=$(r).attr("xHintOffset");k=parseInt(void 0!=v&&""!=v?v:void 0!=A&&""!=A?A:"0");A=b.yOffset;r=$(r).attr("yHintOffset");h=parseInt(void 0!=r&&""!=r?r:void 0!=A&&""!=A?A:"0");A=b.delay}else if("image"==l||"zone"==l||"area"==l){w=b.text;q=b.rel;t=b.relId;m=b.triggerObject;var u=void 0!=b.style&&""!=b.style?b.style:"",z=void 0!=b.hoverStyle&&""!=b.hoverStyle?
b.hoverStyle:"",B=void 0!=b.normalStyle&&""!=b.normalStyle?b.normalStyle:"",y=parseInt(void 0!=b.height&&""!=b.height?b.height:"0"),y=y*gScaleValue,x=parseInt(void 0!=b.width&&""!=b.width?b.width:"0"),x=x*gScaleValue;k=parseInt(void 0!=b.xOffset&&""!=b.xOffset?b.xOffset:"0");k*=gScaleValue;h=parseInt(void 0!=b.yOffset&&""!=b.yOffset?b.yOffset:"0");h*=gScaleValue;A=b.delay}var E=v=!1;void 0!=w&&""!=w?v=!0:w="";void 0!=q&&""!=q&&(-1==q.search(/\.jpg|\.png|\.gif|\.jpeg/ig)?alert("Свойством атрибута <b>rel</b><br> может быть только адрес иллюстрации!!!"):
E=!0);var C=r=void 0;E?C="<div id="+g.loadedId+"><img src='"+q+"' alt='url preview' />"+(""!=w?"<br/>"+w:"")+"</div>":v&&(C="<div id="+g.loadedId+">"+w+"</div>");void 0!=C?r=$(C):void 0!=t&&""!=t&&(r=$("<div id="+g.loadedId+"></div>"),q=$("."+t).clone(),q.appendTo(r),q.show());void 0!=m&&""!=m&&("none"==$("."+m).css("display")?$("."+m).show():"block"==$("."+m).css("display")&&$("."+m).hide());if(void 0!=r){g.hintEnabled=!0;r.attr({hintOwner:l});r.addClass(b.styleDefault);if(void 0!=u&&""!=u)for(u=
u.split(","),l=u.length,q=0;q<l;q++)r.addClass(u[q]);if(void 0!=z&&""!=z)for($("#"+a).attr({tempClass:z}),z=z.split(","),l=z.length,q=0;q<l;q++)$("#"+a).addClass(z[q]);void 0!=B&&""!=B&&$("#"+a).attr({saveNormalClass:B});r.addClass(u);r.appendTo("body");$("#"+g.loadedId).hide();""!=d&&$("#"+g.loadedId).attr({testerId:d,elementId:a,elementClass:e,hintEvent:f});0<x?$("#"+g.loadedId).css("width",x+"px"):(z=$("#"+g.loadedId).css("width").slice(0,-2),x=0<parseInt(z)?parseInt(z):0);0<y?$("#"+g.loadedId).css("height",
y+"px"):(z=$("#"+g.loadedId).css("height").slice(0,-2),y=0<parseInt(z)?parseInt(z):0);r.css("z-index",1100);0.6<gScaleValue?(c.pageY<document.documentElement.clientHeight/2?$("#"+g.loadedId).css("top",c.pageY+40+h+"px"):$("#"+g.loadedId).css("top",c.pageY-y-45-h+"px"),c.pageX<document.documentElement.clientWidth/2?$("#"+g.loadedId).css("left",c.pageX+15+k+"px"):$("#"+g.loadedId).css("left",c.pageX-30-x-k+"px")):($("#"+g.loadedId).css({top:g.pMargenTop,"margin-top":"20px"}),$("#"+g.loadedId).css({left:"10px"}));
"#hint"!=s&&("0"!=A?g.timer=setTimeout(function(){$("#"+g.loadedId).fadeIn();if("onHint"==$("#"+g.loadedId).attr("hintEvent")){var a={testerId:$("#"+g.loadedId).attr("testerId"),elementId:$("#"+g.loadedId).attr("elementId"),elementClass:$("#"+g.loadedId).attr("elementClass"),hintEvent:$("#"+g.loadedId).attr("hintEvent"),lastStateCheck:1};jQuery.lacerta.tester.checkTest(a)}},A):($("#"+g.loadedId).fadeIn(),"onHint"==$("#"+g.loadedId).attr("hintEvent")&&(c={testerId:$("#"+g.loadedId).attr("testerId"),
elementId:$("#"+g.loadedId).attr("elementId"),elementClass:$("#"+g.loadedId).attr("elementClass"),hintEvent:$("#"+g.loadedId).attr("hintEvent"),lastStateCheck:1},jQuery.lacerta.tester.checkTest(c))));!0==isTouchScreen&&$("#"+g.loadedId).bind("click",function(a){a.stopPropagation();g.hoverOff()})}};g.hoverOff=function(){!0==isTouchScreen&&"block"==$("#"+g.loadedId).css("display")&&$("#"+g.loadedId).unbind("click");void 0!=m&&""!=m&&("block"==$("."+m).css("display")?$("."+m).hide():"none"==$("."+m).css("display")&&
$("."+m).show());if(g.hintEnabled){if("offHint"==$("#"+g.loadedId).attr("hintEvent"))var b={testerId:$("#"+g.loadedId).attr("testerId"),elementId:$("#"+g.loadedId).attr("elementId"),elementClass:$("#"+g.loadedId).attr("elementClass"),hintEvent:$("#"+g.loadedId).attr("hintEvent"),lastStateCheck:1};$("#"+g.loadedId).remove();g.hintEnabled=!1;null!=g.timer&&clearTimeout(g.timer);var c=$("#"+a).attr("tempClass");if(void 0!=c&&""!=c)for(var c=c.split(","),d=c.length,e=0;e<d;e++)$("#"+a).removeClass(c[e]);
$("#"+a).attr({tempClass:""});d=$("#"+a).attr("saveNormalClass");if(void 0!=d&&""!=d)for(c=d.split(","),d=c.length,e=0;e<d;e++)$("#"+a).addClass(c[e]);$("#"+a).attr({saveNormalClass:""});b&&jQuery.lacerta.tester.checkTest(b)}};$("a, area#"+a).click(function(b){b.preventDefault();b.stopImmediatePropagation();void 0!=g.checkedLink&&$(g.checkedLink).removeAttr("id");g.checkedLink=b.target;$(g.checkedLink).attr("id","checkedLinkDefault");var d=$(this).attr("href"),e=$("#"+g.loadedId).attr("hintOwner");
void 0==e&&(e="html");var f={id:a,parentId:c,actions:""};if(void 0!=d)if(!0==isTouchScreen&&"#Event:"!=d.slice(0,7)&&g.hoverOn(b),"#Event:"==d.slice(0,7)&&"html"==e)g.runAction(d,f,"clickLink");else{if("image"==e||"zone"==e||"area"==e){if("clickObj"==$("#"+g.loadedId).attr("hintEvent")||"offHint"==$("#"+g.loadedId).attr("hintEvent"))var h={testerId:$("#"+g.loadedId).attr("testerId"),elementId:$("#"+g.loadedId).attr("elementId"),elementClass:$("#"+g.loadedId).attr("elementClass"),hintEvent:$("#"+g.loadedId).attr("hintEvent"),
lastStateCheck:1};g.hintEnabled&&($("#"+g.loadedId).remove(),g.hintEnabled=!1,null!=g.timer&&clearTimeout(g.timer));$("#"+a).trigger("click");b=$("#"+a).attr("tempClass");if(void 0!=b&&""!=b){b=b.split(",");for(var k=b.length,l=0;l<k;l++)$("#"+a).removeClass(b[l])}$("#"+a).attr({tempClass:""});h&&jQuery.lacerta.tester.checkTest(h)}"#hint"==d&&$("#"+g.loadedId).fadeIn();"#Event:"==d.slice(0,7)&&"area"==e&&g.runAction(d,f,"clickLink")}return!1});!0!=isTouchScreen&&$("a, area#"+a).mousemove(function(a){var b=
$("#"+g.loadedId).attr("hintOwner");if(g.hintEnabled&&("image"==b||"zone"==b||"area"==b)){var b=$("#"+g.loadedId).css("width").slice(0,-2),c=$("#"+g.loadedId).css("height").slice(0,-2);a.pageY<document.documentElement.clientHeight/2?$("#"+g.loadedId).css("top",a.pageY+40+h):$("#"+g.loadedId).css("top",a.pageY-c-45-h);a.pageX<document.documentElement.clientWidth/2?$("#"+g.loadedId).css("left",a.pageX+15+k):$("#"+g.loadedId).css("left",a.pageX-30-b-k)}})},runAction:function(a,c,b){var d=[],e=null;a=
a.slice(9).split(";");for(var f=0;f<a.length;f++){for(var e=a[f].split(":"),g=0;g<e.length;++g)$.trim(e[g]);if(2<e.length)for(g=2;g<e.length;++g)e[1]+=":"+e[g];2==e.length&&(g=e[1].split(","),e=1<g.length?[e[0],g[0],g[1]]:[e[0],e[1]]);null!=e&&d.push(e)}c.actions=d;$.lacerta.actions.prepareDispatchAction(c,b)}};/*

 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 timing.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.timing={timePointsObj:{},timeLinesObj:{},timeTitresObj:{},programmers:[{name:"Sergey",surname:"Kondrashov"}],purgeTiming:function(){this.timePointsObj={};this.timeLinesObj={};this.timeTitresObj={}},composeTiming:function(a,c){var b=$(a).children(),d={checkedTime:"",pointsNum:0},e=[],f=[];$.each(b,function(a,c){var h=b[a],m=h.nodeName;if("timePoint"==m)m=$(h).attr("time")||"",h=$(h).text()||"",""!=m&&""!=h&&(h=h.split(";"),d["_"+m]=h,d.pointsNum+=1);else if("timeLine"==m){var m={timeInState:!1,
timeIn:0,timeOut:0,timeInActionsL:[],timeOutActionsL:[]},l=$(h).attr("timeIn")||"",n=$(h).attr("timeOut")||"";if(""!=l&&""!=n){var p=$("timeInActions",h).text()||"",h=$("timeOutActions",h).text()||"";m.timeIn=parseFloat(l);m.timeOut=parseFloat(n);m.timeInActionsL=""!=p?p.split(";"):[];m.timeOutActionsL=""!=h?h.split(";"):[];e.push(m)}}else if("titres"==m){var r=$(h).attr("textId")||"";if(""!=r){var n=l="",s=$(h).children();$.each(s,function(a,b){var c={timeInState:!1,timeIn:0,timeOut:0,textId:"",
text:""},d=s[a];l=$(d).attr("timeIn")||"";n=$(d).attr("timeOut")||"";""!=l&&""!=n&&(c.timeIn=parseFloat(l),c.timeOut=parseFloat(n),c.textId=r,c.text=$(d).attr("text")||"",f.push(c))})}}});this.timePointsObj[c]=0<d.pointsNum?d:"";this.timeLinesObj[c]=0<e.length?e:"";this.timeTitresObj[c]=0<f.length?f:""},checkTimeEvent:function(a,c,b){var d=this.timePointsObj[a],e=this.timeLinesObj[a];a=this.timeTitresObj[a];if(""!=d&&("silverlight"==b&&-1!=c.indexOf(",")&&(c=c.replace(",",".")),b=Math.floor(2*c)/
2,d.checkedTime!=b&&(d.checkedTime=b,d=d["_"+b],void 0!=d)))for(var f=0;f<d.length;f++)if(-1!=d[f].indexOf(":")){var g=d[f].split(":");b=g[0];g=g[1].slice(1);$.lacerta.actions.doClassAction([b,g])}if(""!=e)for(var f=0,k=e.length;f<k;f++)if(d=e[f],!1==d.timeInState&&c>=d.timeIn&&c<d.timeOut){if(d.timeInState=!0,d=d.timeInActionsL,0<d.length)for(var h=0;h<d.length;h++)-1!=d[h].indexOf(":")&&(g=d[h].split(":"),b=g[0],g=g[1].slice(1),$.lacerta.actions.doClassAction([b,g]))}else if(!0==d.timeInState&&
(c<d.timeIn||c>=d.timeOut)&&(d.timeInState=!1,d=d.timeOutActionsL,0<d.length))for(h=0;h<d.length;h++)-1!=d[h].indexOf(":")&&(g=d[h].split(":"),b=g[0],g=g[1].slice(1),$.lacerta.actions.doClassAction([b,g]));if(""!=a)for(e=0,d=a.length;e<d;e++)f=a[e],b=f.textId,!1==f.timeInState&&c>=f.timeIn&&c<f.timeOut?(f.timeInState=!0,f=f.text,"block"==$("."+b).css("display")&&$("."+b).text(f)):!0==f.timeInState&&(c<f.timeIn||c>=f.timeOut)&&(f.timeInState=!1,$("."+b).text(""))}};jQuery.lacerta.media={testId:"testId",currentPlayingObj:{id:"",media:""},addMediaListeners:function(a,c){var b=this,d=$("#"+a+">"+c)[0];d&&($(d).bind("canplaythrough",function(){"video"==c&&($.lacerta.actions.searchEvInObjArray(a,"onDuration"),"block"==$("#"+a).css("display")&&"true"==$("#"+a).attr("data-playing")&&($("#"+a).attr("data-playing","false"),b.play(a,c)))}),$(d).bind("ended",function(){b.stop(a,c);$.lacerta.actions.searchEvInObjArray(a,"onPlayed")}),$(d).bind("pause",function(){$.lacerta.actions.searchEvInObjArray(a,
"onPause")}),$(d).bind("playing",function(){$.lacerta.actions.searchEvInObjArray(a,"onPlay");"exclusive_played"==$("#currentStep").attr("data-restriction")&&b.currentPlayingObj.id!=a&&(""!=b.currentPlayingObj.id&&b.pause(b.currentPlayingObj.id,b.currentPlayingObj.media),b.currentPlayingObj.id=a,b.currentPlayingObj.media=c)}),"true"==$("#"+a).attr("data-timing")&&$(d).bind("timeupdate",function(){d.paused||d.ended||jQuery.lacerta.timing.checkTimeEvent(a,d.currentTime,"html5Media")}))},load:function(a,
c){var b=$("#"+a+">"+c)[0];b&&b.load()},play:function(a,c){var b=$("#"+a+">"+c)[0];b&&b.paused&&(b.ended&&(b.currentTime=0),b.play())},stop:function(a,c){var b=$("#"+a+">"+c)[0];b&&(b.paused||b.pause());0!=b.currentTime&&(b.currentTime=0)},pause:function(a,c){var b=$("#"+a+">"+c)[0];b&&(b.paused||b.ended||b.pause())},seek:function(a,c,b){if(a=$("#"+a+">"+b)[0])a.currentTime=c}};$.lacerta.silverlight={programmers:[{name:"Anton",surname:"Pakhunov",section:["$.lacerta.silverlight"]}],linuxPatchObj:{},purgeSilverlight:function(){this.linuxPatchObj={}},check:function(a){var c=$("#"+a+">object")[0];$.lacerta.actions.objectArray[a].opened&&c&&c.content&&c.content.VideoPlayer?($.lacerta.actions.objectArray[a].checkSeek&&(c.content.VideoPlayer.Seek($.lacerta.actions.objectArray[a].checkSeek),$.lacerta.actions.objectArray[a].checkSeek=null),$.lacerta.actions.objectArray[a].checkPlay?
(this.unCheck(a),c.content.VideoPlayer.Play()):$.lacerta.actions.objectArray[a].checkPause?(this.unCheck(a),c.content.VideoPlayer.Pause()):$.lacerta.actions.objectArray[a].checkStop&&(this.unCheck(a),c.content.VideoPlayer.Stop())):(this.unCheck(a),$.lacerta.actions.objectArray[a].checkSeek=null)},unCheck:function(a){$.lacerta.actions.objectArray[a].checkPlay=!1;$.lacerta.actions.objectArray[a].checkPause=!1;$.lacerta.actions.objectArray[a].checkStop=!1},play:function(a){$.lacerta.silverlight.linuxPatchObj[a+
"_sl_patch"]&&($("#"+a+"_sl_patch").remove(),$.lacerta.silverlight.linuxPatchObj[a+"_sl_patch"]=0);var c=$("#"+a+">object")[0];$.lacerta.actions.objectArray[a].opened&&c&&c.content&&c.content.VideoPlayer?(this.unCheck(a),c.content.VideoPlayer.Play()):$.lacerta.actions.objectArray[a].checkPlay=!0},stop:function(a){if("stopped"!=$.lacerta.actions.objectArray[a].playing){var c=$("#"+a+">object")[0];$.lacerta.actions.objectArray[a].opened&&c&&c.content&&c.content.VideoPlayer?(this.unCheck(a),c.content.VideoPlayer.Stop()):
$.lacerta.actions.objectArray[a].checkStop=!0}},pause:function(a){var c=$("#"+a+">object")[0];$.lacerta.actions.objectArray[a].opened&&c&&c.content&&c.content.VideoPlayer?(this.unCheck(a),c.content.VideoPlayer.Pause()):$.lacerta.actions.objectArray[a].checkPause=!0},seek:function(a,c){var b=$("#"+a+">object")[0];$.lacerta.actions.objectArray[a].opened&&b&&b.content&&b.content.VideoPlayer?($.lacerta.actions.objectArray[a].checkSeek=null,b.content.VideoPlayer.Seek(c)):$.lacerta.actions.objectArray[a].checkSeek=
c},bindControl:function(a){$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").bind("click",function(c){c.stopPropagation();$.lacerta.silverlight.play(a);$("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").show();$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").hide()});$("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").bind("click",function(c){c.stopPropagation();$.lacerta.silverlight.pause(a);$("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").hide();$("#"+
$.lacerta.actions.objectArray[a].controlId+">.play").show()});$("#"+$.lacerta.actions.objectArray[a].controlId+">.stop").bind("click",function(c){c.stopPropagation();$.lacerta.silverlight.stop(a);$("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").hide();$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").show()})}};
function silverlight_onPlayed(a,c){if($.lacerta.actions.objectArray[a].templateId)$.lacerta.slideshow.onElementPlayed(a,$.lacerta.actions.objectArray[a].templateId);$.lacerta.actions.searchEvInObjArray(a,"onPlayed");"audio"==$("#"+a).attr("data-media")&&"test"!=c&&($("#"+a).hide(),"true"==$("#"+a).attr("data-loop")?setTimeout(function(){$("#"+a).show();$.lacerta.silverlight.play(a)},100):setTimeout(function(){$.lacerta.silverlight.linuxPatchObj[a+"_sl_patch"]=1;var b=$("<img/>");b.attr("id",a+"_sl_patch");
b.attr("src","gui/skin/transper99.gif");b.css({top:"0px",left:"0px",width:"35px",height:"32px"});b.addClass("imageDefault");b.click(function(c){$.lacerta.silverlight.linuxPatchObj[a+"_sl_patch"]=0;$("#"+a).trigger("playObject");b.remove()});b.appendTo($("#"+a));$("#"+a).show()},100))}function silverlight_timePosition(a,c){var b=a.split(";");a=b[0];1<b.length&&(c=b[1]);"true"==$("#"+a).attr("data-timing")&&jQuery.lacerta.timing.checkTimeEvent(a,c,"silverlight")}
function silverlight_duration(a,c){a=a.split(";")[0];var b=$("#"+a+">object")[0];b&&b.content&&b.content.VideoPlayer?($.lacerta.actions.objectArray[a].opened=!0,$.lacerta.silverlight.check(a),$.lacerta.actions.searchEvInObjArray(a,"onDuration")):($("#"+a).hide(),$("#"+a).show())}
function silverlight_playing(a,c){var b=a.split(";");a=b[0];1<b.length&&(c=b[1]);"autoPlay"==c?($.lacerta.silverlight.linuxPatchObj[a+"_sl_patch"]&&setTimeout(function(){$("#"+a).trigger("stopObject")},25),"paused"!=$.lacerta.actions.objectArray[a].playing&&"stopped"!=$.lacerta.actions.objectArray[a].playing&&(b=$("div[data-restriction=exclusive_played]:has(#"+a+")"),b.length&&($.lacerta.actions.objectArray[$(b).attr("id")].playingId&&$.lacerta.actions.objectArray[$(b).attr("id")].playingId!=a&&$("#"+
$.lacerta.actions.objectArray[$(b).attr("id")].playingId,b).trigger("pauseObject"),$.lacerta.actions.objectArray[$(b).attr("id")].playingId=a),$.lacerta.actions.searchEvInObjArray(a,"onPlay"))):"playing"==c?($.lacerta.actions.objectArray[a].controlId&&($("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").show(),$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").hide()),b=$("div[data-restriction=exclusive_played]:has(#"+a+")"),b.length&&($.lacerta.actions.objectArray[$(b).attr("id")].playingId&&
$.lacerta.actions.objectArray[$(b).attr("id")].playingId!=a&&$("#"+$.lacerta.actions.objectArray[$(b).attr("id")].playingId,b).trigger("pauseObject"),$.lacerta.actions.objectArray[$(b).attr("id")].playingId=a),$.lacerta.actions.searchEvInObjArray(a,"onPlay")):"paused"==c?($.lacerta.actions.objectArray[a].controlId&&($("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").hide(),$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").show()),b=$("div[data-restriction=exclusive_played]:has(#"+
a+")"),b.length&&$.lacerta.actions.objectArray[$(b).attr("id")].playingId==a&&($.lacerta.actions.objectArray[$(b).attr("id")].playingId=null),$.lacerta.actions.searchEvInObjArray(a,"onPause")):($.lacerta.actions.objectArray[a].controlId&&($("#"+$.lacerta.actions.objectArray[a].controlId+">.pause").hide(),$("#"+$.lacerta.actions.objectArray[a].controlId+">.play").show()),b=$("div[data-restriction=exclusive_played]:has(#"+a+")"),b.length&&$.lacerta.actions.objectArray[$(b).attr("id")].playingId==a&&
($.lacerta.actions.objectArray[$(b).attr("id")].playingId=null),$.lacerta.actions.searchEvInObjArray(a,"onStop"));$.lacerta.actions.searchEvInObjArray(a,"onStateChanged");$.lacerta.actions.objectArray[a].playing=c};/*
 
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 design.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.design={targetSection:"commonBG",keyId:0,currentStepName:"",constantsObjList:{},labScreenParamIdArr:[],stepScreenParamIdArr:[],objBGParamList:{},objStepParamList:{},buttonMobIePatchId:"",programmers:[{name:"Sergey",surname:"Kondrashov",mail:["infostudio@yandex.ru"]},{name:"Alexandr",surname:"Makunin"}],composeNode:function(a){switch(a.targetSection){case "commonBG":this.onCommonHide();this.composeLabXML(a);this.onCommonShow();break;case "currentStep":this.keyId=0,"commonBG"==this.targetSection?
(this.targetSection="currentStep",this.onCurrentHide()):(this.onCurrentHide(),jQuery.lacerta.actions.removeStepActions(),$("#currentStep div").empty(),$("#currentStep").empty(),jQuery.lacerta.connections.purgeConnections(),jQuery.lacerta.dictation.purgeDictation(),jQuery.lacerta.puzzle.purgePuzzle(),jQuery.lacerta.hint.purgeHint(),jQuery.lacerta.tap.purgeTap(),jQuery.lacerta.tester.purgeTester(),jQuery.lacerta.slideshow.purgeSlideshow(),jQuery.lacerta.account.purgeAccount(),jQuery.lacerta.fillword&&
jQuery.lacerta.fillword.purgeFillword(),jQuery.lacerta.timing.purgeTiming(),jQuery.lacerta.silverlight.purgeSilverlight(),this.stepScreenParamIdArr=[],this.objStepParamList={}),jQuery.lacerta.calculation.onCalculationForStep(a.stepId),this.composeStepXML(a),this.onCurrentShow(),jQuery.lacerta.actions.searchEvent("currentStep","currentStep","onStartStep",""),jQuery.lacerta.timers.initTimers(a.stepId)}},onCommonHide:function(){$("#"+this.targetSection).hide()},onCommonShow:function(){$("#"+this.targetSection).show("slow")},
onCurrentHide:function(){$("#"+this.targetSection).hide()},onCurrentShow:function(){$("#"+this.targetSection).show("slow");jQuery.lacerta.actions.searchEvent("currentStep","currentStep","onShow")},checkConditions:function(a){a=a.split(";");for(var c=a.length,b=0;b<c;b++){var d=a[b];"$"==d.slice(0,1)&&(d=this.constantsObjList[d.slice(1)]);var d=d.split(":"),e=d.length;if("screen"==d[0])if("d"!=d[1]||isTouchScreen){if("m"==d[1]&&2==e||"m"==d[1]&&3==e&&(d=d[2].split("-"),2==d.length&&(e=1*d[1],1*d[0]<
gScaleValue&&gScaleValue<e)))return!0}else return!0}},composeLabXML:function(a){var c=this;$id=jQuery.lacerta.design.keyId;var b=a.domXml,d=$(b).find("constants global > *");$.each(d,function(a,b){if("constant"==d[a].nodeName){var e=$(b).attr("name"),h=$(b).attr("value");c.constantsObjList[e]=h}});d=$(b).find("constants conditional > *");$.each(d,function(a,b){if("constant"==d[a].nodeName){var e=$(b).attr("condition");if("undefined"!=typeof e&&""!=e){if(c.checkConditions(e)){var h=$(b).attr("name"),
e=$(b).attr("value");c.constantsObjList[h]=e}}else e=$(b).attr("value"),c.constantsObjList[h]=e}});var e=a.targetSection;jQuery.lacerta.actions.createActionsDOMList(e,"",e,$(b).children("labwork"),e,"div");$(b).find("settings sound").is("[allowMultiple=true]")||$("#commonBG").attr("data-restriction","exclusive_played");d=$(b).find("labwork > *");$.each(d,function(a,b){var c=d[a].nodeName,h={dom:b,parentId:e,sectionType:c,keyId:e};switch(c){case "group":jQuery.lacerta.design.composeGroupe(h);break;
case "image":jQuery.lacerta.design.putImageToHTML(h);break;case "video":jQuery.lacerta.design.putVideoToHTML(h);break;case "audio":jQuery.lacerta.design.putAudioToHTML(h);break;case "text":jQuery.lacerta.design.putTextToHTML(h);break;case "lucid":jQuery.lacerta.design.putLucidToHTML(h);break;case "timer":jQuery.lacerta.timers.setTimer(b)}})},composeStepXML:function(a){$id=jQuery.lacerta.design.keyId;var c=a.domXml,b=a.targetSection;jQuery.lacerta.actions.createActionsDOMList(b,"",b,$(c).children("step"),
b,"div");a=$("#currentStep");!1==$.lacerta.navigation.stepArray[$.lacerta.navigation.currentStep].multipleSound?a.attr("data-restriction","exclusive_played"):$.lacerta.navigation.stepArray[$.lacerta.navigation.currentStep].multipleSound?a.removeAttr("data-restriction"):$("#commonBG").is("[data-restriction=exclusive_played]")?a.attr("data-restriction","exclusive_played"):a.removeAttr("data-restriction");var d=$(c).find("step > *");$.each(d,function(a,c){switch(d[a].nodeName){case "tester":jQuery.lacerta.tester.parseTester(c);
var g=$(c).attr("id");jQuery.lacerta.actions.createActionsDOMList(b,b,g,c,g,"div","tester");break;case "shifter":jQuery.lacerta.shifter.parseShifter(c)}});$.each(d,function(a,c){var g=d[a].nodeName,k={dom:c,parentId:b,sectionType:g,keyId:b,templateId:void 0,stepId:void 0,templateResulObj:void 0};switch(g){case "group":jQuery.lacerta.design.composeGroupe(k);break;case "image":jQuery.lacerta.design.putImageToHTML(k);break;case "map":jQuery.lacerta.design.putMapToHTML(k);break;case "video":jQuery.lacerta.design.putVideoToHTML(k);
break;case "audio":jQuery.lacerta.design.putAudioToHTML(k);break;case "text":jQuery.lacerta.design.putTextToHTML(k);break;case "flash":jQuery.lacerta.design.putFlashToHTML(k);break;case "button":jQuery.lacerta.design.putButtonToHTML(k);break;case "lucid":jQuery.lacerta.design.putLucidToHTML(k);break;case "zone":jQuery.lacerta.design.putZoneToHTML(k);break;case "input":k.templateName="input";k.templateResulObj=jQuery.lacerta.calculation.passTemplateForCalculation(k.keyId+$id);jQuery.lacerta.design.putInputToHTML(k);
break;case "slideshow":k.templateName="slideshow";jQuery.lacerta.slideshow.composeSlideshow(k);break;case "connections":k.templateName="connections";k.templateResulObj=jQuery.lacerta.calculation.passTemplateForCalculation(k.keyId+$id);jQuery.lacerta.connections.composeConnections(k);break;case "dictation":k.templateName="dictation";k.templateResulObj=jQuery.lacerta.calculation.passTemplateForCalculation(k.keyId+$id);jQuery.lacerta.dictation.composeDictation(k);break;case "puzzle":k.templateName="puzzle";
k.templateResulObj=jQuery.lacerta.calculation.passTemplateForCalculation(k.keyId+$id);jQuery.lacerta.puzzle.composePuzzle(k);break;case "question":alert("Внимание, шаблон question был переобразован, теперь используется иная структура с корневым тегом questions");break;case "questions":k.templateName="questions";jQuery.lacerta.questions.composeQuestions(k);break;case "account":k.templateName="account";jQuery.lacerta.account.composeAccount(k);break;case "iframe":k.templateName="iframe";jQuery.lacerta.design.putIFrameToHTML(k);
break;case "object":k.templateName="object";jQuery.lacerta.design.putObjectToHTML(k);break;case "crossword":k.templateName="crossword";break;case "fillword":k.templateName="fillword",jQuery.lacerta.fillword.composeFillword(k)}})},composeGroupe:function(a,c){var b=a.dom,d=a.keyId,e=jQuery.lacerta.design.putGroupeToHTML(a,c),f=$(b).children();$.each(f,function(b,k){var h=f[b].nodeName,m={dom:f[b],parentId:e,sectionType:h,keyId:d,templateName:a.templateName};switch(h){case "group":jQuery.lacerta.design.composeGroupe(m,
c);break;case "image":jQuery.lacerta.design.putImageToHTML(m);break;case "map":jQuery.lacerta.design.putMapToHTML(m);break;case "video":jQuery.lacerta.design.putVideoToHTML(m);break;case "audio":jQuery.lacerta.design.putAudioToHTML(m);break;case "text":jQuery.lacerta.design.putTextToHTML(m);break;case "button":jQuery.lacerta.design.putButtonToHTML(m);break;case "flash":jQuery.lacerta.design.putFlashToHTML(m);break;case "input":m.templateName="input";m.templateResulObj=jQuery.lacerta.calculation.passTemplateForCalculation(m.keyId+
$id);jQuery.lacerta.design.putInputToHTML(m);break;case "zone":jQuery.lacerta.design.putZoneToHTML(m);break;case "lucid":jQuery.lacerta.design.putLucidToHTML(m)}});return e},putFillwordToHTML:function(a,c){var b="#"+a.parentId,d=a.fillwordId,e=a.sketchId,f=$("param",a.dom),g=f.attr("width")||"480",g=g*gScaleValue,k=f.attr("height")||"480",k=k*gScaleValue,f=f.attr("position")||"absolute",e="<canvas id="+e+" width="+g+"px height="+k+'px style="position:'+f+'; left:0px; top:0px; z-index:1"></canvas>';
$("<canvas id="+d+" width="+g+"px height="+k+'px style="position:'+f+'; left:0px; top:0px; z-index:0">Ваш браузер не поддерживает canvas.</canvas>').appendTo(b);$(e).appendTo(b)},putCanvasToHTML:function(a,c){var b=a.dom,d="#"+a.parentId;if(a.canvasId)var e=a.canvasId;else e=a.keyId+$id,$id++;for(var f=$(b).attr("id")||"defCanvas",f=f.split(","),g=f.length,k="canvas_def",h=0;h<g;h++)k=k+" "+f[h];var g=$(b).attr("visible")||"false",g="true"==g?"block":"none",m=$("param",b),h=m.attr("width")||a.pWidth||
"640",h=h*gScaleValue,l=m.attr("height")||a.pHeidht||"320",l=l*gScaleValue,n=0;0!=a.pX&&(n=m.attr("x")*gScaleValue||0);var p=0;0!=a.pY&&(p=m.attr("y")*gScaleValue||0);m=m.attr("position")||"absolute";$("<canvas id="+e+" width="+h+"px height="+l+'px class="'+k+'" style="display:'+g+"; position:"+m+"; left:"+n+"px; top:"+p+'px; z-index:0">Ваш браузер не поддерживает canvas.</canvas>').appendTo(d);jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,e,b,f[0],"canvas");return e},
putGroupeToHTML:function(a,c){var b=a.dom,d="#"+a.parentId;if("commonBG"==a.keyId||"currentStep"==a.keyId||"controls"==a.keyId){var e=a.keyId+$id;$id++}else e=a.keyId;var f=$(b).attr("id")||"defGroupe_"+($id-1),f=f.split(","),g=$(b).attr("restriction"),k=$.lacerta.design.getCSS(b,"group",e,c,a.extParam),h=a.templateName,m=$("<div id="+e+"></div>");g&&m.attr("data-restriction",g);m.addClass("groupDefault");m.css(k);g=f.length;for(k=0;k<g;k++)m.addClass(f[k]);void 0==c&&(g=$("html_data",b).text())&&
m.append(g);m.appendTo(d);$("#"+e).bind("showObject",function(a){a.stopPropagation();if("none"==$("#"+e).css("display")){$("#"+e).show();a=$("#"+e).children();if(0<a.length)jQuery.lacerta.effects.onChildShow(a);$.lacerta.actions.searchEvInObjArray(e,"onShow");$.each($(this).children(),function(a,b){$(this).trigger("showObject")})}});$("#"+e).bind("hideObject",function(a){a.stopPropagation();if("none"!=$("#"+e).css("display")){$("#"+e).hide();a=$("#"+e).children();if(0<a.length)jQuery.lacerta.effects.onChildHide(a);
$.lacerta.actions.searchEvInObjArray(e,"onHide");$.each($(this).children(),function(a,b){$(this).trigger("hideObject")})}});$("#"+e).bind("checkObject",function(a){a.stopPropagation();a=$(this).children(".inputDefault").length;var b={id:e,count:a};$.each($(this).children(".inputDefault"),function(a,c){$(this).trigger("checkObject",b)})});jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,e,b,f[0],"div",h);jQuery.lacerta.effects.parseEffects(e,b);return e},putZoneToHTML:function(a){var c=
a.dom,b="#"+a.parentId,d=a.sectionType;if("commonBG"==a.keyId||"currentStep"==a.keyId||"controls"==a.keyId){var e=a.keyId+$id;$id++}else e=a.keyId;var f=$("param",c),g=f.attr("depth"),k=f.attr("hoverStyle"),k=void 0!=k&&""!=k?k:"",h=f.attr("style"),h=void 0!=h&&""!=h?h:"",f=$(c).attr("id")||"defZone_"+($id-1),f=f.split(","),m=$.lacerta.design.getCSS(c,d,e),l=$("hint",c),d={enabled:!1};if(l){var n=l.text(),p=l.attr("relId"),r=l.attr("rel"),s=l.attr("style"),q=l.attr("height"),t=l.attr("width"),w=l.attr("xOffset"),
u=l.attr("yOffset"),l=void 0!=l.attr("delay")&&""!=l.attr("delay")?l.attr("delay"):"";if(""!=n||void 0!=p&&""!=p||void 0!=r&&""!=r)d={enabled:!0,owner:"zone",id:"",text:n,rel:r,relId:p,style:s,styleDefault:"htmlHintDefault",hoverStyle:k,normalStyle:h,height:q,width:t,xOffset:w,yOffset:u,delay:l}}k=$("<div id="+e+"></div>");k.addClass("zoneDefault");n=f.length;for(p=0;p<n;p++)k.addClass(f[p]);if(""!=h)for(h=h.split(","),n=h.length,p=0;p<n;p++)k.addClass(h[p]);k.css(m);g&&k.css("z-index",g);k.appendTo(b);
$("#"+e).bind("showObject",function(a){a.stopPropagation();$("#"+e).show();$.lacerta.actions.searchEvInObjArray(e,"onShow")});$("#"+e).bind("hideObject",function(a){a.stopPropagation();$("#"+e).hide();$.lacerta.actions.searchEvInObjArray(e,"onHide")});!0==d.enabled&&(d.id=e+"_hint");if(g=$("test",c))var y=g.attr("testerId"),y=void 0!=y&&""!=y?y:"",x=g.attr("hintEvent"),x=void 0!=x&&""!=x?x:"offHint";""!=y&&jQuery.lacerta.tester.initTest(y,e,f[0],g,d.id);!0!=d.enabled&&""==y||jQuery.lacerta.tap.activateParser(e,
b,d,y,f[0],x);jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,e,c,f[0],"div");jQuery.lacerta.effects.parseEffects(e,c);return e},putImageToHTML:function(a,c){var b=a.dom,d="#"+a.parentId,e=a.sectionType,f=$(b).attr("id")||"defImage_"+$id,f=f.split(","),g=$(b).attr("visible")||"false",k=a.keyId+$id;$id++;var h=$("param",b),m=this.deleteSlash(h.attr("src"));"$"==m.slice(0,1)&&(m=this.constantsObjList[m.slice(1)]);var l=h.attr("width"),n=h.attr("height");h.attr("x");h.attr("y");
var p=h.attr("depth"),r=h.attr("title")||"",s=h.attr("usemap"),h=$.lacerta.design.getCSS(b,e,k),q=$("hint",b),e={enabled:!1};if(q){var t=q.text(),w=q.attr("relId"),u=q.attr("rel"),y=q.attr("style"),x=q.attr("height"),A=q.attr("width"),v=q.attr("xOffset"),z=q.attr("yOffset"),q=void 0!=q.attr("delay")&&""!=q.attr("delay")?q.attr("delay"):"";if(""!=t||void 0!=w&&""!=w||void 0!=u&&""!=u)e={enabled:!0,owner:"image",id:"",text:t,rel:u,relId:w,style:y,styleDefault:"htmlHintDefault",height:x,width:A,xOffset:v,
yOffset:z,delay:q}}t=$("<img/>");t.attr({id:k,src:m,title:r});s&&t.attr("usemap",s);t.addClass("imageDefault");m=f.length;for(r=0;r<m;r++)t.addClass(f[r]);l&&t.attr({width:this.setUnit(l,k,"width",!0)});n&&t.attr({height:this.setUnit(n,k,"height",!0)});t.css(h);p&&t.css("z-index",p);g=this.testVisible(g,k);void 0!=g&&"false"==g&&t.css("display","none");t.appendTo(d);$("#"+k).bind("showObject",function(a){a.stopPropagation();$("#"+k).show();$.lacerta.actions.searchEvInObjArray(k,"onShow")});$("#"+
k).bind("hideObject",function(a){a.stopPropagation();$("#"+k).hide();$.lacerta.actions.searchEvInObjArray(k,"onShow")});$("#"+k).bind("disableDraggable",function(a){a.stopPropagation();$("#"+k+" > img").draggable("disable");$("#"+k+" > img").removeClass("ui-state-disabled")});$("#"+k).bind("enableDraggable",function(a){a.stopPropagation();$("#"+k+" > img").draggable("enable")});g=$("test",b);l="";if(g)var l=g.attr("testerId"),l=void 0!=l&&""!=l?l:"",B=g.attr("hintEvent"),B=void 0!=B&&""!=B?B:"offHint";
""!=l&&jQuery.lacerta.tester.initTest(l,k,f[0],g,e.id);if(!0==e.enabled||""!=l)e.id=k+"_hint",jQuery.lacerta.tap.activateParser(k,d,e,l,f[0],B);jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,k,b,f[0],"img");jQuery.lacerta.effects.parseEffects(k,b);return k},putMapToHTML:function(a,c){var b=a.dom;_this=this;var d=$(b).attr("name"),e=$("<map/>");e.attr({id:d,name:d});var f=$("param",b),g=f.attr("hintStyle");f.attr("hintHeight");var k=f.attr("hintWidth"),h=f.attr("xHintOffset"),
m=f.attr("yHintOffset"),l=void 0!=f.attr("hintDelay")&&""!=f.attr("hintDelay")?f.attr("hintDelay"):"300";e.appendTo("#currentStep");var n=$(b).find("area");$.each(n,function(a,b){if("area"==n[a].nodeName){var c=$("<area/>"),f=$(b).attr("id"),f=void 0!=f&&""!=f?f:d+a,t=$(b).attr("shape"),w=$(b).attr("coords");t||w||alert("Для элемента area id = "+d+"не указан тип фигуры shape или параметр coords");c.attr({id:f,shape:t,coords:w});t=$(b).attr("title");void 0!=t&&""!=t&&c.attr("title",t);"nohref"==$(b).attr("nohref")?
c.attr("nohref","nohref"):c.attr("href",$(b).attr("href"));c.appendTo(e);var u=$("hint",b),c={enabled:!1};if(u){var t=u.text(),w=u.attr("relId"),y=u.attr("rel"),x=u.attr("style"),A=u.attr("height"),v=u.attr("width"),z=u.attr("xOffset"),B=u.attr("yOffset"),E=u.attr("triggerObject"),u=void 0!=u.attr("delay")&&""!=u.attr("delay")?u.attr("delay"):"";if(""!=t||void 0!=w&&""!=w||void 0!=y&&""!=y)c={enabled:!0,owner:"area",id:"",text:t,rel:y,relId:w,triggerObject:E,style:x?x:g,styleDefault:"htmlHintDefault",
height:A,width:v?v:k,xOffset:z?z:h,yOffset:B?B:m,delay:u?u:l}}if(t=$("test",b))var C=t.attr("testerId"),C=void 0!=C&&""!=C?C:"",D=t.attr("hintEvent"),D=void 0!=D&&""!=D?D:"offHint";!0==c.enabled&&(c.id=f+"_hint",""!=C&&jQuery.lacerta.tester.initTest(C,f,"",t,c.id),jQuery.lacerta.hint.activatelinkParser(f,d,c,C,f,D))}});return d},putAudioToHTML:function(a,c){var b=a.dom,d="#"+a.parentId,e=$(b).attr("id")||"defAudio_"+$id,e=e.split(","),f=$(b).attr("visible"),g="true"==$(b).attr("playing")?"true":"false",
k=a.keyId+$id;$id++;var h=$("param",b),m=$(b).find("timeActions"),l="true"==m.attr("enabled")?"true":"false",n=h.attr("src"),p=0;if(void 0!=n&&""!=n)for(var r=n.split(";"),p=r.length,s=0;s<p;s++)"$"==r[s].slice(0,1)&&(r[s]=this.constantsObjList[r[s].slice(1)]);var s=h.attr("srcPath"),q=h.attr("srcName"),t=h.attr("srcExt");if(void 0!=s&&""!=s&&void 0!=q&&""!=q&&void 0!=t&&""!=t){r=[];t=t.split(";");"/"!=s.charAt(s.length-1)&&(s+="/");for(var p=t.length,w=0;w<p;w++)r.push(s+q+"."+t[w])}var w=h.attr("xsource"),
t=$(b).attr("loop")||"false",s=h.attr("width")?h.attr("width"):"0",q=h.attr("height")?h.attr("height"):"0",n=h.attr("depth"),u=h.attr("title")||"",y=$.lacerta.design.getCSS(b,"object",k),h=$("<div/>");h.attr({id:k});h.css({"z-index":n});h.appendTo(d);h.attr("data-playing",g);h.attr("data-timing",l);"true"==l&&jQuery.lacerta.timing.composeTiming(m,k);for(var d=!0,m=[],x=0;x<p;x++)switch(n=r[x],n.substring(n.length-3,n.length)){case "ogg":case "oga":Modernizr.audio.ogg&&(d=!1,m.push('src="'+n+'" type=\'audio/ogg; codecs="vorbis"\''));
break;case "mp3":Modernizr.audio.mp3&&(d=!1,m.push('src="'+n+'" type="audio/mpeg"')),slr_src=n;case "mp4":Modernizr.audio.mp4&&(d=!1,m.push('src="'+n+'" type="audio/mp4"'))}this.bindMedia(k,g,d,"audio");d&&(h.addClass("silverlightDiv"),h.attr("data-media","audio"),h.attr("data-loop",t));p=e.length;for(r=0;r<p;r++)h.addClass(e[r]);h.css(y);f=this.testVisible(f,k);void 0!=f&&"false"==f&&h.css("display","none");f=void 0;-1!=k.indexOf("slideshowData")&&(f=a.templateId);$.lacerta.actions.createActionsDOMList(this.targetSection,
a.parentId,k,b,e[0],"audio",void 0,f);$.lacerta.effects.parseEffects(k,b);e={dom:$("control",b),parentId:k,sectionType:"control",keyId:a.keyId};$(e.dom).attr("style");b=f=0;0<e.dom.length&&(b=f=1);if(e=$.lacerta.controls.findControl(e))f=0,b=2;"true"==l&&0==f&&d&&(f=1);d&&(s&&"0"!=s||(s=320*f,!s&&-1<navigator.platform.indexOf("Mac")&&(s=1)),q&&"0"!=q||(q=30*f));p=this.findFileName(decodeURIComponent(location));if(d)h[0].innerHTML+='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2"  class="silverlight" width="'+
s+'" height="'+q+'" title="'+u+'"><param name="source" value="'+p+w+'"/><param name="onError" value="onSilverlightError"/><param name="minRuntimeVersion" value="3.0.40818.0"/><param name="autoUpgrade" value="true"/><param name="enableGPUAcceleration" value="true"/><param name="windowless" value="true"/><param name="initParams" value="mediaSource='+p+slr_src+",autoPlay="+g+",loop="+t+",id="+k+",extControl="+b+",tActionsStatus="+l+'"/><a href="http://go.microsoft.com/fwlink/?LinkID=149156" style="text-decoration:none;position: absolute; z-index: 1000"><img src="http://go.microsoft.com/fwlink/?LinkId=108181" style="border-style:none" alt="Установите plug-in Microsoft Silverlight для воспроизведения видео и аудио" title="Нажмите на картинку, чтобы установить plug-in Microsoft Silverlight для воспроизведения видео и аудио"/></a></object>';
else{l="";1==f&&(l+=" controls");"true"==t&&(l+=" loop");t="";for(w=0;w<m.length;w++)t=t+"<source "+m[w]+"> ";l="<audio "+l+">"+t+"</audio>";h.html(l);"0"!=s?$("#"+k+">audio").css("width",this.setUnit(s)):$("#"+k+">audio").css("width",this.setUnit("320"));$.browser.msie&&$("#"+k+">audio").css("margin-top","-20px");0<q&&$("#"+k+">audio").css("height",this.setUnit(q));$.lacerta.media.addMediaListeners(k,"audio")}2==b&&($.lacerta.actions.objectArray[k].controlId=e,d&&$.lacerta.silverlight.bindControl(k),
"true"==g&&($("div#"+e+">.pause").show(),$("div#"+e+">.play").hide()));return k},putVideoToHTML:function(a,c){var b=a.dom,d="#"+a.parentId,e=$(b).attr("id")||"defVideo_"+$id,e=e.split(","),f=$(b).attr("visible"),g="true"==$(b).attr("playing")?"true":"false",k=a.keyId+$id;$id++;var h=$("param",b),m=$(b).find("timeActions"),l="true"==m.attr("enabled")?"true":"false",n=h.attr("src"),p=0;if(void 0!=n&&""!=n)for(var r=n.split(";"),p=r.length,s=0;s<p;s++)"$"==r[s].slice(0,1)&&(r[s]=this.constantsObjList[r[s].slice(1)]);
var s=h.attr("srcPath"),q=h.attr("srcName"),t=h.attr("srcExt");if(void 0!=s&&""!=s&&void 0!=q&&""!=q&&void 0!=t&&""!=t){r=[];t=t.split(";");"/"!=s.charAt(s.length-1)&&(s+="/");for(var p=t.length,w=0;w<p;w++)r.push(s+q+"."+t[w])}var u=h.attr("xsource"),q=$(b).attr("loop")||"false",y=h.attr("width")?h.attr("width"):"0",x=h.attr("height")?h.attr("height"):"0",s=h.attr("depth"),t=h.attr("poster")?h.attr("poster"):"",w=h.attr("title")||"",A=$.lacerta.design.getCSS(b,"object",k),h=$("<div/>");h.attr({id:k});
h.css({"z-index":s});h.appendTo(d);h.attr("data-playing",g);h.attr("data-timing",l);"true"==l&&jQuery.lacerta.timing.composeTiming(m,k);for(var d=!0,m=[],v=0;v<p;v++)switch(n=r[v],n.substring(n.length-3,n.length)){case "ebm":Modernizr.video.webm&&(d=!1,m.push('src="'+n+'" type=\'video/webm; codecs="vorbis,vp8"\''));break;case "mp4":Modernizr.video.h264&&(d=!1,m.push('src="'+n+"\" type='video/mp4'"));slr_src=n;break;case "ogv":case "ogg":!Modernizr.video.ogg||$.browser.mozilla&&3.5>$.browser.version||
(d=!1,m.push('src="'+n+'" type=\'video/ogg; codecs="theora,vorbis"\''))}this.bindMedia(k,g,d,"video");d&&(h.addClass("silverlightDiv"),h.attr("data-media",c),h.attr("data-loop",q));p=e.length;for(r=0;r<p;r++)h.addClass(e[r]);h.css(A);f=this.testVisible(f,k);void 0!=f&&"false"==f&&h.css("display","none");f=void 0;-1!=k.indexOf("slideshowData")&&(f=a.templateId);$.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,k,b,e[0],"video",void 0,f);$.lacerta.effects.parseEffects(k,b);e={dom:$("control",
b),parentId:k,sectionType:"control",keyId:a.keyId};$(e.dom).attr("style");b=f=0;0<e.dom.length&&(b=f=1);if(e=$.lacerta.controls.findControl(e))f=0,b=2;d&&(x=1*x+40*f);p=this.findFileName(decodeURIComponent(location));if(d)h[0].innerHTML+='<object data="data:application/x-silverlight-2," type="application/x-silverlight-2"  class="silverlight" width="'+y+'" height="'+x+'" title="'+w+'"><param name="source" value="'+p+u+'"/><param name="onError" value="onSilverlightError"/><param name="minRuntimeVersion" value="3.0.40818.0"/><param name="autoUpgrade" value="true"/><param name="enableGPUAcceleration" value="true"/><param name="windowless" value="true"/><param name="initParams" value="mediaSource='+
p+slr_src+",autoPlay="+g+",loop="+q+",id="+k+",extControl="+b+",tActionsStatus="+l+'"/><a href="http://go.microsoft.com/fwlink/?LinkID=149156" style="text-decoration:none;position: absolute; z-index: 1000"><img src="http://go.microsoft.com/fwlink/?LinkId=108181" style="border-style:none" alt="Установите plug-in Microsoft Silverlight для воспроизведения видео и аудио" title="Нажмите на картинку, чтобы установить plug-in Microsoft Silverlight для воспроизведения видео и аудио"/></a></object>';else{l=
0<y?this.setUnit(y,k,"width",!0):"";x=0<x?this.setUnit(x,k,"height",!0):"";u='<video width="'+l+'" height="'+x+'" '+(1==f?'controls="controls" ':"");u+=""!=w?'title="'+w+'" ':"";u+=""!=t?'poster="'+t+'" ':"";u+='preload="auto" ';u=u+("true"==q?'loop="'+q+'" ':"")+">";q="";for(t=0;t<m.length;t++)q=q+"<source "+m[t]+" >";u=u+q+"</video>";h.html(u);$.lacerta.media.addMediaListeners(k,"video");try{gButtonMobIePatch||(gButtonMobIePatch="")}catch(z){gButtonMobIePatch=""}""!=gButtonMobIePatch&&void 0!=gButtonMobIePatch&&
0.7>gScaleValue&&!0==$.browser.msie&&(this.buttonMobIePatchId=k+"_buttonMobIePatch",h=k+"_buttonMobIePatch",l=$('<img id="'+h+'" src="'+gButtonMobIePatch+'" width="'+l+'" height="'+x+'" class="imageDefault" />'),l.css({left:"0px",top:"0px","z-index":s+1}),l.appendTo("#"+k),$("#"+h).bind("click",function(a){a.stopPropagation();$.lacerta.media.play(k,"video")}))}2==b&&($.lacerta.actions.objectArray[k].controlId=e,d&&$.lacerta.silverlight.bindControl(k),"true"==g&&($("div#"+e+">.pause").show(),$("div#"+
e+">.play").hide()));return k},bindMedia:function(a,c,b,d){$("#"+a).bind("showObject",{playing:c},function(c){c.stopPropagation();"none"==$("#"+a).css("display")&&($("#"+a).show(),$.lacerta.actions.searchEvInObjArray(a,"onShow"));"true"==c.data.playing?b?$.lacerta.silverlight.play(a):$.lacerta.media.play(a,d):!b&&$.browser.msie&&$.lacerta.media.seek(a,0.15,d)});$("#"+a).bind("hideObject",function(c){c.stopPropagation();b?$.lacerta.silverlight.stop(a):$.lacerta.media.stop(a,d);$.lacerta.actions.objectArray[a].playing=
null;"none"!=$("#"+a).css("display")&&($("#"+a).hide(),$.lacerta.actions.searchEvInObjArray(a,"onHide"))});$("#"+a).bind("playObject",function(c){c.stopPropagation();$("#"+a).is(":hidden")?$(this).show(1,function(){b?$.lacerta.silverlight.play(a):$.lacerta.media.play(a,d)}):b?$.lacerta.silverlight.play(a):$.lacerta.media.play(a,d)});$("#"+a).bind("pauseObject",function(c){c.stopPropagation();b?$.lacerta.silverlight.pause(a):$.lacerta.media.pause(a,d)});$("#"+a).bind("stopObject",function(c){c.stopPropagation();
b?$.lacerta.silverlight.stop(a):$.lacerta.media.stop(a,d)});$("#"+a).bind("seekObject",function(c,f){c.stopPropagation();b?$.lacerta.silverlight.seek(a,f):$.lacerta.media.seek(a,f,d)})},putButtonToHTML:function(a){var c=a.dom,b="#"+a.parentId,d=a.sectionType,e=$(c).attr("id")||"defButton_"+$id,e=e.split(","),f=$(c).attr("visible"),g=$(c).attr("pressed"),k=a.keyId+$id;$id++;var h=$("param",c),m=h.attr("type"),l=h.attr("width"),n=h.attr("height"),p=h.attr("depth"),d=$.lacerta.design.getCSS(c,d,k),r=
h.attr("title")||"";""==r&&(r=$("hint",c).text()||"");h=$("<div/>");h.attr({id:k});""!=r&&h.attr({title:r});for(var r=e.length,s=0;s<r;s++)h.addClass(e[s]);h.addClass("buttonDefault");h.css(d);h.css("z-index",p);this.deleteSlash($("param",c).attr("srcPressed"));var q="";"TEXT"==m?(q=k+"_button",l=$("param",c).attr("textValue"),h.css("display","table").appendTo(b),$('<div id="'+q+'" style="max-width:100%;width:100%;max-height:100%;height:100%;"/>').appendTo(h).text(l),$("#"+k).bind("showObject",function(a){a.stopPropagation();
$("#"+k).show();$.lacerta.actions.searchEvInObjArray(k,"onShow")}),$("#"+k).bind("hideObject",function(a){a.stopPropagation();$("#"+k).hide();$.lacerta.actions.searchEvInObjArray(k,"onHide")}),$("#"+k).bind("disableObject",function(a){a.stopPropagation();$("#"+q).button("option","disabled",!0);$("#"+q).removeClass("ui-state-hover")}),$("#"+k).bind("enableObject",function(a){a.stopPropagation();$("#"+q).button("option","disabled",!1)}),$("#"+q).button()):"IMAGE"==m&&(h.appendTo(b),$("#"+k).bind("showObject",
function(a){a.stopPropagation();$("#"+k).show();$.lacerta.actions.searchEvInObjArray(k,"onShow")}),$("#"+k).bind("hideObject",function(a){a.stopPropagation();$("#"+k).hide();$.lacerta.actions.searchEvInObjArray(k,"onHide")}),$("#"+k).bind("disableObject",function(a){a.stopPropagation();$("#"+q).button("option","disabled",!0);$("#"+q).removeClass("ui-state-hover")}),$("#"+k).bind("enableObject",function(a){a.stopPropagation();$("#"+q).button("option","disabled",!1)}),b=this.deleteSlash($("param",c).attr("srcNormal")),
m=this.deleteSlash($("param",c).attr("srcActive")),n=n||"40",l=this.setUnit(l||"40",k,"width",!0),n=this.setUnit(n,k,"height",!0),$("#"+k).imgButton(b,m,l,n));"true"==g&&$("#"+q).button("option","disabled",!0);jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,k,c,e,"button");jQuery.lacerta.effects.parseEffects(k,c);"true"==f&&$.lacerta.actions.searchEvInObjArray(k,"onShow");return k},putTextToHTML:function(a,c,b){_this=this;var d=a.dom,e="#"+a.parentId,f=a.sectionType||"text",
g=a.keyId+$id;$id++;var k=$("param",d),h=k.attr("depth"),m=k.attr("type"),l=k.attr("style"),n="";void 0!=b&&(n=b);void 0!=l&&(l=l.split(","));b="";b=void 0!=c?c:$("value",d).text();k.attr("title");k.attr("divId");var p=$("<p/>");p.attr({id:g});"string"==typeof b&&p.html(b);c=$(d).attr("id")||"defText_"+($id-1);c=c.split(",");p.addClass("textDefault");for(var r=c.length,s=0;s<r;s++)p.addClass(c[s]);if(void 0!=l)for(r=l.length,s=0;s<r;s++)p.addClass(l[s]);f=$.lacerta.design.getCSS(d,f,g);p.css(f);p.css("z-index",
h);p.appendTo(e);$("#"+g).bind("showObject",function(a){a.stopPropagation();$("#"+g).show();$.lacerta.actions.searchEvInObjArray(g,"onShow")});$("#"+g).bind("hideObject",function(a){a.stopPropagation();$("#"+g).hide();$.lacerta.actions.searchEvInObjArray(g,"onHide")});"dictation"!=n&&(h={enabled:!1},h=k.attr("hintStyle"),n=k.attr("hintHeight"),f=k.attr("hintWidth"),l=k.attr("xHintOffset"),p=k.attr("yHintOffset"),k=void 0!=k.attr("hintDelay")&&""!=k.attr("hintDelay")?k.attr("hintDelay"):"300",h={id:"",
owner:"html",enabled:!0,style:h,styleDefault:"htmlHintDefault",height:n,width:f,xOffset:l,yOffset:p,delay:k},"string"==typeof m&&"html"==m.toLowerCase()&&-1!=b.search(/<a +.+>/ig)&&(-1!=b.search(/#eHint/ig)?jQuery.lacerta.actions.activatelinkParser(g,e):-1!=b.search(/<a +.*(rel|relId|style|label).+>/ig)&&jQuery.lacerta.hint.activatelinkParser(g,e,h)));jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,g,d,c[0],"p");jQuery.lacerta.effects.parseEffects(g,d);return g},putTitleToHTML:function(a){var c=
a.dom,b="#"+a.parentId;a=a.keyId+$id;$id++;var d=$(c).attr("value");$(c).attr("style");var e=this.setUnit($(c).attr("x")),f=this.setUnit($(c).attr("y"));$(c).attr("visible");var g=this.setUnit($(c).attr("width")),k=this.setUnit($(c).attr("height")),h=$(c).attr("depth"),c=$(c).attr("id"),m=$("<p/>");d&&(m.text(d),m.attr({id:a,width:g,height:k}));g=this.setUnit(g);k=this.setUnit(k);m.addClass("titleDefault");void 0!=c&&m.addClass(c);m.css({width:g,height:k,top:f,left:e,"z-index":h});m.appendTo(b);return a},
putFlashToHTML:function(a){var c="#"+a.parentId,b=a.dom,d=this.deleteSlash($("param",b).attr("src")),e=$("param",b),f=this.setUnit(e.attr("width")),g=this.setUnit(e.attr("height")),k=e.attr("depth");void 0==f&&(f="100px");void 0==g&&(g="100px");var h=e.attr("loop"),m=e.attr("wmode"),l=a.keyId+$id;$id++;var n=$(b).attr("id")||"defFlash_"+($id-1),n=n.split(","),p=this.setUnit(e.attr("x")||"0px"),r=this.setUnit(e.attr("y"))||"0px",e=$("<div/>");e.attr({id:l});e.css({width:f,height:g,left:p,top:r,position:"absolute",
"z-index":k});e.appendTo(c);c=n.length;for(f=0;f<c;f++)e.addClass(n[f]);c=$(b).attr("visible");void 0!=c&&"false"==c&&e.css("display","none");d={id:n[0],name:n[0],src:d,w3c:"true"};void 0!=h&&(d.loop=h);void 0!=m&&(d.wmode=m);flashembed(l,d);$("#"+l).bind("showObject",function(a){a.stopPropagation();$("#"+l).show();$.lacerta.actions.searchEvInObjArray(l,"onShow");$.browser.msie&&(document.getElementById(n[0]).rewind(),document.getElementById(n[0]).play())});$("#"+l).bind("hideObject",function(a){a.stopPropagation();
$.browser.msie&&document.getElementById(n[0]).IsPlaying()&&document.getElementById(n[0]).stop();$("#"+l).hide();$.lacerta.actions.searchEvInObjArray(l,"onHide")});$("#"+l).bind("playObject",function(a){a.stopPropagation();$("#"+l).is(":hidden")?$(this).show(1,function(){document.getElementById(n[0]).Play()}):document.getElementById(n[0]).Play()});$("#"+l).bind("pauseObject",function(a){a.stopPropagation();document.getElementById(n[0]).StopPlay();document.getElementById(n[0]).Rewind()});$("#"+l).bind("stopObject",
function(a){a.stopPropagation();document.getElementById(n[0]).StopPlay()});jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,l,b);jQuery.lacerta.effects.parseEffects(l,b);return l},putLucidToHTML:function(a){if($.browser.mozilla&&/%(?!20)/.test(location)){var c=$("param",a.dom),b=c.attr("alt_src");c.attr("src",b);a=jQuery.lacerta.design.putImageToHTML(a)}else a=jQuery.lacerta.design.putFlashToHTML(a);return a},putInputToHTML:function(a){var c="#"+a.parentId,b=a.dom,d=$("param",
b),e=a.sectionType,f=$(b).attr("id")||"defInput_"+$id,g=a.keyId+$id;$id++;var k=d.attr("size"),h=d.attr("width")||"30px";d.attr("height");var m=d.attr("maxChars"),l=d.attr("value"),n=d.attr("depth"),p=d.attr("readOnly"),e=$.lacerta.design.getCSS(b,e,g),r=d.attr("title")||"",d=$("<div/>");d.attr({title:r,id:g});r=$("<input/>");n&&r.css("z-index",n);k||(k=10);r.attr({size:k,value:l,maxlength:m,disabled:p});r.addClass("inputDefault2");r.css({width:this.setUnit(h)});d.addClass("inputDefault");d.addClass(f);
d.css(e);d.appendTo(c);d.css({"z-index":n});r.appendTo(d);$("#"+g).bind("showObject",function(a){a.stopPropagation();$("#"+g).show();$.lacerta.actions.searchEvInObjArray(g,"onShow")});$("#"+g).bind("hideObject",function(a){a.stopPropagation();$("#"+g).hide();$.lacerta.actions.searchEvInObjArray(g,"onHide")});$("caption",b).text()&&(c=$("caption",b),k=$("<div/>"),k.text(c.text()),k.css({left:this.setUnit(c.attr("x")),top:this.setUnit(c.attr("y")),width:this.setUnit(c.attr("width")),height:this.setUnit(c.attr("height")),
position:c.attr("position")||"absolute"}),k.addClass("captionDefault"),k.appendTo(d));c=$("test",b);k="";c&&(k=c.attr("testerId"),k=void 0!=k&&""!=k?k:"");""!=k&&jQuery.lacerta.tester.initTest(k,g,f,c);jQuery.lacerta.input.parseInput(g,f,b,a.templateResulObj,k);jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,g,b,f,"p");jQuery.lacerta.effects.parseEffects(g,b);return g},putIFrameToHTML:function(a){var c=a.dom,b="#"+a.parentId,d=a.sectionType,e=$(c).attr("id")||"defIframe_"+
$id,f=$(c).attr("visible"),g=a.keyId+$id;$id++;var k=$("param",c),h=this.deleteSlash(k.attr("src"));"$"==h.slice(0,1)&&(h=this.constantsObjList[h.slice(1)]);var m=k.attr("depth"),l=k.attr("name"),k=k.attr("scrolling"),d=$.lacerta.design.getCSS(c,d,g),n=$('<iframe allowTransparency frameborder="0" > </iframe>');n.attr({src:h,name:l,id:g,scrolling:k});n.css({"z-index":m,position:"absolute"});void 0!=f&&"false"==f&&n.css("display","none");n.css(d);n.appendTo(b);$.browser.msie||n.text("Ваш браузер не отображает плавающие фреймы.");
e&&n.addClass(e);$("#"+g).bind("showObject",function(a){a.stopPropagation();$("#"+g).show();$.lacerta.actions.searchEvInObjArray(g,"onShow")});$("#"+g).bind("hideObject",function(a){a.stopPropagation();$("#"+g).hide();$.lacerta.actions.searchEvInObjArray(g,"onHide")});jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,g,c,e,"iframe");return g},putObjectToHTML:function(a){var c=a.dom,b="#"+a.parentId,d=a.sectionType,e=$(c).attr("id")||"defObject_"+$id,f=$(c).attr("visible"),
g=a.keyId+$id;$id++;var k=$("param",c),h=this.deleteSlash(k.attr("src"));"$"==h.slice(0,1)&&(h=this.constantsObjList[h.slice(1)]);var m=k.attr("depth"),l=k.attr("type")||"image/svg+xml",n=k.attr("width"),k=k.attr("height"),d=$.lacerta.design.getCSS(c,d,g),p=$("<object> </object>");p.attr({data:h,type:l,id:g});n&&p.attr({width:this.setUnit(n,g,"width",!0)});k&&p.attr({height:this.setUnit(k,g,"height",!0)});p.css({"z-index":m,position:"absolute"});void 0!=f&&"false"==f&&p.css("display","none");p.css(d);
p.appendTo(b);e&&p.addClass(e);$("#"+g).bind("showObject",function(a){a.stopPropagation();$("#"+g).show();$.lacerta.actions.searchEvInObjArray(g,"onShow")});$("#"+g).bind("hideObject",function(a){a.stopPropagation();$("#"+g).hide();$.lacerta.actions.searchEvInObjArray(g,"onHide")});jQuery.lacerta.actions.createActionsDOMList(this.targetSection,a.parentId,g,c,e,"object");return g},getCSS:function(a,c,b,d,e){var f={},g=$(a).attr("visible")||"true";"slideshow"==d&&(g="false");var k=$(a).children("param");
a=k.attr("x")||"0";d=k.attr("y")||"0";var h=k.attr("cpt"),m=k.attr("position")||"absolute";void 0!=e&&(a=e.x,d=e.y);e=k.attr("shifterId");void 0!=e&&""!=e&&(e=jQuery.lacerta.shifter.getPosition(e,b))&&(a=e.x,d=e.y);e=k.attr("width");var l=k.attr("height");void 0!=h&&"true"==h&&void 0!=e&&void 0!=l&&(a=(parseInt(a)-parseInt(e)/2).toString(),d=(parseInt(d)-parseInt(l)/2).toString());k=k.attr("depth");f.left=this.setUnit(a?a:"0",b,"x");f.top=this.setUnit(d?d:"0",b,"y");"group"==c&&""!=k&&void 0!=k&&
(f["z-index"]=k);f.position=m;"image"!=c&&(g=this.testVisible(g,b),void 0!=g&&"false"==g&&(f.display="none"),"object"!=c&&(e&&(f.width=this.setUnit(e,b,"width")),l&&(f.height=this.setUnit(l,b,"height"))));return f},findFileName:function(a){if(a){var c=a.lastIndexOf("/");return a.substring(0,c+1)}},deleteSlash:function(a){a&&"/"==a.charAt(0)&&(a=a.substring(1));return a},checkTextUrl:function(a,c){if(0==$("#"+a).text()){var b="<h2>Ошибка</h2> Не найден путь: <br> <b> "+c+"</b> ";$("#"+a).html(b)}},
testVisible:function(a,c){var b=a.split(";"),d=b.length;!0!=isTouchScreen&&(d=1);if(1==d)b=b[0];else{var d=b[0],e=b[1],b=gClientWidth>=gClientHeight?d:e;this.setSRParam(c,"visible",d,e)}return b},setUnit:function(a,c,b,d){var e=a.split(";");a=e.length;!0!=isTouchScreen&&(a=1);if(1==a)return e=e[0],isNaN(1*e)?e:d?Math.round(e*gScaleValue).toString():Math.round(e*gScaleValue+0)+"px";a=e[0];var f=e[1];isNaN(1*a)||(a=d?Math.round(a*gScaleValue).toString():Math.round(a*gScaleValue+0)+"px");isNaN(1*f)||
(f=d?Math.round(f*gScaleValue).toString():Math.round(f*gScaleValue+0)+"px");e=gClientWidth>=gClientHeight?a:f;this.setSRParam(c,b,a,f);return e},setSRParam:function(a,c,b,d){if("commonBG"==this.targetSection){if(-1==jQuery.lacerta.utils.getOne(a,this.labScreenParamIdArr)){this.labScreenParamIdArr.push(a);var e={landscape:{x:"",y:"",width:"",height:"",visible:""},portrait:{x:"",y:"",width:"",height:"",visible:""}};this.objBGParamList[a]=e}"x"==c?(this.objBGParamList[a].landscape.x=b,this.objBGParamList[a].portrait.x=
d):"y"==c?(this.objBGParamList[a].landscape.y=b,this.objBGParamList[a].portrait.y=d):"width"==c?(this.objBGParamList[a].landscape.width=b,this.objBGParamList[a].portrait.width=d):"height"==c&&(this.objBGParamList[a].landscape.height=b,this.objBGParamList[a].portrait.height=d)}else"currentStep"==this.targetSection&&(-1==jQuery.lacerta.utils.getOne(a,this.stepScreenParamIdArr)&&(this.stepScreenParamIdArr.push(a),e={landscape:{x:"",y:"",width:"",height:"",visible:""},portrait:{x:"",y:"",width:"",height:"",
visible:""}},this.objStepParamList[a]=e),"x"==c?(this.objStepParamList[a].landscape.x=b,this.objStepParamList[a].portrait.x=d):"y"==c?(this.objStepParamList[a].landscape.y=b,this.objStepParamList[a].portrait.y=d):"width"==c?(this.objStepParamList[a].landscape.width=b,this.objStepParamList[a].portrait.width=d):"height"==c?(this.objStepParamList[a].landscape.height=b,this.objStepParamList[a].portrait.height=d):"visible"==c&&(this.objStepParamList[a].landscape.visible=b,this.objStepParamList[a].portrait.visible=
d))},resetParam:function(){var a=this.labScreenParamIdArr.length,c=this.stepScreenParamIdArr.length;if(0<a)for(var b=0;b<a;b++){var d=this.labScreenParamIdArr[b];this.updateBgParam(d)}if(0<c)for(a=0;a<c;a++)d=this.stepScreenParamIdArr[a],this.updateStepParam(d)},updateBgParam:function(a){if("L"==gScreenMode)var c=this.objBGParamList[a].landscape.x,b=this.objBGParamList[a].landscape.y,d=this.objBGParamList[a].landscape.width,e=this.objBGParamList[a].landscape.height,f=this.objBGParamList[a].landscape.visible;
else c=this.objBGParamList[a].portrait.x,b=this.objBGParamList[a].portrait.y,d=this.objBGParamList[a].portrait.width,e=this.objBGParamList[a].portrait.height,f=this.objBGParamList[a].portrait.visible;"false"==f&&"none"!=$("#"+a).css("display")&&$("#"+a).css("display","none");"true"==f&&"block"!=$("#"+a).css("display")&&$("#"+a).css("display","block");$("#"+a).is("img")?$("#"+a).is("img")&&(""!=c&&$("#"+a).css("left",c),""!=b&&$("#"+a).css("top",b),""!=d&&$("#"+a).attr("width",d),""!=e&&$("#"+a).attr("height",
e)):(""!=c&&$("#"+a).css("left",c),""!=b&&$("#"+a).css("top",b),""!=d&&$("#"+a).css("width",d),""!=e&&$("#"+a).css("height",e))},updateStepParam:function(a){if("L"==gScreenMode)var c=this.objStepParamList[a].landscape.x,b=this.objStepParamList[a].landscape.y,d=this.objStepParamList[a].landscape.width,e=this.objStepParamList[a].landscape.height,f=this.objStepParamList[a].landscape.visible;else c=this.objStepParamList[a].portrait.x,b=this.objStepParamList[a].portrait.y,d=this.objStepParamList[a].portrait.width,
e=this.objStepParamList[a].portrait.height,f=this.objStepParamList[a].portrait.visible;"false"==f&&"none"!=$("#"+a).css("display")&&$("#"+a).css("display","none");"true"==f&&"block"!=$("#"+a).css("display")&&$("#"+a).css("display","block");$("#"+a).is("img")?$("#"+a).is("img")&&(""!=c&&$("#"+a).css("left",c),""!=b&&$("#"+a).css("top",b),""!=d&&$("#"+a).attr("width",d),""!=e&&$("#"+a).attr("height",e)):(""!=c&&$("#"+a).css("left",c),""!=b&&$("#"+a).css("top",b),""!=d&&$("#"+a).css("width",d),""!=e&&
$("#"+a).css("height",e))}};jQuery.lacerta.controls={strucktDom:{},getData:function(a){a=jQuery.lacerta.loader.readXML(a);jQuery.lacerta.controls.strucktDom=a},findControl:function(a){var c=0,b=null,d=a.dom,e=$(d).attr("x");e||(e=0);var f=$(d).attr("y");f||(f=0);$(d).attr("width");$(d).attr("depth");$(d).attr("depth");var g=$(d).attr("visible"),k=$(d).attr("style"),h=$(jQuery.lacerta.controls.strucktDom).children().children();$.each(h,function(d,l){$(h[d]).attr("name")==k&&(c=1,$(h[d]).attr({id:k,visible:g}).find(">param").attr({x:e,
y:f}),b=jQuery.lacerta.controls.putControl({dom:l,parentId:a.parentId,sectionType:a.sectionType,keyId:a.keyId,name:k},!1))});if(c)return b},putControl:function(a,c){var b=null;switch(a.dom.nodeName){case "group":b=jQuery.lacerta.design.composeGroupe(a);break;case "image":b=jQuery.lacerta.design.putImageToHTML(a);break;case "video":b=jQuery.lacerta.design.putVideoToHTML(a);break;case "button":b=jQuery.lacerta.design.putButtonToHTML(a)}return b}};jQuery.lacerta.navigation={currentStepCount:0,allStepCount:0,stepArray:[],currentStep:0,putStep:function(a){this.stepArray[a.index]=a;this.currentStepCount++;this.currentStepCount==jQuery.lacerta.getAllStepCount()&&(this.currentStep=0,jQuery.lacerta.calculation.prepareStepsForCalculation(this.stepArray),this.showStepWithNum(this.currentStep))},showPreviousStep:function(a){0<this.currentStep&&(this.currentStep-=1,this.showStepWithNum(this.currentStep))},showNextStep:function(a){this.currentStep<this.currentStepCount&&
(this.currentStep+=1,this.showStepWithNum(this.currentStep))},showStepWithId:function(a){for(var c=0;c<this.currentStepCount;c++)theId=this.stepArray[c].id,theId==a&&(this.currentStep=c,this.showStepWithNum(c))},showStepWithNum:function(a){$.lacerta.design.composeNode({domXml:this.stepArray[a].dom,targetSection:"currentStep",stepId:this.stepArray[a].id,stepScoring:this.stepArray[a].scoring})},openLink:function(a,c,b,d){"_blank"==a||"_self"==a?window.open(c,a):"_href"==a&&(window.location.href=c)}};jQuery.lacerta.actions={commonList:{},stepList:{},objectArray:[],currentTargetSection:"",createActionsDOMList:function(a,c,b,d,e,f,g,k){this.currentTargetSection!=a&&(this.currentTargetSection=a);e={targetSection:a,id:b,parentId:c,omsId:e,tagName:f,dom:d,actionsL:[],childsL:[],parent:{},templateName:g,templateId:k,resultObj:{}};f=[];f=this.loadActions(d);void 0!=f&&0<f.length&&(e.actionsL=f);this.objectArray[b]=e;switch(a){case "commonBG":var h=this.commonList;break;case "currentStep":h=this.stepList}""==
c?jQuery.extend(h,e):this.addChildObjToCurrentList(a,e,h)},addChildObjToCurrentList:function(a,c,b){a==c.parentId?(c.parent=b,a=c.actionsL,void 0!=a&&0<a.length&&void 0==c.templateName&&this.setInteractiveToObj(c),b.childsL.push(c)):this.addChildObjToCurrentList(c.parentId,c,this.objectArray[c.parentId])},loadActions:function(a){var c=[];a=$(a).children("actions");if(a.length){var b=$(a).children("action");$.each(b,function(a,e){var f=b[a],g=$(f).attr("event"),k=$(f).attr("event"),h=$(f).attr("eventParam"),
f=$(f).text(),f=jQuery.lacerta.utils.replaceString(f,"\r",""),f=jQuery.lacerta.utils.replaceString(f,"\t",""),f=jQuery.lacerta.utils.replaceString(f,"\n","");c.push({id:g,event:k,eventParam:h,content:f})});return c}},removeStepActions:function(){this.stepList={}},setInteractiveToObj:function(a){var c=a.actionsL,b=c.length;if(0<b)for(var d=0;d<b;++d){var e=c[d],f=e.event,g="";switch(f){case "onRollOver":g="mouseenter";break;case "onRollOut":g="mouseleave";break;case "onPress":g="click";break;case "onRelease":g=
"mouseup"}""!=g&&this.bindEvent(g,a,e,f)}},bindEvent:function(a,c,b,d){var e=this;"click"==a&&$("#"+c.id).addClass("activeElement");$("#"+c.id).bind(a,function(a){a.stopPropagation();e.dispatchEventForRadioButton(c,b,d,e)})},setTemplateActionsToObj:function(a){},dispatchEventForRadioButton:function(a,c,b,d){c=a.id;var e="div:has(#"+c+")",f=$(e).length-1,g=!0;"exclusive_pressed"==$(e+":eq("+f+")").attr("data-restriction")&&(g=this.toggelUiButton("#"+c));g&&d.prepareDispatchAction(a,b)},toggelUiButton:function(a){if($(a+
"_button").button("option","disabled"))return!1;$(a).siblings().children().trigger("enableObject");$(a+"_button").trigger("disableObject");return!0},activatelinkParser:function(a,c){var b="";$("#"+a).find("a").hover(function(a){var c=$(this).attr("href");if("#eHint:"==c.slice(0,7)){var c=c.slice(1),f=/src(?=\s*=\s*(\S+?)(?=&|$))/i.exec(c);"/"==f[1].slice(0,1)&&(f[1]=f[1].slice(1));c=/type(?=\s*=\s*(\S+?)(?=[\s*&$]))/i.exec(c);"text"==c[1].toLowerCase()?(b="#largeText",c=$("<p/>"),c.load(f[1]),c.attr({id:"largeText"}),
c.css({position:"absolute",visibility:"visible",top:"0px",left:"0px"}),c.appendTo("body"),f=c.css("width"),c.css("z-index",1100),a.pageY<document.documentElement.clientHeight/2?c.css("top",a.pageY+10):c.css("top",a.pageY-c.height()-25),a.pageX<document.documentElement.clientWidth/2?c.css("left",a.pageX+5):c.css("left",a.pageX-20-f.slice(0,-2))):"image"==c[1].toLowerCase()&&(b="#largeImage",f='<img id="largeImage" src="'+f[1]+'" alt="big image" style="position:absolute;visibility:hidden;top:0px;left:0px;z-index:1100;"/>',
$(f).appendTo("body"),a.pageY<document.documentElement.clientHeight/2?$(f).css("top",a.pageY+10):$(f).css("top",a.pageY-$(f).attr("height")-25),a.pageX<document.documentElement.clientWidth/2?$(f).css("left",a.pageX+5):$(f).css("left",a.pageX-5-$(f).attr("width")))}},function(){""!=b&&($(b).remove(),b="")});$("a","area").click(function(b){var e=$(this).attr("href");if("#Event:"==e.slice(0,7)){b={id:a,parentId:c,actions:""};for(var f=[],g=null,e=e.slice(9).split(";"),k=0;k<e.length;k++){for(var g=e[k].split(":"),
h=0;h<g.length;++h)$.trim(g[h]);if(2<g.length)for(h=2;h<g.length;++h)g[1]+=":"+g[h];2==g.length&&(h=g[1].split(","),g=1<h.length?[g[0],h[0],h[1]]:[g[0],g[1]]);null!=g&&f.push(g)}b.actions=f;$.lacerta.actions.prepareDispatchAction(b,"clickLink");return!1}if("#eHint:"==e.slice(0,7)||"#"==e)return alert("href == #eHint"),!1});$("a","area").mousemove(function(a){if(""!=b){if("#largeText"==b){var c=$("#largeText").css("width");a.pageY<document.documentElement.clientHeight/2?$("#largeText").css("top",a.pageY+
10):$("#largeText").css("top",a.pageY-$("#largeText").height()-25);a.pageX<document.documentElement.clientWidth/2?$("#largeText").css("left",a.pageX+5):$("#largeText").css("left",a.pageX-20-c.slice(0,-2));"hidden"==$("#largeImage").css("visibility")&&$("#largeImage").css("visibility","visible")}"#largeImage"==b&&(a.pageY<document.documentElement.clientHeight/2?$("#largeImage").css("top",a.pageY+10):$("#largeImage").css("top",a.pageY-$("#largeImage").attr("height")-25),a.pageX<document.documentElement.clientWidth/
2?$("#largeImage").css("left",a.pageX+5):$("#largeImage").css("left",a.pageX-5-$("#largeImage").attr("width")),"hidden"==$("#largeImage").css("visibility")&&$("#largeImage").css("visibility","visible"))}})},searchEvInObjArray:function(a,c,b){var d=this.objectArray[a];if(d)var e=d.actionsL;else log("!!!!!!!!!! searchEvInObjArray this.objectArray["+a+"] = undefined for test = "+b);void 0!=e&&0<e.length&&this.prepareDispatchAction(d,c)},searchEvent:function(a,c,b,d){if("commonBG"==a)var e=this.commonList;
else"currentStep"==a&&(e=this.stepList);this.searchEvent2(e,c,b,d)},searchEvent2:function(a,c,b,d){if(""!=d||"onCheckScore"!=b&&"onCheckStepScore"!=b&&"onStartStep"!=b){if(a.parentId==c){switch(b){case "onShow":if("none"==$("#"+a.id).css("display"))return!1}c=a.actionsL;void 0!=c&&0<c.length&&this.prepareDispatchAction(a,b)}c=a.childsL;if(void 0!=c&&0<c.length){d=c.length;for(var e=0;e<d;++e)this.searchEvent2(c[e],a.id,b)}}else this.prepareDispatchAction(a,b)},prepareDispatchAction:function(a,c){if("clickLink"==
c)for(var b=a.actions.length,d=0;d<b;++d){var e=a.actions[d],f=e[0],g=e[1];this.prepareDispatchAction2(a,f,e,g)}else{var k=a.actionsL,h=k.length;if(0<h)for(var m=0;m<h;++m)for(var l=this.parseActions(k[m]),b=l.length,d=0;d<b;++d)e=l[d],e.event==c&&(f=e[0],g=e[1],this.prepareDispatchAction2(a,f,e,g))}},prepareDispatchAction2:function(a,c,b,d){b[2]=a.id;var e=!0;!0=={goToStepWithId:!0,openWinBlank:!0,openWinSelf:!0,winLocationHref:!0,checkScore:!0,checkStepScore:!0,startTimer:!0,stopTimer:!0,pauseTimer:!0,
resetTimer:!0}[c]?this.doAction(a,b):("onCheckScore"==b.event?e=this.testScore(a,b):"onCheckStepScore"==b.event&&(e=this.testStepScore(a,b)),void 0!=d&&e&&("LABWORK."==b[1].slice(0,8)||"LABWORK"==b[1].slice(0,8)?(b=b.slice(0),b[1]=b[1].slice(8),this.dispatchAction(this.commonList.childsL,b)):(c=b[1].charAt(0),"@"==c?(b[1]=b[1].slice(1),this.doClassAction(b)):"{"==c||"["==c?this.doJsonAction(b):"."==c?"."==b[1].charAt(1)?(b=b.slice(0),b[1]=b[1].slice(2),this.dispatchAction(a.parent.childsL,b)):(b=
b.slice(0),b[1]=b[1].slice(1),this.dispatchAction(a.childsL,b)):this.dispatchAction(this.stepList.childsL,b))))},parseActions:function(a){var c=a.id,b=a.event,d=a.eventParam,e=[],f=null;a=a.content.split(";");for(var g=0;g<a.length;g++){for(var f=a[g].split(":"),k=0;k<f.length;++k)$.trim(f[k]);if(2<f.length)for(k=2;k<f.length;++k)f[1]+=":"+f[k];2==f.length&&(k=f[1].split(","),f=1<k.length?[f[0],k[0],k[1]]:[f[0],f[1]]);null!=f&&(c&&(f.id=c),b&&(f.event=b),d&&(f.eventParam=d),e.push(f))}return e},dispatchAction:function(a,
c){if("string"==typeof c[1]){if("."==c[1].charAt(0)&&"."==c[1].charAt(1)){var b=a[0].parent.parent;if(void 0!=b)c[1]=c[1].slice(2),this.dispatchAction(b.childsL,c);else return alert("Path Error: dispatchAction : theParent == undefined"),!1}else if("."==c[1].charAt(0))return alert("Path Error: dispatchAction : singleAction[1].charAt(0) == '.'"),!1;c[1]=c[1].split(".")}var b=c[1].shift(),d=a.length;if(0<d)for(var e=0;e<d;++e){var f=a[e];f.omsId==b&&(0<c[1].length?this.dispatchAction(f.childsL,c):this.doAction(f,
c))}else alert("Ошибка в написании пути")},doClassAction:function(a){switch(a[0]){case "showObject":$("."+a[1]).trigger("showObject");break;case "hideObject":$("."+a[1]).trigger("hideObject");break;case "resetObject":$("."+a[1]).trigger("resetObject",["."+a[1]]);break;case "resetAllObjects":$("."+a[1]).trigger("resetAllObjects",["."+a[1]]);break;case "checkObject":$("."+a[1]).trigger("checkObject",["."+a[1]]);break;case "checkAllObjects":$("."+a[1]).trigger("checkAllObjects",["."+a[1]]);break;case "openHelpObject":$("."+
a[1]).trigger("openHelpObject");break;case "playObject":$("."+a[1]).trigger("playObject");break;case "pauseObject":$("."+a[1]).trigger("pauseObject");break;case "stopObject":$("."+a[1]).trigger("stopObject");break;case "seekObject":$("."+a[1]).trigger("seekObject",a[2]);break;case "showNext":$("."+a[1]).trigger("showNext",["."+a[1]]);break;case "showPrevious":$("."+a[1]).trigger("showPrevious",["."+a[1]]);break;case "showCurrent":$("."+a[1]).trigger("showCurrent");break;case "disableDraggable":$("."+
a[1]).trigger("disableDraggable");break;case "enableDraggable":$("."+a[1]).trigger("enableDraggable");break;case "pastMonthNameTo":var c=this.getMonth();$("#"+a[1]).text(c);break;case "pastMonthNameRpTo":c=this.getMonthRp();$("#"+a[1]).text(c);break;case "pastDayTo":c=this.getDay();$("#"+a[1]).text(c);break;case "pastHourTo":c=this.getHour();$("#"+a[1]).text(c);break;case "pastMinTo":c=this.getMin();$("#"+a[1]).text(c);break;case "show_result":jQuery.lacerta.account.sowResultAccount();break;case "hide_result":jQuery.lacerta.account.hideResultAccount()}},
doJsonAction:function(a,c){if(c)d=a[1];else{var b=a[1].charAt(0),d=JSON.parse(a[1]);if("["==b){b=[];b[0]=a[0];b[2]=a[2];for(var e=0;e<d.length;e++)b[1]=d[e],this.doJsonAction(b,!0);return!1}}if(void 0!=d.svgId&&""!=d.svgId)return this.parseSVG(d,a[0]),!1;switch(a[0]){case "showObject":var f=d.idList,f=f.split(","),d=parseInt(d.delayTime),d=void 0!=d&&""!=d?d:0;if(0<d)setTimeout(function(){for(var a=0;a<f.length;a++)$("."+f[a]).trigger("showObject")},d);else for(e=0;e<f.length;e++)$("."+f[e]).trigger("showObject");
break;case "hideObject":f=d.idList;f=f.split(",");d=parseInt(d.delayTime);d=void 0!=d&&""!=d?d:0;if(0<d)setTimeout(function(){for(var a=0;a<f.length;a++)$("."+f[a]).trigger("hideObject")},d);else for(e=0;e<f.length;e++)$("."+f[e]).trigger("hideObject");break;case "playObject":f=d.idList;f=f.split(",");d=parseInt(d.delayTime);d=void 0!=d&&""!=d?d:0;if(0<d)setTimeout(function(){for(var a=0;a<f.length;a++)$("."+f[a]).trigger("playObject")},d);else for(e=0;e<f.length;e++)$("."+f[e]).trigger("playObject");
break;case "stopObject":f=d.idList;f=f.split(",");d=parseInt(d.delayTime);d=void 0!=d&&""!=d?d:0;if(0<d)setTimeout(function(){for(var a=0;a<f.length;a++)$("."+f[a]).trigger("stopObject")},d);else for(e=0;e<f.length;e++)$("."+f[e]).trigger("stopObject");break;case "pauseObject":f=d.idList;f=f.split(",");d=parseInt(d.delayTime);d=void 0!=d&&""!=d?d:0;if(0<d)setTimeout(function(){for(var a=0;a<f.length;a++)$("."+f[a]).trigger("pauseObject")},d);else for(e=0;e<f.length;e++)$("."+f[e]).trigger("pauseObject");
break;case "addClassToObjL":b=d.id;theId="this"==b||void 0==b||""==b?"#"+a[2]:"."+b;d=d.className;d=d.replace(RegExp(",","g")," ");$(theId).addClass(d);break;case "removeClassFromObjL":b=d.id;theId="this"==b||void 0==b||""==b?"#"+a[2]:"."+b;d=d.className;d=d.replace(RegExp(",","g")," ");$(theId).removeClass(d);break;case "replaceClassInObjL":b=d.id;theId="this"==b||void 0==b||""==b?"#"+a[2]:"."+b;b=d.oldClassName;b=b.replace(RegExp(",","g")," ");d=d.newClassName;d=d.replace(RegExp(",","g")," ");$(theId).removeClass(b).add(d);
break;case "insertObjInto":b=d.id;theId="this"==b||void 0==b||""==b?"#"+a[2]:"."+b;e="."+d.parentId;b=d.offsetX||0;d=d.offsetY||0;$(theId).appendTo(e);$(theId).css("left",b);$(theId).css("top",d);break;case "moveObjectTo":b=d.id;theId="this"==b||void 0==b||""==b?"#"+a[2]:"."+b;var e=d.time||0,g=d.targetId,g=void 0!=g&&""!=g?g:!1,k=d.w||0,h=d.h||0;if(!1==g)var m=d.x*gScaleValue||0,l=d.y*gScaleValue||0;else b=$("."+g).position(),m=b.left,l=b.top;var b=d.offsetX*gScaleValue||0,d=d.offsetY*gScaleValue||
0,n={};!1==g&&0==m&&0==l?(n.left="+="+b,n.top="+="+d):(n.left=m+b,n.top=l+d);0!=k&&(n.width=k*gScaleValue);0!=h&&(n.height=h*gScaleValue);this.listAnimationObj[theId]=new this.prepareAnimation(theId,n,e);this.listAnimationObj.n+=1}},listAnimationObj:{n:0},prepareAnimation:function(a,c,b){var d=this;d.theId=a;d.time=b;d.theObj=c;d.oldDepth=$(d.theId).css("z-index");$(d.theId).css("z-index",1100);$(d.theId).animate(d.theObj,d.time,function(){$(d.theId).css("z-index",d.oldDepth);jQuery.lacerta.actions.listAnimationObj[d.theId]=
void 0;jQuery.lacerta.actions.listAnimationObj.n-=1});return d},parseSVG:function(a,c){var b=a.idList,d=document.getElementsByClassName(a.svgId)[0].contentDocument,b=a.idList,b=b.split(",");switch(c){case "showObject":case "svgIdShow":var e=parseInt(a.delayTime),e=void 0!=e&&""!=e?e:0;if(0<e)setTimeout(function(){for(var a=0;a<b.length;a++)d.getElementById(b[a]).setAttribute("style","display:inline")},e);else for(e=0;e<b.length;e++){var f=d.getElementById(b[e]);f.setAttribute("style","display:inline")}break;
case "hideObject":case "svgIdHide":if(e=parseInt(a.delayTime),e=void 0!=e&&""!=e?e:0,0<e)setTimeout(function(){for(var a=0;a<b.length;a++)d.getElementById(b[a]).setAttribute("style","display:none")},e);else for(e=0;e<b.length;e++)f=d.getElementById(b[e]),f.setAttribute("style","display:none")}},getMonth:function(){var a=(new Date).getUTCMonth(),c=Array(12);c[0]="январь";c[1]="февраль";c[2]="март";c[3]="апрель";c[4]="май";c[5]="июнь";c[6]="июль";c[7]="август";c[8]="сентябрь";c[9]="октябрь";c[10]="ноябрь";
c[11]="декабрь";return c[a]},getMonthRp:function(){var a=(new Date).getUTCMonth(),c=Array(12);c[0]="января";c[1]="февраля";c[2]="марта";c[3]="апреля";c[4]="мая";c[5]="июня";c[6]="июля";c[7]="августа";c[8]="сентября";c[9]="октября";c[10]="ноября";c[11]="декабря";return c[a]},getDay:function(){return(new Date).getUTCDate()},getHour:function(){return(new Date).getHours()},getMin:function(){var a=(new Date).getMinutes();10>1*a&&(a="0"+a);return a},testScore:function(a,c){var b=c.eventParam.split(":");
if(0<b.length){if("timeOver"==b[0])return jQuery.lacerta.timers.checkIfTimeOver(b[1]);var d=jQuery.lacerta.calculation.getScore();return parseInt(b[0])<=d&&d<=parseInt(b[1])?!0:!1}},testStepScore:function(a,c){var b=c.eventParam.split(":");if(0<b.length){if("timeOver"==b[0])return jQuery.lacerta.timers.checkIfTimeOver(b[1]);var d=jQuery.lacerta.calculation.getStepScore();return parseInt(b[0])<=d&&d<=parseInt(b[1])?!0:!1}},doAction:function(a,c,b){b="";"object"==typeof a&&(b=a.id);switch(c[0]){case "showObject":$("#"+
b).trigger("showObject");break;case "showObjectOnly":$("#"+a.parentId).children().css("display","none");$("#"+b).trigger("showObject");break;case "hideObject":$("#"+b).trigger("hideObject");break;case "playObject":$("#"+b).trigger("playObject");break;case "pauseObject":$("#"+b).trigger("pauseObject");break;case "stopObject":$("#"+b).trigger("stopObject");break;case "seekObject":$("#"+b).trigger("seekObject",c[2]);break;case "disableDraggable":$("."+c[1]).trigger("disableDraggable");break;case "enableDraggable":$("."+
c[1]).trigger("enableDraggable");break;case "openWinBlank":jQuery.lacerta.navigation.openLink("_blank",c[1]);break;case "openWinSelf":jQuery.lacerta.navigation.openLink("_self",c[1]);break;case "winLocationHref":jQuery.lacerta.navigation.openLink("_href",c[1]);break;case "goToStepWithId":jQuery.lacerta.navigation.showStepWithId(c[1]);break;case "startTimer":jQuery.lacerta.timers.startTimer(c[1]);break;case "stopTimer":jQuery.lacerta.timers.stopTimer(c[1]);break;case "pauseTimer":jQuery.lacerta.timers.pauseTimer(c[1]);
break;case "resetTimer":jQuery.lacerta.timers.restartTimer(c[1]);break;case "checkStepScore":jQuery.lacerta.actions.searchEvent("currentStep","currentStep","onCheckStepScore","");break;case "checkScore":jQuery.lacerta.actions.searchEvent("currentStep","currentStep","onCheckScore","")}}};jQuery.lacerta.effects={effects:{},parseEffects:function(a,c){this_=this;var b=$(c).children("effects");if(b.length){var d=$(b).children("effect");$.each(d,function(b,c){var g=d[b],k=$(g).attr("id"),h=$(g).attr("event"),g=$(g).text();this_.bindEffect(a,{id:k,event:h,content:g})})}},bindEffect:function(a,c){var b=c.event,d=c.content,d=this.parseContent(d);switch(d.type){case "fade":"onShow"==b?($("#"+a).unbind("showObject"),$("#"+a).bind("showObject",function(b){b.stopPropagation();$("#"+a).fadeIn();
b=$("#"+a).children();if(0<b.length)jQuery.lacerta.effects.onChildFadeIn(b)})):"onHide"==b&&($("#"+a).unbind("hideObject"),$("#"+a).bind("hideObject",function(b){b.stopPropagation();$("#"+a).fadeOut();b=$("#"+a).children();if(0<b.length)jQuery.lacerta.effects.onChildFadeOut(b)}));break;case "move":var e;"onShow"==b?e="showObject":"onHide"==b&&(e="hideObject");$("#"+a).bind(e,function(b){b.stopPropagation();moveX="+="+d.params[0]+"px";moveY="+="+d.params[1]+"px";$("#"+a).animate({left:moveX,top:moveY},
"slow")})}},onChildFadeIn:function(a){$.each(a,function(a,b){var d=$(b);d.fadeIn();d=d.children();if(0<d.length)jQuery.lacerta.effects.onChildFadeIn(d)})},onChildFadeOut:function(a){$.each(a,function(a,b){var d=$(b);d.fadeOut();d=d.children();if(0<d.length)jQuery.lacerta.effects.onChildFadeOut(d)})},onChildShow:function(a){$.each(a,function(a,b){var d=$(b);d.show();d=d.children();if(0<d.length)jQuery.lacerta.effects.onChildShow(d)})},onChildHide:function(a){$.each(a,function(a,b){var d=$(b);d.hide();
d=d.children();if(0<d.length)jQuery.lacerta.effects.onChildHide(d)})},parseContent:function(a){if(a=a.split(":"))var c=a[0],b=a[1].split(",");return a={type:c,params:b}}};/*
  
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 entry.lacerta.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
var SCORM_Enabled=!1,isTouchScreen=!1,gPortraitMode="undefined"!=typeof gPortraitMode?gPortraitMode:"auto";if("auto"==gPortraitMode)var ua=navigator.userAgent.toLowerCase(),isTouchScreen="createTouch"in document||699>=screen.width||ua.match(/(iPhone|iPod|iPad)/)||ua.match(/BlackBerry/)||ua.match(/Android/)||"touch"==ua.match(/touch/);else"off"==gPortraitMode?isTouchScreen=!1:"on"==gPortraitMode&&(isTouchScreen=!0);
var loadedFlag=0,gScreenMode="",gClientHeight=document.documentElement.clientHeight,gClientWidth=document.documentElement.clientWidth,gScaleValue=1,gLandscapeW="undefined"!=typeof gLandscapeW?1*gLandscapeW:950,gLandscapeH="undefined"!=typeof gLandscapeH?1*gLandscapeH:570,gPortraitW="undefined"!=typeof gPortraitW?1*gPortraitW:640,gPortraitH="undefined"!=typeof gPortraitH?1*gPortraitH:860,testScroll=function(a){var c=a.document;if(!location.hash&&a.addEventListener){window.scrollTo(0,1);var b=1,d=function(){return a.pageYOffset||
"CSS1Compat"===c.compatMode&&c.documentElement.scrollTop||c.body.scrollTop||0},e=setInterval(function(){c.body&&(clearInterval(e),b=d(),a.scrollTo(0,1===b?0:1))},15);a.addEventListener("load",function(){setTimeout(function(){20>d()&&a.scrollTo(0,1===b?0:1)},0)})}};
$(document).ready(function(){$.browser={};var a=navigator.userAgent;if(/Firefox[\/\s](\d+\.\d+)/.test(a)){var c=new Number(RegExp.$1);$.browser.mozilla=!0;$.browser.version=c;3.5>c&&($.browser.version=3)}else/MSIE (\d+\.\d+);/.test(a)&&(c=new Number(RegExp.$1),a=a.search(/Trident/i),$.browser.msie=!0,$.browser.version=c,8>c&&0>a&&(showMessage=1,messageSrc="message.htm"));loadedFlag=1;testClientSize();toggleScreenCSS();jQuery.lacerta.scorm&&(SCORM_Enabled=jQuery.lacerta.scorm.initSCORM());$.lacerta.controls.getData("controls");
$.lacerta.loader.loadLabXML("labwork")});
var testClientSize=function(){"undefined"==typeof gMobileScalingFactor&&(gMobileScalingFactor={small:0.5,middle:0.95,normal:1,big:1});"undefined"==typeof gMobileScalingFactor.small&&(gMobileScalingFactor.small=0.5);"undefined"==typeof gMobileScalingFactor.middle&&(gMobileScalingFactor.middle=0.95);"undefined"==typeof gMobileScalingFactor.normal&&(gMobileScalingFactor.normal=1);"undefined"==typeof gMobileScalingFactor.big&&(gMobileScalingFactor.big=1);if((850>gClientHeight&&550>gClientWidth||550>gClientHeight&&
850>gClientWidth)&&!0==isTouchScreen){if(gScaleValue=gMobileScalingFactor.small,"undefined"!=typeof gMobileSmallCSS){var a=$('<link rel="stylesheet" />');a.attr("href",gMobileSmallCSS)}}else(1E3<gClientHeight||1200<gClientWidth)&&!0==isTouchScreen?(gScaleValue=gMobileScalingFactor.big,"undefined"!=typeof gMobileBigCSS&&(a=$('<link rel="stylesheet" />'),a.attr("href",gMobileBigCSS))):(900<gClientHeight&&700<gClientWidth||650<gClientHeight&&1E3<gClientWidth)&&!0==isTouchScreen?(gScaleValue=gMobileScalingFactor.normal,
"undefined"!=typeof gMobileNormalCSS&&(a=$('<link rel="stylesheet" />'),a.attr("href",gMobileNormalCSS))):!0==isTouchScreen?(gScaleValue=gMobileScalingFactor.middle,"undefined"!=typeof gMobileMiddleCSS&&(a=$('<link rel="stylesheet" />'),a.attr("href",gMobileMiddleCSS))):!0!=isTouchScreen&&"undefined"!=typeof gMobileNormalCSS&&""!=gMobileNormalCSS&&(a=$('<link rel="stylesheet" />'),a.attr("href",gMobileNormalCSS));"undefined"!=typeof a&&$("head").append(a)};window.onunload=function(){terminateSession()};
window.onbeforeunload=function(){terminateSession()};
var currentScreenMode="",toggleScreenCSS=function(){if(loadedFlag)if(!0==isTouchScreen){$("html").css("height","100%");$("html").css("width","100%");gClientHeight=document.documentElement.clientHeight;gClientWidth=document.documentElement.clientWidth;var a=0;""==gScreenMode&&(a=1,$("div#scene").css({position:"relative"}));if(gClientWidth>=gClientHeight){var c=1*gClientHeight-gLandscapeH*gScaleValue,c=0<=c?Math.round(c/2)+"px":"0px";gScreenMode="L";$("div#scene").css({height:gLandscapeH*gScaleValue+
"px",width:gLandscapeW*gScaleValue+"px","margin-top":c})}else c=1*gClientHeight-gPortraitH*gScaleValue,c=0<=c?Math.round(c/2)+"px":"0px",gScreenMode="P",$("div#scene").css({height:gPortraitH*gScaleValue+"px",width:gPortraitW*gScaleValue+"px","margin-top":c});currentScreenMode!=gScreenMode&&(jQuery.lacerta.hint.removeHint(),currentScreenMode=gScreenMode);a||jQuery.lacerta.design.resetParam();0.6>gScaleValue&&jQuery.lacerta.hint.setMargenTop(c);testScroll(this)}else""==gScreenMode&&(gScreenMode="L",
$("div#scene").css({position:"static"})),a=gLandscapeH*gScaleValue,gClientHeight=document.documentElement.clientHeight,gClientWidth=document.documentElement.clientWidth,$("html").css("height","100%"),gClientHeight>=a?$("div#scene").css({height:gLandscapeH*gScaleValue+"px",width:gLandscapeW*gScaleValue+"px","margin-top":(gClientHeight-a)/2+"px"}):($("html").css({height:"auto",width:"auto"}),$("body").css({height:"auto",width:"auto"}),$("#scene").css({left:"auto",top:"auto",margin:"0 auto"}))},processedUnload=
!1;function terminateSession(a){SCORM_Enabled&&!0==processedUnload||(processedUnload=!0,jQuery.lacerta.calculation.terminateCalculation(),jQuery.lacerta.scorm.doExit())}function log(a){}function dir(a){}function log2(a){};jQuery.lacerta.timers={timersObjList:{},warningActionObjList:{},overActionObjList:{},timersIdList:[],globalTimer:0,onRunTimersNum:0,stateRun:0,gIntervalObj:0,currentStepId:"",setTimer:function(a){var c=$(a).attr("id");if(void 0==c||""==c)if(0==this.globalTimer)c="GLOBAL",this.globalTimer=1;else return alert("Глобальный таймер может быть один. Идентификатор timer id должен быть определен"),!1;var b=$(a).attr("targetStepId");if(void 0==b||""==b)b="currentStep";var d=$(a).attr("autostart")||"false",
e=0;"false"!=d&&"currentStep"==b&&(this.addTimer(),e=1);var f=parseInt($(a).attr("timeOver"));if(isNaN(f))return alert('Время срабатывания таймера id = "'+c+'" должно быть определено'),!1;var g=parseInt($(a).attr("timeWarning"));isNaN(g)&&(g=f);var k=$(a).attr("units")||"min",b={id:c,autostart:d,autoreset:$(a).attr("autoreset")||"false",units:k,currentSec:0,currentMin:0,tStateRun:e,timeViewerTextId:$(a).attr("timeViewerTextId")||!1,targetStep:b,timeOver:f,timeWarning:g};this.loadActions(a,c);this.timersObjList[c]=
b;this.timersIdList.push(c)},loadActions:function(a,c){var b=[],d=[],e=$(a).children("actions");if(e.length){var f=$(e).children("action");$.each(f,function(a,c){var e=f[a],m=$(e).attr("event"),l=$(e).attr("event"),n=$(e).attr("eventParam"),e=$(e).text(),e=jQuery.lacerta.utils.replaceString(e,"\r",""),e=jQuery.lacerta.utils.replaceString(e,"\t",""),e=jQuery.lacerta.utils.replaceString(e,"\n",""),e=e.split(";"),m={id:m,event:l,eventParam:n,content:e};"onWarning"==l&&b.push(m);"onOver"==l&&d.push(m)});
0<b.length&&(this.warningActionObjList[c]=b);0<d.length&&(this.overActionObjList[c]=d)}},checkIfTimeOver:function(a){return-1==this.timersObjList[a].tStateRun?!0:!1},startTimer:function(a){a=this.timersObjList[a];if(0==a.tStateRun||-1==a.tStateRun)a.tStateRun=1,this.addTimer(),!1!=a.timeViewerTextId&&$("."+a.timeViewerTextId).show(),0==this.stateRun&&this.runInterval()},stopTimer:function(a){a=this.timersObjList[a];a.tStateRun=0;this.removeTimer();!1!=a.timeViewerTextId&&$("."+a.timeViewerTextId).hide()},
pauseTimer:function(a){a=this.timersObjList[a];1==a.tStateRun&&(a.tStateRun=0)},resetTimer:function(a){a=this.timersObjList[a];a.currentSec=0;a.currentMin=0},resetTimers:function(){for(var a=this.timersIdList,c=a.length,b=0;b<c;b++){var d=this.timersObjList[a[b]];"true"!=d.autoreset||d.targetStep!=this.currentStepId&&"currentStep"!=d.targetStep||(d.currentSec=0,d.currentMin=0,"false"!=d.autostart&&0==stateRun&&this.startTimer(d.id))}},iteration:function(){for(var a=this.timersIdList,c=a.length,b=
0;b<c;b++){var d=this.timersObjList[a[b]],e=0;if(1==d.tStateRun){var f="";"min"==d.units?(!1!=d.timeViewerTextId&&(f=(d.timeOver-d.currentMin-1).toString()+":"+(60-d.currentSec).toString(),$("."+d.timeViewerTextId).text(f)),60==d.currentSec&&(d.currentSec=0,++d.currentMin,e=d.currentMin)):(e=d.currentSec,!1!=d.timeViewerTextId&&(f=(d.timeOver-d.currentSec).toString(),$("."+d.timeViewerTextId).text(f)));d.timeWarning<d.timeOver&&d.timeWarning<=e&&(d.timeWarning=d.timeOver,d.targetStep!=this.currentStepId&&
"currentStep"!=d.targetStep||this.runActions(a[b],"warning"));d.timeOver<=e&&(d.tStateRun=-1,this.removeTimer(),d.targetStep!=this.currentStepId&&"currentStep"!=d.targetStep||this.runActions(a[b],"over"));++d.currentSec}}},runActions:function(a,c){if("over"==c)var b=this.overActionObjList[a];else"warning"==c&&(b=this.warningActionObjList[a]);if("object"==typeof b)for(var d=0;d<b.length;d++){var e=b[d].content;if(0<e.length)for(var f=0;f<e.length;f++){var g=e[f],g=g.split(":");if(2<g.length)for(var k=
2;k<g.length;++k)g[1]+=":"+g[k];1<g.length&&$.lacerta.actions.prepareDispatchAction2("",g[0],g,1)}}},checkQuiz:function(a){if(a.answeredCount==parseInt(a.questionCount)){a=a.actionsObjArr;for(var c=0;c<a.length;c++);}},runInterval:function(){this.gIntervalObj=setInterval(function(){jQuery.lacerta.timers.iteration()},1E3);this.stateRun=1},initTimers:function(a){0<this.onRunTimersNum&&0==this.stateRun&&this.runInterval();this.currentStepId=a;this.resetTimers()},addTimer:function(){++this.onRunTimersNum},
removeTimer:function(){--this.onRunTimersNum;0>=this.onRunTimersNum&&(clearInterval(this.gIntervalObj),this.stateRun=this.onRunTimersNum=0)}};jQuery.lacerta.timer={startTimeStamp:void 0,endTimeStamp:void 0,startTimer:function(){"undefined"!=this.startTimeStamp&&(this.startTimeStamp=new Date);return this.startTimeStamp},receiveSessionTime:function(){return new Date},getCurrentTime:function(){return new Date},translateSecondsToString:function(a){var c="",b,d,e;a=Math.floor(a/10);e=Math.floor(a/36E4);a-=36E4*e;d=Math.floor(a/6E3);a-=6E3*d;b=Math.floor(a/100);0<a-100*b+b+d+e&&(c=0<e?10>e?c+("0"+e+":"):c+(e+":"):c+"00:",c=0<d?10>d?c+("0"+d+
":"):c+(d+":"):c+"00:",c=0<b?10>b?c+("0"+b):c+(b+""):c+"00");""==c&&(c="00:00:00");return c}};jQuery.lacerta.scorm={_debug:!1,APIinit:void 0,startTimeStamp:void 0,exerciseFinished:!1,allStepsCount:0,visitedStepsCount:0,visitedStepsIdArray:[],resultStr:"0",transmitErroData:function(a,c,b){},initSCORM:function(){this.startTimeStamp=jQuery.lacerta.timer.startTimer();"false"==terminated&&void 0==this.APIinit&&(this.APIinit=initializeCommunication());return"false"!=this.APIinit?!0:!1},terminateSCORM:function(a){if("false"!=this.APIinit&&"true"!=terminated){var c=jQuery.lacerta.timer.getCurrentTime().getTime()-
this.startTimeStamp.getTime(),c=this.ConvertMilliSecondsIntoSCORM2004Time(c);storeDataValue("cmi.session_time",c);!1==a&&!1==this.exerciseFinished&&storeDataValue("cmi.exit","suspend");terminated=terminateCommunication()}},doExit:function(){"false"!=this.APIinit&&(!1==this.exerciseFinished&&confirm("Сохранить данные для дальнейшей работы")?storeDataValue("cmi.exit","suspend"):storeDataValue("cmi.exit",""));this.terminateSCORM(!0)},updateGlobalParam:function(a,c){"false"!=this.APIinit&&(storeDataValue("cmi.completion_status",
a.completion_status),storeDataValue("cmi.progress_measure",a.progress_measure),storeDataValue("cmi.success_status",a.success_status),storeDataValue("cmi.score.scaled",a.score_scaled),c&&(storeDataValue("cmi.score.min",a.score_min),storeDataValue("cmi.score.max",a.score_max)),storeDataValue("cmi.score.raw",a.score_raw))},updateObjectiveParam:function(a){"false"!=this.APIinit&&(storeDataValue("cmi.objectives."+a.n+".id",a.id),storeDataValue("cmi.objectives."+a.n+".progress_measure",a.progress_measure),
storeDataValue("cmi.objectives."+a.n+".completion_status",a.completion_status),storeDataValue("cmi.objectives."+a.n+".success_status",a.success_status),storeDataValue("cmi.objectives."+a.n+".score.scaled",a.score_scaled),storeDataValue("cmi.objectives."+a.n+".score.min",a.score_min),storeDataValue("cmi.objectives."+a.n+".score.max",a.score_max),storeDataValue("cmi.objectives."+a.n+".score.raw",a.score_raw))},updateObjectiveCompletion_status:function(a,c){storeDataValue("cmi.objectives."+a+".completion_status",
c)},recordDataForNewStep:function(a){-1==jQuery.lacerta.utils.getOne(a,this.visitedStepsIdArray)&&(this.visitedStepsIdArray.push(a),this.visitedStepsCount++,this.visitedStepsCount<this.allStepsCount?(storeDataValue("cmi.completion_status","incomplete"),storeDataValue("cmi.success_status","failed")):this.visitedStepsCount==this.allStepsCount&&(storeDataValue("cmi.completion_status","completed"),storeDataValue("cmi.success_status","passed")),this.exerciseFinished=!0,resultValue=this.visitedStepsCount/
this.allStepsCount,this.resultStr=resultValue.toFixed(2),storeDataValue("cmi.progress_measure",this.resultStr),persistData())},ConvertMilliSecondsIntoSCORM2004Time:function(a){var c="",b,d,e,f,g,k;a=Math.floor(a/10);k=Math.floor(a/315576E4);a-=315576E4*k;g=Math.floor(a/26298E4);a-=26298E4*g;f=Math.floor(a/864E4);a-=864E4*f;e=Math.floor(a/36E4);a-=36E4*e;d=Math.floor(a/6E3);a-=6E3*d;b=Math.floor(a/100);a-=100*b;0<k&&(c+=k+"Y");0<g&&(c+=g+"M");0<f&&(c+=f+"D");0<a+b+d+e&&(c+="T",0<e&&(c+=e+"H"),0<d&&
(c+=d+"M"),0<a+b&&(c+=b,0<a&&(c+="."+a),c+="S"));""==c&&(c="0S");return"P"+c}};jQuery.lacerta.slideshow={allSlideShowL:[],currentSlideshow:0,nextTimeout:null,purgeSlideshow:function(a){a=this.allSlideShowL.length;for(var c=0;c<a;c++){var b=this.allSlideShowL[c];$("#"+b.slideShowDivId+" div").empty();$("#"+b.slideShowDivId).empty();clearTimeout(b.nextTimeout);b.nextTimeout=void 0}allSlideShowL=[]},composeSlideshow:function(a){var c=this,b=a.dom;a.templateId="slideshow";var d=jQuery.lacerta.design.putGroupeToHTML(a,"slideshow_"),e=$(b).attr("visible"),f=$(b).attr("playing");a=
a.keyId;var g=$(b).children("settings"),k=$(g).children("control"),h=k.attr("style"),k=void 0!=h&&""!=h?{dom:k,parentId:d,sectionType:"control",keyId:a}:void 0,m=$(g).children("general"),g=$(m).attr("mode"),h=$(m).attr("activeFrame"),l=$(m).attr("rewindOnPlayed"),m=$(m).attr("loop"),g={mode:void 0!=g&&""!=g?g:"normal",activeFrame:void 0!=h&&""!=h?h:1,loop:void 0!=m&&""!=m?m:"false",rewindOnPlayed:void 0!=l&&""!=l?l:"false"},b=$(b).children("frames"),b=$(b).children();a={dom:"",parentId:d,sectionType:"frame",
keyId:a,templateName:"frame"};var h=b.length,n=[],p=[],r=[];$.each(b,function(a,b){n[a]=$(this).attr("duration");p[a]=$(this).attr("id")||"frameNumber_"+a;r[a]=$("actions",this).find("action")});var s={id:"",slideShowDivId:d,playing:f,playedState:!1,visible:!1,controlRes:k,generalParams:g,frameRes:a,frameObjList:b,durationArray:n,frClassArray:p,frameActionL:r,previousFrameNum:void 0,currentFrameNum:0,framesLength:h,videoCount:0,videoReady:0,nextTimeout:null,frameIdL:[]};this.allSlideShowL.push(s);
$("#"+d).bind("showObject",function(a){c.showSlideshow(s)});$("#"+d).bind("hideObject",function(a){c.stopSlideshow(s);c.hideSlideshow(s)});"true"==e&&this.showSlideshow(s)},showSlideshow:function(a){var c=this;c.hideSlideshow(a);a.visible=!0;if(void 0!=a.controlRes){var b=jQuery.lacerta.controls.findControl(a.controlRes);$("#"+b).show();$("#"+b+" > .previous").bind("click",function(b){c.showPreviousItem(a);clearTimeout(a.nextTimeout);a.nextTimeout=void 0});$("#"+b+" > .previous").css("cursor","pointer");
$("#"+b+" > .next").bind("click",function(b){c.showNextItem(a);clearTimeout(a.nextTimeout);a.nextTimeout=void 0});$("#"+b+" > .next").css("cursor","pointer");$("#"+b+" > .showlist").bind("click",function(b){c.playSlideshow(a)})}a.currentFrameNum=a.generalParams.activeFrame-1;"normal"==a.generalParams.mode&&"true"==a.playing&&0==a.videoCount&&(a.playedState=!0);this.showCurrentItem(a)},hideSlideshow:function(a){a.visible=!1;this.stopSlideshow(a);var c=a.frameIdL[a.previousFrameNum],b=a.frameIdL[a.currentFrameNum];
void 0!=c&&$("#"+c).hide();void 0!=b&&$("#"+b).hide();$("#"+a.slideShowDivId+" div").hide()},onElementPlayed:function(a,c){for(var b=0;b<this.allSlideShowL.length;b++)this.allSlideShowL[b].slideShowDivId==c&&(this.allSlideShowL[b].videoReady++,this.allSlideShowL[b].videoReady==this.allSlideShowL[b].videoCount&&this.showNextItem(this.allSlideShowL[b]))},playSlideshow:function(a){clearTimeout(a.nextTimeout);a.nextTimeout=void 0;a.playedState=!0;a.nextTimeout=setTimeout(function(){jQuery.lacerta.slideshow.showNextItem(a)},
a.durationArray[a.currentFrameNum])},stopSlideshow:function(a){a.playedState&&(a.playedState=!1,clearTimeout(a.nextTimeout),a.nextTimeout=void 0)},showCurrentItem:function(a,c){clearTimeout(a.nextTimeout);a.nextTimeout=void 0;a.videoCount=0;a.videoReady=0;var b=a.frameObjList[a.currentFrameNum];if("frame"==b.nodeName){var d=a.frameIdL[a.previousFrameNum],e=a.frameIdL[a.currentFrameNum];void 0==e?(a.frameRes.dom=b,e=jQuery.lacerta.design.composeGroupe(a.frameRes,"slideshow"),a.frameIdL[a.currentFrameNum]=
e,void 0!=d&&$("#"+d).trigger("hideObject")):$("#"+d).trigger("hideObject");$("#"+e).trigger("showObject");this.startActions(a.frameActionL[a.currentFrameNum],"onStartFrame",e);0<=parseInt(a.durationArray[a.currentFrameNum])&&a.playedState&&(a.nextTimeout=setTimeout(function(){jQuery.lacerta.slideshow.showNextItem(a)},a.durationArray[a.currentFrameNum]))}},showNextItem:function(a){a.previousFrameNum=a.currentFrameNum;++a.currentFrameNum;a.currentFrameNum>=a.framesLength?(a.currentFrameNum=0,"false"==
a.generalParams.loop?"true"==a.generalParams.rewindOnPlayed?(a.playedState=!1,this.showCurrentItem(a)):this.stopSlideshow(a):this.showCurrentItem(a)):this.showCurrentItem(a)},showPreviousItem:function(a){a.previousFrameNum=a.currentFrameNum;--a.currentFrameNum;0>a.currentFrameNum&&(a.currentFrameNum=a.framesLength-1);this.showCurrentItem(a)},countVideos:function(a,c){$.each(c,function(b){"video"!=c[b].nodeName&&"audio"!=c[b].nodeName||a.videoCount++});return a.videoCount},startActions:function(a,
c,b,d){d=a.length;for(var e=0;e<d;e++){var f=$(a[e]).attr("event");if(f==c){$.lacerta.actions.searchEvInObjArray(b,f);break}}}};jQuery.lacerta.input={inputL:[],check_res_is_true:!1,timer:null,checkedGroup:0,GroupCounts:0,parseInput:function(a,c,b,d,e){d=$("."+c+" > input");var f=$("param",b),g=this;b=f.attr("checkText");var k=f.attr("checkType");k||(k="text");f="after"==f.attr("checkMode")?!0:!1;b||(b="an_empty_string");var h={obj:d,divClass:c,divId:a,testerId:e,checkText:b,checkType:k,checkMode:f,lastStateCheck:0};this.inputL.push(h);h.obj.bind("keydown",function(a){$.lacerta.actions.searchEvInObjArray(h.divId,"onKeyDown")});
h.obj.bind("keyup",function(a){$.lacerta.actions.searchEvInObjArray(h.divId,"onKeyUp");!1==h.checkMode&&g.checkObject(h)});$("."+h.divClass).bind("resetObject",function(a){a.stopPropagation();h.obj.attr("disabled",!1);h.lastStateCheck=0;h.obj.val("")});$("."+h.divClass).bind("checkObject",function(a,b){a.stopPropagation();var c=!1;(c=g.checkObject(h))&&g.checkedGroup++;b&&(g.GroupCounts++,g.GroupCounts==b.count&&(g.checkedGroup==b.count&&$.lacerta.actions.searchEvInObjArray(b.id,"onAllInputBoxCompleteActions"),
g.GroupCounts=0,g.checkedGroup=0))});$("."+h.divClass).bind("enableObject",function(a){a.stopPropagation();g.enableObject(h.obj)});$("."+h.divClass).bind("disableObject",function(a){a.stopPropagation();g.disableObject(h.obj)})},disableObject:function(a){a.attr("disabled",!0)},enableObject:function(a){a.attr("disabled",!1)},checkObject:function(a){!1==a.checkMode&&clearTimeout(this.timer);_this=this;var c=a.obj;if(a.checkText){if("an_empty_string"==a.checkText)""==a.obj.val()?($.lacerta.actions.searchEvInObjArray(a.divId,
"onInputBoxCompleteActions"),this.disableObject(c),a.lastStateCheck=1):!1==a.checkMode?this.timer=setTimeout(function(){a.lastStateCheck=2;$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions")},2E3):(a.lastStateCheck=2,$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions"));else if("regex"==a.checkType){var b=!1;try{b=eval(a.checkText).test(a.obj.val())}catch(d){log("Regular exspression error: "+d)}b?($.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxCompleteActions"),
this.disableObject(c),a.lastStateCheck=1):!1==a.checkMode?this.timer=setTimeout(function(){a.lastStateCheck=2;$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions")},2E3):(a.lastStateCheck=2,$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions"))}else if("range"==a.checkType){if(parseFloat(a.obj.val())){for(var b=a.obj.val().replace(",","."),e=a.checkText.split("|"),f=0;f<e.length;f++){e[f]=e[f].replace(",",".");e[f]=e[f].replace(",",".");var g=!1,k=e[f].indexOf("..");
if(-1<k){var h=!1,m=e[f].charAt(0),l=e[f].slice(1,k);switch(m){case "[":parseFloat(b)<parseFloat(l)&&(h=!0);break;case "(":parseFloat(b)<=parseFloat(l)&&(h=!0)}if(!1==h)switch(m=e[f].charAt(e[f].length-1),k=e[f].slice(k+2,e[f].length-1),m){case "]":parseFloat(b)>parseFloat(k)&&(h=!0);break;case ")":parseFloat(b)>=parseFloat(k)&&(h=!0)}!1==h&&(g=!0)}else b==e[f]&&(g=!0);!0==g&&($.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxCompleteActions"),this.disableObject(c),a.lastStateCheck=1)}!1==g&&
(!1==a.checkMode?this.timer=setTimeout(function(){a.lastStateCheck=2;$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions")},2E3):(a.lastStateCheck=2,$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions")))}}else a.obj.val()&&a.checkText.toLowerCase()==a.obj.val().toLowerCase()?($.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxCompleteActions"),this.disableObject(c),a.lastStateCheck=1):!1==a.checkMode?this.timer=setTimeout(function(){a.lastStateCheck=2;$.lacerta.actions.searchEvInObjArray(a.divId,
"onInputBoxWrongActions")},2E3):(a.lastStateCheck=2,$.lacerta.actions.searchEvInObjArray(a.divId,"onInputBoxWrongActions"));""!=a.testerId&&jQuery.lacerta.tester.checkTest({testerId:a.testerId,elementId:a.divId,elementClass:a.divClass,lastStateCheck:a.lastStateCheck,hintEvent:void 0});if(1==a.lastStateCheck)return!0}return!1}};jQuery.lacerta.questions={globalArray:[],composeQuestions:function(a){var c=this,b=a.dom,d=jQuery.lacerta.design.putGroupeToHTML(a,"questions"),e=$(b).children("scoring"),f=parseFloat($(e).attr("weight"))||1,e=$(b).attr("visible"),g=$(b).children("param"),k=$(g).children("questions"),h=$(g).children("answers"),m=$(g).children("checkbox"),l=$(g).children("radio")||m,g=$(g).children("links");if($(g).attr("stroke_color")){var n=$(g).attr("stroke_color").split(",");4!=n.length&&(n=["#7F9FA3","#0f0","#f00",
"#00f"])}var n={lineWidth:$(g).attr("lineWidth")||1,strokeL:n},p={checkMode:$(k).attr("checkMode")||void 0,random:$(k).attr("random"),total:$(k).attr("total"),allowMultiple:$(k).attr("allowMultiple"),allowSelection:$(k).attr("allowSelection"),selectionCycling:$(k).attr("selectionCycling")},r={answersRandom:$(h).attr("answersRandom"),answersLayout:$(h).attr("answersLayout"),maxAllowed:$(h).attr("maxAllowed"),onlyOneSelected:$(h).attr("onlyOneSelected"),answersX:$(h).attr("answersX"),answersY:$(h).attr("answersY")},
s={checked:$(m).attr("checked"),unchecked:$(m).attr("unchecked"),right:$(m).attr("right"),wrong:$(m).attr("wrong"),unchecked_right:$(m).attr("unchecked_right"),unchecked_wrong:$(m).attr("unchecked_wrong"),width:$(m).attr("width"),height:$(m).attr("height")},q={checked:$(l).attr("checked"),unchecked:$(l).attr("unchecked"),right:$(l).attr("right"),wrong:$(l).attr("wrong"),unchecked_right:$(l).attr("unchecked_right"),unchecked_wrong:$(l).attr("unchecked_wrong"),width:$(l).attr("width"),height:$(l).attr("height")};
c.parseObjTree(b,d);var k=$(b).children("actions"),t=$(k).children(),w=[];$.each(t,function(a,b){var c={event:"",eventParam:"",content:""},d=t[a];if("action"==d.nodeName){c.event=$(d).attr("event");var e=$(d).attr("eventParam")||"";c.eventParam=""!=e?e.split(":"):[];d=$(d).text();d=jQuery.lacerta.utils.replaceString(d,"\r","");d=jQuery.lacerta.utils.replaceString(d,"\t","");d=jQuery.lacerta.utils.replaceString(d,"\n","");d=d.split(";");c.content=d;w.push(c)}});var u=[],y=$(b).children("question"),
x=0,A=0;$.each(y,function(b,e){x+=1;var g=c.composeSQuestion(y[b],d,r,p,a.templateName,f,x);A+=g.weight;g.imageParams="checkbox"==g.box_type?s:q;u.push(g)});var v={lParams:n,actionsObjArr:w,questionParams:p,answerParams:r,questionArray:u,parent:d,checkboxParam:s,radioParam:q,curQuestionIndex:0,errors:0,questionCount:u.length,rightQuestCount:0,wrongQuestCount:0,answeredCount:0,checkedId:"",boxDivId:"",curPointFloat:"",weighted_summ_score:0,maxSumScore:A};$("#"+d).bind("checkObject",function(a){c.checkQuestion(v)});
$("#"+d).bind("hideObject",function(a){c.hideQuestion(v)});$("#"+d).bind("resetObject",function(a){c.resetQuestion(v)});$("#"+d).bind("resetAllObjects",function(a){c.resetQuiz(v)});$("#"+d).bind("showNext",function(a){c.showNext(v)});$("#"+d).bind("showPrevious",function(a){c.showPrevious(v)});$("#"+d).bind("showObject",function(a){c.showQuestion(v)});this.globalArray.push(v);"true"==e&&this.showQuestion(v)},parseObjTree:function(a,c){var b=$(a).children();$.each(b,function(a,e){var f=b[a].nodeName,
g={dom:b[a],parentId:c,sectionType:f,keyId:"questions_obj",templateName:"questions"};switch(f){case "group":jQuery.lacerta.design.composeGroupe(g,theTemplate);break;case "image":jQuery.lacerta.design.putImageToHTML(g);break;case "video":jQuery.lacerta.design.putVideoToHTML(g);break;case "audio":jQuery.lacerta.design.putAudioToHTML(g);break;case "text":jQuery.lacerta.design.putTextToHTML(g);break;case "button":jQuery.lacerta.design.putButtonToHTML(g);break;case "zone":jQuery.lacerta.design.putZoneToHTML(g)}})},
composeSQuestion:function(a,c,b,d,e,f,g){var k=this,h={dom:a,parentId:c,sectionType:"currentQuestion",keyId:"currentStep",templateId:"currentQuestion"},m=$(a).children("scoring");f=parseFloat($(m).attr("weight"))||f;jQuery.lacerta.calculation.enrol_template(c+"_"+g,e,f);e=$(a).children("param");var l=$(e).attr("selection_type"),m=$(e).attr("onlyOneSelected"),n=$(e).attr("box_type")||"checkbox",p=$(e).attr("checkMode");"after"!=p&&"immediately"!=p&&(p=void 0!=d.checkMode?d.checkMode:"after");switch(l){case "single":m=
"true";break;case "multiple":case "links":m="false";break;default:"true"==m?l="single":"false"==m?l="multiple":"true"==b.onlyOneSelected?(m="true",l="single"):"false"==b.onlyOneSelected&&(m="false",l="multiple")}b={answersRandom:$(e).attr("answersRandom")};$(a).children("text");var r=0,s=0,q=[],t=$(a).children("answer");$.each(t,function(a,b){var c=k.composeSAnswer(t[a]);"links"==l&&("left"==c.pointFloat||"bottom"==c.pointFloat?r++:"right"!=c.pointFloat&&"top"!=c.pointFloat||s++);q.push(c)});return{idNum:g,
parentDivId:c,imageParams:{},box_type:n,checkMode:p,selection_type:l,onlyOneSelected:m,answerDivObjL:{},answerParams:b,childrens:a,answersArray:q,parent:"",parentResource:h,truePairsId:[],truePairs:{},pairsOfLinks:[],weight:f,answered:0,trm:r*s,score_scaled:0,wrongAnswered:0,canvasId:"",canv:"",ctx:"",curPointFloat:"",checkedId:"",boxDivId:""}},composeSAnswer:function(a){var c=$(a).attr("id"),b=$(a).children("param").attr("links_id")||"",d=$(a).children("param").attr("right"),e=$(a).children("param").attr("point_float")||
"left",d="true"==d?!0:!1;$(a).children("text");var f=$(a).children(),g=[];$.each(f,function(a,b){"answer"!=this.nodeName&&"param"!=this.nodeName&&g.push(this)});return{dom:a,id:c,linksIdList:b,sign:d,pointFloat:e,children:g,divId:"",checked:!1,inputType:""}},removeQuestion:function(a){$("#"+a.parent+" div").empty();$("#"+a.parent).empty()},hideQuestion:function(a){$("#"+a.questionArray[a.curQuestionIndex].parent).hide()},showQuestion:function(a){var c=a.questionArray[a.curQuestionIndex];if(""!=c.parent&&
void 0!=c.parent)$("#"+c.parent).show();else if(this.presentQuestion(a),this.showQuestion(a),"links"==a.questionArray[a.curQuestionIndex].selection_type){var b=a.questionArray[a.curQuestionIndex].parent,d=a.questionArray[a.curQuestionIndex].answerDivObjL;$.each(a.questionArray[a.curQuestionIndex].answersArray,function(c,f){var g=this.linksIdList.split(","),k=g.length;if(0<k&&""!=g[0])for(var h=this.id,m=$("#"+this.divId).children(".answerCheckBox").attr("id"),l=0;l<k;l++){var n={boxDivId1:"",boxDivId2:"",
parentId:b,state:""},p=g[l],r=$("#"+d[p]).children(".answerCheckBox").attr("id");n.state="unchecked";n.boxDivId1=m;n.boxDivId2=r;a.questionArray[a.curQuestionIndex].truePairs["t"+h+"~"+p]=n;a.questionArray[a.curQuestionIndex].truePairsId.push("t"+h+"~"+p)}});a.questionArray[a.curQuestionIndex].trm-=a.questionArray[a.curQuestionIndex].truePairsId.length}},presentQuestion:function(a){var c=this,b=a.questionArray[a.curQuestionIndex],d=b.selection_type,e=b.onlyOneSelected,f=b.box_type;b.parent=jQuery.lacerta.design.putGroupeToHTML(b.parentResource,
"question");b.parentResource.parentId=b.parent;if("links"==d&&""==b.canv){b.parentResource.canvasId=b.parent+"_canvas";var g=b.parentResource;g.pX=0;g.pY=0;g=jQuery.lacerta.design.putCanvasToHTML(g);$("#"+g).css("display","block");b.canvasId=g;g=document.getElementById(g);b.canv=g;b.ctx=g.getContext("2d")}c.parseObjTree(b.childrens,b.parent);var k="checkbox"==f||"radio"==f?f:"multiple"==e?"checkbox":"radio",h=!1;void 0!=b.answerParams.answersRandom?h="true"==b.answerParams.answersRandom?!0:!1:void 0!=
a.answerParams.answersRandom&&(h="true"==a.answerParams.answersRandom?!0:!1);e=b.answersArray;if(!0==h&&"links"!=d){f=[];for(g=0;g<e.length;g++)f.push(g);var m=jQuery.lacerta.utils.permutateArray(f),l=[];$.each(e,function(a,b){l[m[a]]={x:$("param",this.dom).attr("x"),y:$("param",this.dom).attr("y")}})}$.each(e,function(e,f){var g=this,m=this.pointFloat;!0==h&&"links"!=d&&$("param",this.dom).attr({x:l[e].x,y:l[e].y});var q=jQuery.lacerta.design.putGroupeToHTML({dom:this.dom,parentId:b.parent,sectionType:"answer",
keyId:"currentStep",templateId:"answer"},"question_answer");this.divId=q;a.questionArray[a.curQuestionIndex].answerDivObjL[this.id]=q;this.inputType=k;$.each(this.children,function(a,b){if(0.6>gScaleValue)var c="5px",d="0px";else c="10px",d="0px";if("text"==this.nodeName){var e={dom:this,parentId:q,sectionType:"text",keyId:"currentStep",templateId:void 0},e=jQuery.lacerta.design.putTextToHTML(e);$("#"+e).css({display:"inline-block",position:"static",margin:d+" "+c+" 0px "+c})}"image"==this.nodeName&&
(e={dom:this,parentId:q,sectionType:"image",keyId:"currentStep",templateId:void 0},e=jQuery.lacerta.design.putImageToHTML(e),$("#"+e).css({display:"inline",position:"static",margin:d+" "+c+" 0px "+c}))});$("<input id="+this.id+' style="display:none" type='+k+' value="2" />').appendTo("#"+q);var t=$("<img id="+(q+"_img")+" />");t.attr({src:a.questionArray[a.curQuestionIndex].imageParams.unchecked});a.questionArray[a.curQuestionIndex].imageParams.width&&a.questionArray[a.curQuestionIndex].imageParams.height&&
t.attr({width:Math.round(a.questionArray[a.curQuestionIndex].imageParams.width*gScaleValue).toString(),height:Math.round(a.questionArray[a.curQuestionIndex].imageParams.height*gScaleValue).toString()});void 0==a.questionArray[a.curQuestionIndex].imageParams.unchecked&&t.css({display:"none"});t.addClass("answerCheckBox");"left"==m||"right"==m?(t.css({position:"static",display:"block","float":m,clear:m}),t.appendTo("#"+q)):"top"==m?(t.css({position:"static",display:"block"}),t.prependTo("#"+q),$("#"+
q).attr("align","center")):"bottom"==m&&(t.css({position:"static",display:"block"}),t.appendTo("#"+q),$("#"+q).attr("align","center"));"single"==d?$("#"+q).bind("click",function(b){c.toggleRadio(q,a,g)}):"links"==d?$("#"+q).bind("click",function(b){c.toggleLinks(q,a,g)}):$("#"+q).bind("click",function(b){c.toggleCheckbox(q,a,g)});$("#"+q).css("cursor","pointer")})},toggleRadio:function(a,c,b){var d=c.questionArray[c.curQuestionIndex].imageParams.checked,e=c.questionArray[c.curQuestionIndex].imageParams.unchecked;
$.each(c.questionArray[c.curQuestionIndex].answersArray,function(a,b){$.lacerta.actions.searchEvInObjArray(this.divId,"onUncheck");this.checked=!1});var f=$("#"+a).parent(),g=$(f).children().children(".answerCheckBox");$.each(g,function(a,b){g[a].src=e});b.checked=!0;$.lacerta.actions.searchEvInObjArray(a,"onCheck");$("#"+a).children(".answerCheckBox").attr("src",d);"immediately"==c.questionArray[c.curQuestionIndex].checkMode&&this.checkQuestion(c)},toggleCheckbox:function(a,c,b){var d=c.questionArray[c.curQuestionIndex].imageParams.checked,
e=c.questionArray[c.curQuestionIndex].imageParams.unchecked,f=$("#"+a).children(".answerCheckBox");!0==b.checked?($.lacerta.actions.searchEvInObjArray(a,"onUncheck"),b.checked=!1,f.attr("src",e)):($.lacerta.actions.searchEvInObjArray(a,"onCheck"),b.checked=!0,f.attr("src",d));("immediately"==c.questionParams.checkMode&&"after"!=c.questionArray[c.curQuestionIndex].checkMode||"immediately"==c.questionArray[c.curQuestionIndex].checkMode)&&alert("immediately не предусмотрен; проверка кнопкой")},toggleLinks:function(a,
c,b){if(!0==b.checked)return!1;var d=c.questionArray[c.curQuestionIndex].imageParams.checked,e=c.questionArray[c.curQuestionIndex].imageParams.unchecked,f=c.questionArray[c.curQuestionIndex].curPointFloat,g=c.questionArray[c.curQuestionIndex].checkedId,k=c.questionArray[c.curQuestionIndex].parent;if(""==f||f==b.pointFloat){c.questionArray[c.curQuestionIndex].curPointFloat=b.pointFloat;c.questionArray[c.curQuestionIndex].checkedId=b.id;$.each(c.questionArray[c.curQuestionIndex].answersArray,function(a,
b){this.checked=!1});var f=$("#"+a).parent(),h=$(f).children().children(".answerCheckBox");$.each(h,function(a,b){h[a].src=e});b.checked=!0;a=$("#"+a).children(".answerCheckBox");a.attr("src",d);c.questionArray[c.curQuestionIndex].boxDivId=a.attr("id")}else this.testLincks(c,g,b.id,c.questionArray[c.curQuestionIndex].boxDivId,$("#"+a).children(".answerCheckBox").attr("id"),k)&&(a=$("#"+a).children(".answerCheckBox"),a.attr("src",d)),c.questionArray[c.curQuestionIndex].curPointFloat="",c.questionArray[c.curQuestionIndex].checkedId=
"",c.questionArray[c.curQuestionIndex].boxDivId=""},resetQuiz:function(a){this.hideQuestion(a);for(var c=0;c<a.questionCount;c++)a.curQuestionIndex=c,this.resetQuestion(a);this.showNext(a)},resetQuestion:function(a){var c=this,b=a.questionArray[a.curQuestionIndex].answersArray,d=a.questionArray[a.curQuestionIndex].selection_type;if(0!=a.questionArray[a.curQuestionIndex].answered){a.wrongQuestCount-=a.questionArray[a.curQuestionIndex].wrongAnswered;a.questionArray[a.curQuestionIndex].wrongAnswered=
0;a.answeredCount--;a.questionArray[a.curQuestionIndex].answered=0;var e=a.questionArray[a.curQuestionIndex].imageParams.unchecked;$.each(b,function(f,g){$("#"+this.divId).children(".answerCheckBox").attr("src",e);this.checked=!1;"single"==d?$("#"+this.divId).bind("click",function(d){c.toggleRadio(b[f].divId,a,b[f])}):"links"==d?$("#"+this.divId).bind("click",function(d){c.toggleLinks(b[f].divId,a,b[f])}):$("#"+this.divId).bind("click",function(d){c.toggleCheckbox(b[f].divId,a,b[f])});$("#"+this.divId).css("cursor",
"pointer")})}if("links"==d){a.questionArray[a.curQuestionIndex].canv.width=a.questionArray[a.curQuestionIndex].canv.width;for(var f=a.questionArray[a.curQuestionIndex].truePairsId,g=f.length,k=0;k<g;k++)a.questionArray[a.curQuestionIndex].truePairs[f[k]].state="unchecked";a.questionArray[a.curQuestionIndex].pairsOfLinks=[];a.curPointFloat="";a.checkedId="";a.boxDivId=""}},checkQuestion:function(a){if(0==a.questionArray[a.curQuestionIndex].answered){var c=a.questionArray[a.curQuestionIndex],b=0,d=
0,e=0,f=a.questionArray[a.curQuestionIndex].answersArray,b=a.questionArray[a.curQuestionIndex].selection_type;if("links"!=b){var g=a.questionArray[a.curQuestionIndex].imageParams.right,k=a.questionArray[a.curQuestionIndex].imageParams.wrong,h=a.questionArray[a.curQuestionIndex].imageParams.unchecked_right,m=a.questionArray[a.curQuestionIndex].imageParams.unchecked_wrong,l=a.questionArray[a.curQuestionIndex].onlyOneSelected,n=0;$.each(f,function(a,b){!0==f[a].checked&&(n=1)});if(0==n)return!1;var p=
0;$.each(f,function(a,b){p+=1;var c=f[a].checked;!0==c&&(n=1);var q=0,r=f[a].sign;!0==r&&(q=1);!0==r&&!0==c?(++e,$("#"+this.divId).children(".answerCheckBox").attr("src",g)):!0==c?($("#"+this.divId).children(".answerCheckBox").attr("src",k),"true"!=l&&d++):!0==r?(d+=q,"true"!=l&&$("#"+this.divId).children(".answerCheckBox").attr("src",m)):"true"!=l&&(++e,$("#"+this.divId).children(".answerCheckBox").attr("src",h))});0==d?b=1:"true"==l||"single"==b?b=0:(b=(e-d)/p,b=0<=b?b:0)}else{var r=b=0,s=a.questionArray[a.curQuestionIndex].imageParams.unchecked,
q=a.questionArray[a.curQuestionIndex].pairsOfLinks,t=a.questionArray[a.curQuestionIndex].truePairsId,w=a.questionArray[a.curQuestionIndex].trm,u=q.length,y=t.length;if(0==u)return!1;for(var x=0;x<u;x+=4)q[x+2]?(r+=1/y,this.showLine(a,q[x+3],"true")):(b+=1/w,this.showLine(a,q[x+3],"false"));for(q=0;q<y;q++)w=a.questionArray[a.curQuestionIndex].truePairs[t[q]],"unchecked"==w.state&&(w=this.getBoxPos(w.boxDivId1,w.boxDivId2,w.parentId),this.showLine(a,w,"unchecked"));$.each(f,function(a,b){$("#"+this.divId).children(".answerCheckBox").attr("src",
s)});b=r-b;b=0<=b?b:0}a.questionArray[a.curQuestionIndex].score_scaled=b;r=a.questionArray[a.curQuestionIndex].weight;0!=a.maxSumScore&&(a.weighted_summ_score+=r*b/a.maxSumScore);0.95<b?(a.questionArray[a.curQuestionIndex].wrongAnswered=1,$.lacerta.actions.searchEvInObjArray(a.questionArray[a.curQuestionIndex].parent,"onAnsweredRight")):(0.25>b&&$.lacerta.actions.searchEvInObjArray(a.questionArray[a.curQuestionIndex].parent,"onAnsweredWrong"),a.questionArray[a.curQuestionIndex].wrongAnswered=1,a.wrongQuestCount+=
1);a.questionArray[a.curQuestionIndex].answered=1;a.answeredCount++;$.each(f,function(a,b){$("#"+f[a].divId).unbind("click");$("#"+f[a].divId).css("cursor","auto")});jQuery.lacerta.calculation.update_template(c.parentDivId+"_"+c.idNum,b);this.checkQuiz(a)}},testLincks:function(a,c,b,d,e,f){for(var g=a.questionArray[a.curQuestionIndex].pairsOfLinks,k=a.questionArray[a.curQuestionIndex].truePairs,h=g.length,m=!1,l=!1,n=0;n<h;n+=4){var p=g[n],r=g[n+1];if(c==p&&b==r||c==r&&b==p){m=!0;break}}if(m)return!1;
g="t"+c+"~"+b;h=k[g];void 0==h&&(g="t"+b+"~"+c,h=k[g]);void 0!=h&&(a.questionArray[a.curQuestionIndex].truePairs[g].state="checked",l=!0);d=this.getBoxPos(d,e,f);a.questionArray[a.curQuestionIndex].pairsOfLinks.push(c);a.questionArray[a.curQuestionIndex].pairsOfLinks.push(b);a.questionArray[a.curQuestionIndex].pairsOfLinks.push(l);a.questionArray[a.curQuestionIndex].pairsOfLinks.push(d);this.showLine(a,d,"test");return!0},getBoxPos:function(a,c,b){var d=$("#"+a),e=$("#"+c);c=d.width()/2;a=d.height()/
2;b=document.getElementById(b);var f=document.getElementById("currentStep"),g=d.offset().left,d=d.offset().top,k=e.offset().left,e=e.offset().top,h=0,m=0;isTouchScreen&&(m=document.getElementById("scene"),h=m.offsetLeft,m=m.offsetTop);var l=[];l[0]=Math.floor(g-h-b.offsetLeft-f.offsetLeft+c);l[1]=Math.floor(d-m-b.offsetTop-f.offsetTop+a);l[2]=Math.floor(k-h-b.offsetLeft-f.offsetLeft+c);l[3]=Math.floor(e-m-b.offsetTop-f.offsetTop+a);return l},showLine:function(a,c,b){var d=a.questionArray[a.curQuestionIndex].ctx;
switch(b){case "test":d.strokeStyle=a.lParams.strokeL[0];break;case "unchecked":d.strokeStyle=a.lParams.strokeL[3];break;case "true":d.strokeStyle=a.lParams.strokeL[1];break;case "false":d.strokeStyle=a.lParams.strokeL[2]}d.lineWidth=a.lParams.lineWidth;d.lineCap="round";d.beginPath();d.moveTo(c[0],c[1]);d.lineTo(c[2],c[3]);d.stroke();d.closePath()},checkLincks:function(a,c,b){},checkQuiz:function(a){if(a.answeredCount==parseInt(a.questionCount))for(var c=a.actionsObjArr,b=100*a.weighted_summ_score,
d=0;d<c.length;d++){var e=c[d].event,f=c[d].eventParam,g=1;f&&(2==f.length?parseInt(f[0])<=b&&b<=parseInt(f[1])||(g=0):1==f.length&&parseInt(f[0])!=a.answeredCount-a.wrongQuestCount&&(g=0));f=c[d].content;if(0<f.length&&g)for(g=0;g<f.length;g++){var k=f[g],k=k.split(":");if(2<k.length)for(var h=2;h<k.length;++h)k[1]+=":"+k[h];1<k.length&&$.lacerta.actions.prepareDispatchAction2("",e,k,1)}}},showNext:function(a){$.each(a.questionArray[a.curQuestionIndex].answersArray,function(a,b){this.checked=!1});
this.hideQuestion(a);a.curQuestionIndex++;a.curQuestionIndex==a.questionCount&&(a.curQuestionIndex=0);this.showQuestion(a)},showPrevious:function(a){this.hideQuestion(a);a.curQuestionIndex--;0>a.curQuestionIndex&&(a.curQuestionIndex=a.questionCount-1);this.showQuestion(a)}};/*
 
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 connections.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.connections={$currentId:void 0,connectionObjL:{},connectionIdL:[],programmers:[{name:"Sergey",surname:"Kondrashov"}],purgeConnections:function(){this.connectionObjL={};this.connectionIdL=[]},composeConnections:function(a){var c=a.dom,b=a.keyId,d=jQuery.lacerta.design.putGroupeToHTML(a,"connections"),b={targetSelId:"",bulletSelId:"",connectionId:d,keyId:b,param:{},objL:{},allBulletId:[],randomBulletId:[],allTargetId:[],target_variety:{},shiftIdNum:-1,lastBullet:0,currentBulletId:"",
connectionsNumber:0,selIdFLAG:0,score_withDegression:1,degression:0.8,target_variety_flag:0};this.connectionObjL[d]=b;var e=$(c).children("scoring"),f=$(e).attr("weight")||$(e).attr("weigth"),f=parseFloat(f)||1,e=parseFloat($(e).attr("degression"))||-1;0<=e&&1>=e&&(this.connectionObjL[d].degression=e);jQuery.lacerta.calculation.enrol_template(d,a.templateName,f);this.parseObjTree(d,c,d);"true"==b.param.showOneBullet&&("true"==b.param.randomOneBullet&&(b.randomBulletId=jQuery.lacerta.utils.permutateArray(b.allBulletId)),
this.showNextBullet(d));1==b.allTargetId.length&&this.selectOneTarget(d)},parseObjTree:function(a,c,b){var d=this,e=this.connectionObjL[a],f=$(c).children();$("#"+a).bind("showNext",function(b){d.showNextBullet(a)});$("#"+a).bind("showPrevious",function(b){d.showPreviousBullet(a)});$.each(f,function(c,k){var h={objId:"",_id_:"",target:0,bullet:0,connected:0,presented:0,checked:0,activeZone:0,targetIdL:[]},m="",l=void 0,n=l=void 0,p=f[c].nodeName,r=f[c];if("param"!=p&&"actions"!=p){var s={dom:r,parentId:b,
sectionType:p,keyId:e.keyId,templateName:void 0},l=$(r).children("conditions");l.is("conditions")&&(l=$(l).text(),l=jQuery.lacerta.utils.replaceString(l,"\r",""),l=jQuery.lacerta.utils.replaceString(l,"\t",""),l=jQuery.lacerta.utils.replaceString(l,"\n",""),"{"==l.charAt(0)&&(n=JSON.parse(l)))}switch(p){case "param":if("connections"==$(r).parent().get(0).tagName)for(l="selObjStyleL selObjId selObjOffsetX selObjOffsetY randomOneBullet showOneBullet hideMistakes npIdList".split(" "),s=0;s<l.length;s++){var q=
l[s],t=$(r).attr(q);e.param[q]=""!=t&&void 0!=t?t:!1}break;case "zone":m=jQuery.lacerta.design.putZoneToHTML(s);break;case "text":m=jQuery.lacerta.design.putTextToHTML(s);break;case "image":m=jQuery.lacerta.design.putImageToHTML(s);break;case "group":m=jQuery.lacerta.design.composeGroupe(s)}if("zone"==p||"text"==p||"image"==p||"group"==p){h.objId=m;h._id_=$(r).attr("id").split(",")[0];if(void 0!=n&&("target"==n.type?(h.target=1,e.allTargetId.push(m)):(h.bullet=1,e.allBulletId.push(m)),p=n.targetIdL,
n=0,""!=p&&void 0!=p&&"false"!=p&&"true"!=p&&1==h.bullet?(h.targetIdL=p.split(","),n=h.targetIdL.length,e.connectionsNumber+=1):"true"==p?(h.activeZone=1,e.connectionsNumber+=1):1==h.bullet&&"false"==p?h.activeZone=-1:1==h.bullet&&""==p&&(h.activeZone=-2),1==h.bullet&&0==e.target_variety_flag))for(s=0;s<n;s++)1<=e.target_variety[h.targetIdL[s]]?(e.target_variety[h.targetIdL[s]]+=1,e.target_variety_flag=1):e.target_variety[h.targetIdL[s]]=1;if(1==h.target||1==h.bullet)e.objL[m]=h,$("#"+m).Touchable({preventClick:!0,
logging:!1}),$("#"+m).bind("tap",function(b,c){b.stopPropagation();d.updateSelectedObj(a,m)}),$("#"+m).addClass("activeElement")}})},showNextBullet:function(a){var c=this.connectionObjL[a];c.shiftIdNum++;c.shiftIdNum==c.allBulletId.length&&(c.shiftIdNum=0);var b="",b="true"==c.param.randomOneBullet?c.randomBulletId[c.shiftIdNum]:c.allBulletId[c.shiftIdNum];1==c.objL[b].connected?this.showNextBullet(a):this.showBullet(a,b)},showPreviousBullet:function(a){var c=this.connectionObjL[a];if(0==c.lastBullet){c.shiftIdNum--;
0>=c.shiftIdNum&&(c.shiftIdNum=c.allBulletId.length-1);var b="",b="true"==c.param.randomOneBullet?c.randomBulletId[c.shiftIdNum]:c.allBulletId[c.shiftIdNum];1==c.objL[b].connected?this.showPreviousBullet(a):this.showBullet(a,b)}},showBullet:function(a,c){var b=this.connectionObjL[a];""!=b.currentBulletId&&(1!=b.objL[b.currentBulletId].connected&&(this.unbindObj(b.currentBulletId),$("#"+b.currentBulletId).trigger("hideObject")),b.currentBulletId="");this.updateSelectedObj(a,c);$("#"+c).trigger("showObject").trigger("tap");
b.currentBulletId=c},selectOneTarget:function(a){$("#"+this.connectionObjL[a].allTargetId[0]).trigger("showObject").trigger("tap")},changeSelectedStyle:function(a,c,b,d,e){a=this.connectionObjL[a];if(!1!=a.param.selObjStyleL)for(var f=a.param.selObjStyleL.split(","),g=f.length,k=0;k<g;k++)d&&1!=a.allTargetId.length&&$("#"+a.targetSelId).removeClass(f[k]),e&&$("#"+a.bulletSelId).removeClass(f[k]),"NORMAL"==b&&""!=c&&$("#"+c).addClass(f[k])},updateSelectedObj:function(a,c){var b=this.connectionObjL[a],
d=b.objL[c],e=d.target,f=d.bullet,g=d._id_,k=0;if(!1!=b.param.selObjId&&e){b.selIdFLAG=1;var h=b.param.selObjOffsetX*gScaleValue||0,m=b.param.selObjOffsetY*gScaleValue||0,l=$("#"+c).position(),h=l.left+h+"px",m=l.top+m+"px";$("."+b.param.selObjId).show();$("."+b.param.selObjId).css({left:h,top:m})}if(e&&c!=b.targetSelId&&0==d.activeZone&&""!=b.bulletSelId&&(h=b.objL[b.bulletSelId].targetIdL,m=h.length,0<m))for(l=0;l<m;l++)if(g==h[l]){k=1;break}if(f&&c!=b.bulletSelId&&-2!=d.activeZone&&""!=b.targetSelId&&
(g=b.objL[b.targetSelId]._id_,m=d.targetIdL.length,0<m))for(l=0;l<m;l++)if(g==d.targetIdL[l]){k=1;break}if(c!=b.bulletSelId&&c!=b.targetSelId)if(k)this.changeSelectedStyle(a,"","TRUE",1,1),""==b.bulletSelId?b.bulletSelId=c:b.targetSelId=c,this.unbindObj(b.bulletSelId),0==b.target_variety_flag&&this.unbindObj(b.targetSelId),this.runAction(a,b.bulletSelId,"onConnectedRight"),b.objL[b.bulletSelId].connected=1,b.objL[b.bulletSelId].checked=1,1!=b.allTargetId.length&&(b.targetSelId=""),b.bulletSelId="",
this.checkTheCompleteness(a),b.selIdFLAG&&($("."+b.param.selObjId).hide(),b.selIdFLAG=0);else if(""!=b.targetSelId&&f||""!=b.bulletSelId&&e||-1==d.activeZone){if(this.changeSelectedStyle(a,"","FALSE",1,1),""==b.bulletSelId&&(b.bulletSelId=c),b.score_withDegression*=b.degression,this.runAction(a,b.bulletSelId,"onConnectedWrong"),b.objL[b.bulletSelId].checked=1,"true"==b.param.hideMistakes&&(this.unbindObj(b.bulletSelId),0==b.target_variety_flag&&this.unbindObj(b.targetSelId),this.checkTheCompleteness(a)),
1!=b.allTargetId.length&&(b.targetSelId=""),"true"!=b.param.showOneBullet&&(b.bulletSelId=""),b.selIdFLAG&&($("."+b.param.selObjId).hide(),b.selIdFLAG=0),-1==d.activeZone)return this.unbindObj(c),!1}else this.changeSelectedStyle(a,c,"NORMAL",e,f),this.runAction(a,c,"onSelected"),e?b.targetSelId=c:f&&(b.bulletSelId=c);1==d.activeZone&&(this.unbindObj(c),this.runAction(a,c,"onConnectedRight"),b.objL[c].checked=1,b.objL[c].connected=1,this.checkTheCompleteness(a))},unbindObj:function(a){$("#"+a).unbind("tap");
$("#"+a).unbind("longTap");$("#"+a).unbind("touchablemove");$("#"+a).unbind("touchableend");$("#"+a).removeClass("activeElement")},unbindAllObj:function(a){a=this.connectionObjL[a];for(var c=a.allTargetId.length,b=0;b<c;b++)this.unbindObj(a.allTargetId[b])},checkTheCompleteness:function(a){for(var c=this.connectionObjL[a],b=c.allBulletId.length,d=0,e=0,f=0;f<b;f++)var g=c.allBulletId[f],d=d+c.objL[g].connected,e=e+c.objL[g].checked;if(d==b-1&&(c.lastBullet=1,!1!=c.param.npIdList))for(b=c.param.npIdList.split(","),
f=b.length,g=0;g<f;g++)$("."+b[g]).hide();b=d/c.connectionsNumber;1<b&&(b=1);e>=c.connectionsNumber&&d<c.connectionsNumber&&("true"==c.param.hideMistakes&&this.unbindAllObj(a),jQuery.lacerta.calculation.update_template(a,b),$.lacerta.actions.searchEvInObjArray(a,"onSomeObjConnectedWrong","connection"));d>=c.connectionsNumber?(this.unbindAllObj(a),jQuery.lacerta.calculation.update_template(a,c.score_withDegression*b),$.lacerta.actions.searchEvInObjArray(a,"onAllObjConnectedRight","connection")):"true"==
c.param.showOneBullet&&this.showNextBullet(a)},runAction:function(a,c,b){$.lacerta.actions.searchEvInObjArray(c,b,"connection")}};/*
 
 LEARNING OBJECTS MARKUP LANGUAGE javascript interpreter
 connections.js
 @author    <a href="mailto:infostudio@yandex.ru">Sergey Kondrashov</a>
 @requires jQuery
*/
jQuery.lacerta.dictation={$currentId:void 0,dictationObjL:{},dictationIdL:[],programmers:[{name:"Sergey",surname:"Kondrashov"}],purgeDictation:function(){this.dictationObjL={};this.dictationIdL=[]},composeDictation:function(a){var c=this,b=a.dom;a=jQuery.lacerta.design.putTextToHTML(a,"","dictation");var d=$(b).children("param"),e=$(b).children("scoring"),e=$(e).attr("weight")||$(e).attr("weigth"),e=parseFloat(e)||1;jQuery.lacerta.calculation.enrol_template(a,"dictation",e);var e=$("value",b).text(),
f={dictationId:a,html:e,transformToLink:$(d).attr("transformToLink")||"false",iconImgPath:$(d).attr("iconImgPath")||"",hintStyle:$(d).attr("hintStyle")||"",hintWidth:$(d).attr("hintWidth")||"",outputTextId:$(d).attr("outputTextId")||"",trueWordStyle:$(d).attr("trueWordStyle")||"",falseWordStyle:$(d).attr("falseWordStyle")||"",objLists:{},actions:""},g=$(b).children("lists").children();$.each(g,function(a,b){nodeName=g[a].nodeName;nodeObj=g[a];alert("nodeName == "+nodeName);if("list"==nodeName){var d=
$(nodeObj).attr("id");"undefined"!=typeof d&&(f.objLists[d]=c.parseDictationLists(nodeObj,d))}});this.setHtmlWithLists(f);this.dictationObjL[a]=f},setHtmlWithLists:function(a,c){},parseDictationLists:function(a,c){var b=$(a).children(),d={id:c,transformToLink:"",options:"",textIfTrue:"",textIfFalse:"",actions:""};$.each(b,function(a,c){var g=b[a].nodeName,k=b[a];$(k).attr("id");switch(g){case "options":d.options=JSON.parse($(k).text());break;case "textIfTrue":d.textIfTrue=$(k).text();alert(d.textIfTrue);
break;case "textIfFalse":d.textIfFalse=$(k).text();alert(d.textIfFalse);break;case "actions":d.actions=""}});return d},parseObjTree:function(a,c,b){var d=this,e=this.connectionObjL[a],f=$(c).children();$("#"+a).bind("showNext",function(b){d.showNextBullet(a)});$("#"+a).bind("showPrevious",function(b){d.showPreviousBullet(a)});$.each(f,function(c,k){var h={objId:"",_id_:"",target:0,bullet:0,connected:0,presented:0,checked:0,activeZone:0,targetIdL:[]},m="",l=void 0,n=l=void 0,p=f[c].nodeName,r=f[c];
if("param"!=p&&"actions"!=p){var s={dom:r,parentId:b,sectionType:p,keyId:e.keyId,templateName:void 0},l=$(r).children("conditions");l.is("conditions")&&(l=$(l).text(),l=jQuery.lacerta.utils.replaceString(l,"\r",""),l=jQuery.lacerta.utils.replaceString(l,"\t",""),l=jQuery.lacerta.utils.replaceString(l,"\n",""),"{"==l.charAt(0)&&(n=JSON.parse(l)))}switch(p){case "param":if("connections"==$(r).parent().get(0).tagName)for(l="selObjStyleL selObjId selObjOffsetX selObjOffsetY randomOneBullet showOneBullet hideMistakes npIdList".split(" "),
s=0;s<l.length;s++){var q=l[s],t=$(r).attr(q);e.param[q]=""!=t&&void 0!=t?t:!1}break;case "zone":m=jQuery.lacerta.design.putZoneToHTML(s);break;case "text":m=jQuery.lacerta.design.putTextToHTML(s);break;case "image":m=jQuery.lacerta.design.putImageToHTML(s);break;case "group":m=jQuery.lacerta.design.composeGroupe(s)}if("zone"==p||"text"==p||"image"==p||"group"==p){h.objId=m;h._id_=$(r).attr("id").split(",")[0];if(void 0!=n&&("target"==n.type?(h.target=1,e.allTargetId.push(m)):(h.bullet=1,e.allBulletId.push(m)),
p=n.targetIdL,n=0,""!=p&&void 0!=p&&"false"!=p&&"true"!=p&&1==h.bullet?(h.targetIdL=p.split(","),n=h.targetIdL.length,e.connectionsNumber+=1):"true"==p?(h.activeZone=1,e.connectionsNumber+=1):1==h.bullet&&"false"==p?h.activeZone=-1:1==h.bullet&&""==p&&(h.activeZone=-2),1==h.bullet&&0==e.target_variety_flag))for(s=0;s<n;s++)1<=e.target_variety[h.targetIdL[s]]?(e.target_variety[h.targetIdL[s]]+=1,e.target_variety_flag=1):e.target_variety[h.targetIdL[s]]=1;if(1==h.target||1==h.bullet)e.objL[m]=h,$("#"+
m).Touchable({preventClick:!0,logging:!1}),$("#"+m).bind("tap",function(b,c){b.stopPropagation();d.updateSelectedObj(a,m)}),$("#"+m).addClass("activeElement")}})},showNextBullet:function(a){var c=this.connectionObjL[a];c.shiftIdNum++;c.shiftIdNum==c.allBulletId.length&&(c.shiftIdNum=0);var b="",b="true"==c.param.randomOneBullet?c.randomBulletId[c.shiftIdNum]:c.allBulletId[c.shiftIdNum];1==c.objL[b].connected?this.showNextBullet(a):this.showBullet(a,b)},showPreviousBullet:function(a){var c=this.connectionObjL[a];
if(0==c.lastBullet){c.shiftIdNum--;0>=c.shiftIdNum&&(c.shiftIdNum=c.allBulletId.length-1);var b="",b="true"==c.param.randomOneBullet?c.randomBulletId[c.shiftIdNum]:c.allBulletId[c.shiftIdNum];1==c.objL[b].connected?this.showPreviousBullet(a):this.showBullet(a,b)}},showBullet:function(a,c){var b=this.connectionObjL[a];""!=b.currentBulletId&&(1!=b.objL[b.currentBulletId].connected&&(this.unbindObj(b.currentBulletId),$("#"+b.currentBulletId).trigger("hideObject")),b.currentBulletId="");this.updateSelectedObj(a,
c);$("#"+c).trigger("showObject").trigger("tap");b.currentBulletId=c},selectOneTarget:function(a){$("#"+this.connectionObjL[a].allTargetId[0]).trigger("showObject").trigger("tap")},changeSelectedStyle:function(a,c,b,d,e){a=this.connectionObjL[a];if(!1!=a.param.selObjStyleL)for(var f=a.param.selObjStyleL.split(","),g=f.length,k=0;k<g;k++)d&&1!=a.allTargetId.length&&$("#"+a.targetSelId).removeClass(f[k]),e&&$("#"+a.bulletSelId).removeClass(f[k]),"NORMAL"==b&&""!=c&&$("#"+c).addClass(f[k])},updateSelectedObj:function(a,
c){var b=this.connectionObjL[a],d=b.objL[c],e=d.target,f=d.bullet,g=d._id_,k=0;if(!1!=b.param.selObjId&&e){b.selIdFLAG=1;var h=b.param.selObjOffsetX*gScaleValue||0,m=b.param.selObjOffsetY*gScaleValue||0,l=$("#"+c).position(),h=l.left+h+"px",m=l.top+m+"px";$("."+b.param.selObjId).show();$("."+b.param.selObjId).css({left:h,top:m})}if(e&&c!=b.targetSelId&&0==d.activeZone&&""!=b.bulletSelId&&(h=b.objL[b.bulletSelId].targetIdL,m=h.length,0<m))for(l=0;l<m;l++)if(g==h[l]){k=1;break}if(f&&c!=b.bulletSelId&&
-2!=d.activeZone&&""!=b.targetSelId&&(g=b.objL[b.targetSelId]._id_,m=d.targetIdL.length,0<m))for(l=0;l<m;l++)if(g==d.targetIdL[l]){k=1;break}if(c!=b.bulletSelId&&c!=b.targetSelId)if(k)this.changeSelectedStyle(a,"","TRUE",1,1),""==b.bulletSelId?b.bulletSelId=c:b.targetSelId=c,this.unbindObj(b.bulletSelId),0==b.target_variety_flag&&this.unbindObj(b.targetSelId),this.runAction(a,b.bulletSelId,"onConnectedRight"),b.objL[b.bulletSelId].connected=1,b.objL[b.bulletSelId].checked=1,1!=b.allTargetId.length&&
(b.targetSelId=""),b.bulletSelId="",this.checkTheCompleteness(a),b.selIdFLAG&&($("."+b.param.selObjId).hide(),b.selIdFLAG=0);else if(""!=b.targetSelId&&f||""!=b.bulletSelId&&e||-1==d.activeZone){if(this.changeSelectedStyle(a,"","FALSE",1,1),""==b.bulletSelId&&(b.bulletSelId=c),b.score_withDegression*=b.degression,this.runAction(a,b.bulletSelId,"onConnectedWrong"),b.objL[b.bulletSelId].checked=1,"true"==b.param.hideMistakes&&(this.unbindObj(b.bulletSelId),0==b.target_variety_flag&&this.unbindObj(b.targetSelId),
this.checkTheCompleteness(a)),1!=b.allTargetId.length&&(b.targetSelId=""),"true"!=b.param.showOneBullet&&(b.bulletSelId=""),b.selIdFLAG&&($("."+b.param.selObjId).hide(),b.selIdFLAG=0),-1==d.activeZone)return this.unbindObj(c),!1}else this.changeSelectedStyle(a,c,"NORMAL",e,f),this.runAction(a,c,"onSelected"),e?b.targetSelId=c:f&&(b.bulletSelId=c);1==d.activeZone&&(this.unbindObj(c),this.runAction(a,c,"onConnectedRight"),b.objL[c].checked=1,b.objL[c].connected=1,this.checkTheCompleteness(a))},unbindObj:function(a){$("#"+
a).unbind("tap");$("#"+a).unbind("longTap");$("#"+a).unbind("touchablemove");$("#"+a).unbind("touchableend");$("#"+a).removeClass("activeElement")},unbindAllObj:function(a){a=this.connectionObjL[a];for(var c=a.allTargetId.length,b=0;b<c;b++)this.unbindObj(a.allTargetId[b])},checkTheCompleteness:function(a){for(var c=this.connectionObjL[a],b=c.allBulletId.length,d=0,e=0,f=0;f<b;f++)var g=c.allBulletId[f],d=d+c.objL[g].connected,e=e+c.objL[g].checked;if(d==b-1&&(c.lastBullet=1,!1!=c.param.npIdList))for(b=
c.param.npIdList.split(","),f=b.length,g=0;g<f;g++)$("."+b[g]).hide();b=d/c.connectionsNumber;1<b&&(b=1);e>=c.connectionsNumber&&d<c.connectionsNumber&&("true"==c.param.hideMistakes&&this.unbindAllObj(a),jQuery.lacerta.calculation.update_template(a,b),$.lacerta.actions.searchEvInObjArray(a,"onSomeObjConnectedWrong","connection"));d>=c.connectionsNumber?(this.unbindAllObj(a),jQuery.lacerta.calculation.update_template(a,c.score_withDegression*b),$.lacerta.actions.searchEvInObjArray(a,"onAllObjConnectedRight",
"connection")):"true"==c.param.showOneBullet&&this.showNextBullet(a)},runAction:function(a,c,b){$.lacerta.actions.searchEvInObjArray(c,b,"connection")}};jQuery.lacerta.puzzle={puzzleObjL:{},puzzleIdL:[],programmers:[{name:"Sergey",surname:"Kondrashov"}],targetSelId:"",bulletSelId:"",purgePuzzle:function(){this.puzzleObjL={};this.puzzleIdL=[];this.bulletSelId=this.targetSelId=""},composePuzzle:function(a){var c=a.dom,b=a.keyId,d=jQuery.lacerta.design.putGroupeToHTML(a,"pazzle"),b={visible:"",randomCanv:!1,puzzleId:d,keyId:b,paramList:["rowsNum","columnsNum","shuffled","width","height"],param:{},canvasObjL:{},canvasIdL:[],loadedImageNum:0,cabvasRandIdL:[],
canvasNum:0,canvasCompleteNum:0,complete:!1,currentCanvN:0};b.visible=$(c).attr("visible")||"false";this.puzzleObjL[d]=b;var e=$(c).children("scoring"),e=$(e).attr("weight")||$(e).attr("weigth"),e=parseFloat(e)||1;jQuery.lacerta.calculation.enrol_template(d,a.templateName,e);this.parseObjTree(d,c,d);(b.visible="true")&&this.waitLoadingAndShowCanvas(d)},waitLoadingAndShowCanvas:function(a){var c=this;this.puzzleObjL[a].loadedImageNum<this.puzzleObjL[a].canvasIdL.length?setTimeout(function(){c.waitLoadingAndShowCanvas(a)},
200):this.showPuzzleCanvas(a)},parseObjTree:function(a,c,b){var d=this,e=this.puzzleObjL[a],f=$(c).children();$.each(f,function(c,k){var h=f[c].nodeName,m=f[c];if("param"!=h&&"actions"!=h)var l={dom:m,parentId:b,sectionType:h,keyId:e.keyId,templateName:void 0};switch(h){case "param":if("puzzle"==$(m).parent().get(0).tagName)for(h=e.paramList,l=0;l<h.length;l++){var n=h[l],p=$(m).attr(n);e.param[n]=""!=p&&void 0!=p?p:""}break;case "canvas":d.parseCanvasTree(a,m,l);break;case "zone":jQuery.lacerta.design.putZoneToHTML(l);
break;case "text":jQuery.lacerta.design.putTextToHTML(l);break;case "image":jQuery.lacerta.design.putImageToHTML(l);break;case "group":jQuery.lacerta.design.putGroupeToHTML(l)}})},parseCanvasTree:function(a,c,b){var d=this,e=this.puzzleObjL[a];if("canvas"!=c.nodeName)return!1;var f=e.canvasIdL.length,f=$(c).attr("id")||"_canv_"+f,g={puzzleId:a,objId:f,objVisible:f=$(c).attr("visible")||"false",rowsNum:1,columnsNum:1,blockSizeH:0,blockSizeBigH:0,blockSizeV:0,blockSizeBigV:0,shuffled:"",width:1,height:1,
canvasId:"",canv:"",ctx:"",img:new Image,imgSrc:"",imgLoaded:!1,complete:!1,piecesArray:[],correctOrder:[],selected1:void 0,selected2:void 0};c=$(c).children("param");g.rowsNum=$(c).attr("rowsNum")||e.paramList.rowsNum;g.rowsNum=1*g.rowsNum||3;g.columnsNum=$(c).attr("columnsNum")||e.paramList.columnsNum;g.columnsNum=1*g.columnsNum||4;g.shuffled=$(c).attr("shuffled")||e.paramList.shuffled;g.width=$(c).attr("width")||e.paramList.width;b.pWidth=g.width;g.width=parseInt(g.width);g.blockSizeBigH=Math.round(g.width/
g.columnsNum);g.width=Math.round(g.width*gScaleValue);g.blockSizeH=Math.round(g.width/g.columnsNum);g.height=$(c).attr("height")||e.paramList.height;b.pHeidht=g.height;g.height=parseInt(g.height);g.blockSizeBigV=Math.round(g.height/g.rowsNum);g.height=Math.round(g.height*gScaleValue);g.blockSizeV=Math.round(g.height/g.rowsNum);g.img.onload=function(){d.puzzleObjL[a].loadedImageNum++};c=$(c).attr("src")||"";""!=c?g.img.src=c:alert("No src for image");g.newRes=b;b.templateName="puzzle";g.canvasId=jQuery.lacerta.design.putCanvasToHTML(b);
g.canv=document.getElementById(g.canvasId);g.ctx=g.canv.getContext("2d");e.canvasIdL.push(g.canvasId);e.canvasObjL[g.canvasId]=g;$("#"+g.canvasId).bind("click",function(a){d.onCanvasClick(a,g)})},showPuzzleCanvas:function(a){var c=this.puzzleObjL[a].canvasIdL;a=this.puzzleObjL[a].canvasObjL;for(var b=0;b<c.length;b++){var d=a[c[b]];if("true"==d.objVisible){for(var e,f=0;f<d.columnsNum;f++)for(var g=0;g<d.rowsNum;g++)e=new this.rectangle(f*d.blockSizeBigH,g*d.blockSizeBigV,f*d.blockSizeBigH+d.blockSizeBigH,
g*d.blockSizeBigV+d.blockSizeBigV),d.piecesArray.push(e),d.correctOrder.push(e);jQuery.lacerta.utils.scrambleArray(d.piecesArray);this.drawImage(d);$("#"+d.canvasId).css("display","block");d.imgLoaded=!0}}},drawImage:function(a){for(var c=0;c<a.columnsNum;c++)for(var b=0;b<a.rowsNum;b++){var d=a.piecesArray[c*a.rowsNum+b];a.ctx.drawImage(a.img,d.left,d.top,d.width,d.height,c*a.blockSizeH,b*a.blockSizeV,a.blockSizeH,a.blockSizeV)}},rectangle:function(a,c,b,d){this.left=a;this.top=c;this.right=b;this.bottom=
d;this.width=b-a;this.height=d-c},onCanvasClick:function(a,c){var b=c.canv.getBoundingClientRect(),d=a.offsetX,e=a.offsetY;if(void 0==d||void 0==e)d=a.clientX-b.left,e=a.clientY-b.top;var b=Math.floor(d/c.blockSizeH),e=Math.floor(e/c.blockSizeV),d=c.piecesArray[b*c.rowsNum+e],f=!0,b=b*c.blockSizeH,e=e*c.blockSizeV;c.ctx.clearRect(0,0,c.width,c.height);void 0!=c.selected1&&void 0!=c.selected2&&(c.selected1=void 0,c.selected2=void 0);void 0==c.selected1?c.selected1=d:(c.selected2=d,this.swapRects(c),
f=!1);this.drawImage(c);f&&this.highlightRect(c,b,e)},swapRects:function(a){var c,b,d=a.selected1;c=a.piecesArray.indexOf(a.selected1);b=a.piecesArray.indexOf(a.selected2);a.piecesArray[c]=a.selected2;a.piecesArray[b]=d;this.checkCanvasCompleteness(a)},highlightRect:function(a,c,b){a.ctx.beginPath();a.ctx.moveTo(c,b);a.ctx.lineTo(c+a.blockSizeH,b);a.ctx.lineTo(c+a.blockSizeH,b+a.blockSizeV);a.ctx.lineTo(c,b+a.blockSizeV);a.ctx.lineTo(c,b);a.ctx.lineWidth=2;a.ctx.strokeStyle="#ff0000";a.ctx.stroke()},
checkCanvasCompleteness:function(a){for(var c=!0,b=0;b<a.piecesArray.length;b++)a.piecesArray[b]!=a.correctOrder[b]&&(c=!1);c&&(a.complete=!0,$.lacerta.actions.searchEvInObjArray(a.canvasId,"onComplete","canvas"),this.unbindCanvasObj(a.canvasId),this.checkPuzzleCompleteness(a.puzzleId))},checkPuzzleCompleteness:function(a){this.puzzleObjL[a].canvasCompleteNum++;var c=this.puzzleObjL[a].canvasCompleteNum,b=this.puzzleObjL[a].canvasIdL.length;c>=b?($.lacerta.actions.searchEvInObjArray(a,"onComplete",
"puzzle"),this.puzzleObjL[a].complete=!0,jQuery.lacerta.calculation.update_template(a,1)):jQuery.lacerta.calculation.update_template(a,c/b)},shufflePuzzle:function(a){var c=this.puzzleObjL[a];a=this.puzzleObjL[a].canvasIdL;"true"!=c.randomCanv&&$("#"+a[c.currentCanvN]).trigger("showObject")},hidePuzzleCanv:function(a){$("#"+this.puzzleObjL[a].canvasIdL[this.puzzleObjL[a].currentCanvN]).trigger("hideObject")},showNextBullet:function(a){a=this.puzzleObjL[a];"true"==a.param.randomOneBullet?$("#"+a.randomBulletId[a.shiftIdNum]).trigger("showObject"):
$("#"+a.allBulletId[a.shiftIdNum]).trigger("showObject");a.shiftIdNum++},unbindCanvasObj:function(a){$("#"+a).unbind("click")},unbindAllObj:function(a){a=this.puzzleObjL[a];for(var c=a.allTargetId.length,b=0;b<c;b++)this.unbindObj(a.allTargetId[b])},runAction:function(a,c,b){$.lacerta.actions.searchEvInObjArray(c,b,"puzzle")}};jQuery.lacerta.fillword={testId:"testId",$currentId:void 0,fillwordId:void 0,fillwordsObjL:{},fillwordsDivIdL:[],fillwordNum:0,programmers:[{name:"Sergey",surname:"Kondrashov"},{name:"Faja",surname:"Magjanova"}],purgeFillword:function(){for(var a=0;a<this.fillwordsDivIdL;a++){var c=this.fillwordsDivIdL[a],b=this.fillwordsObjL[c].fillWord;b.removeEventListener("touchstart",function(a){this.findxy("start",a,c)},!1);b.removeEventListener("touchend",function(a){this.findxy("up1",a,c)},!1);b.removeEventListener("touchcancel",
function(a){this.findxy("up1",a,c)},!1);b.removeEventListener("touchmove",function(a){this.findxy("move",a,c)},!1);b.removeEventListener("mouseup",function(a){this.findxy("up",a,c)},!1)}this.fillwordsObjL={};this.fillwordNum=0},composeFillword:function(a){var c=a.dom;a.templateId="fillword";var b=jQuery.lacerta.design.putGroupeToHTML(a,"fillword"),d=b+"_fword",e=b+"_sketch";a.parentId=b;a.fillwordId=d;a.sketchId=e;jQuery.lacerta.design.putFillwordToHTML(a);var f=document.getElementById(d),g=f.getContext("2d"),
k=document.getElementById(e),h=k.getContext("2d"),m=$(c).children("param"),l=$(m).attr("width")||"480",l=l*gScaleValue,n=$(m).attr("height")||"480",n=n*gScaleValue,m=$(c).children("settings"),m=$(m).children("general"),p=$(m).attr("wordN")||"1",p=1*p,r=$(m).attr("cellN")||"8",r=1*r,s=$(m).attr("cellSize")||"auto";if(6==r)var s=80*gScaleValue,q=22*gScaleValue,t=20*gScaleValue,w=36*gScaleValue;8==r&&(s=60*gScaleValue,q=14*gScaleValue,t=14*gScaleValue,w=32*gScaleValue);var u=[],y=[],x=$(c).children("rows"),
A=$(x).children();$.each(A,function(a,b){var c=A[a];"row"==c.nodeName&&(c=$(c).attr("string")||"ERROR","ERROR"==c&&alert("Проверьте паравильность заполнения параметра row"),y.push(c))});for(var v=0;v<r;v++)for(var z=0;z<r;z++)"*"==y[v].charAt(z)?u.push(""):u.push(y[v].charAt(z));for(v=x=0;v<u.length;v++)""!=u[v]&&x++;var B=[[0]],E=[],v=$(c).children("words"),A=$(v).children(),C=[];$.each(A,function(a,b){var c=A[a];if("word"==c.nodeName){var d=$(c).attr("array")||"ERROR";"ERROR"==d&&alert("Проверьте паравильность заполнения параметра array");
d=d.split(",").map(Number);B.push(d);d=$(c).attr("strokeStyle")||"#85a8e3";E.push(d);var c=$(c).children("actions"),e=$(c).children(),f=[];$.each(e,function(a,b){var c=e[a];"action"==c.nodeName&&"onWordComplete"==$(c).attr("event")&&(c=$(c).text(),c=jQuery.lacerta.utils.replaceString(c,"\r",""),c=jQuery.lacerta.utils.replaceString(c,"\t",""),c=jQuery.lacerta.utils.replaceString(c,"\n",""),c=c.split(";"),f=f.concat(c))});C.push(f)}});var D=[[0]],v=$(c).children("areas"),A=$(v).children(),J=[];$.each(A,
function(a,b){var c=A[a];if("area"==c.nodeName){var d=$(c).attr("array")||"ERROR";"ERROR"==d&&alert("Проверьте паравильность заполнения параметра array");d=d.split(",").map(Number);D.push(d);var c=$(c).children("actions"),e=$(c).children(),f=[];$.each(e,function(a,b){var c=e[a];"action"==c.nodeName&&"onPress"==$(c).attr("event")&&(c=$(c).text(),c=jQuery.lacerta.utils.replaceString(c,"\r",""),c=jQuery.lacerta.utils.replaceString(c,"\t",""),c=jQuery.lacerta.utils.replaceString(c,"\n",""),c=c.split(";"),
f=f.concat(c))});J.push(f)}});for(var G=[],v=0;v<r*r;v++)G.push(0);for(v=0;v<B.length;v++)for(z=0;z<B[v].length;z++)G[B[v][z]]=v;for(var K=[0],z=1;z<=p;z++){for(var F=0,v=0;v<G.length;v++)G[v]==z&&(F+=1);K.push(F)}F=[];for(v=0;v<r*r;v++)F.push(0);for(v=1;v<D.length;v++)for(z=0;z<D[v].length;z++)F[D[v][z]]=v;e={fillWord:f,sketch:k,width:l,height:n,parentDivId:b,fillwordId:d,sketchId:e,ctx:g,ctx_e:h,cellN:r,cellSize:s,delta_x:q,delta_y:t,beg_square:w,strokeStyle:$(m).attr("strokeStyle")||"#0db839",
lineWidth:($(m).attr("lineWidth")||6)*gScaleValue,bgcolor:$(m).attr("bgcolor")||"",frontimage:$(m).attr("frontimage")||void 0,wordN:p,nomberWord:0,arr_RightW:B,strokeStyleArr:E,cellData:u,allLetters:x,allData:G,arr_wordN:K,ArrowData:F,eachData:[],wordsActionsList:C,areasActionsList:J};f=$(m).attr("font-style")||"normal";g=$(m).attr("font-variant")||"normal";h=$(m).attr("font-weight")||"normal";l=$(m).attr("font-size")||"24";l*=gScaleValue;q=$(m).attr("font-family")||"sans-serif";e.ctx.font=f+"  "+
g+" "+h+" "+l+"px "+q;e.ctx.fillStyle=$(m).attr("textColor")||"#60016d";e.ctx.textBaseline="middle";this.fillwordsObjL[b]=e;this.fillwordsDivIdL.push(b);c=$(c).children("scoring");c=$(c).attr("weight")||$(c).attr("weigth");c=parseFloat(c)||1;jQuery.lacerta.calculation.enrol_template(d,a.templateName,c);this.drawFillword(b);var H=this;k.addEventListener("touchstart",function(a){I("start",a,b,H)},!1);k.addEventListener("touchend",function(a){I("up1",a,b,H)},!1);k.addEventListener("touchcancel",function(a){I("up1",
a,b,H)},!1);k.addEventListener("touchmove",function(a){I("move",a,b,H)},!1);k.addEventListener("mouseup",function(a){I("up",a,b,H)},!1);var I=function(a,b,c,d){var e=d.fillwordsObjL[c].cellSize;b||(b=event);b.preventDefault();var f=document.getElementById("scene"),g=document.getElementById("currentStep"),h=document.getElementById(c);"up1"==a&&(k=Math.floor((b.targetTouches[0].pageX-f.offsetLeft-h.offsetLeft-g.offsetLeft)/e),l=Math.floor((b.targetTouches[0].pageY-f.offsetTop-h.offsetTop-g.offsetTop)/
e),d.draw_line(k,l,c));if("up"==a){if(!0==isTouchScreen)var k=Math.floor((b.pageX-f.offsetLeft-h.offsetLeft-g.offsetLeft)/e),l=Math.floor((b.pageY-f.offsetTop-h.offsetTop-g.offsetTop)/e);else k=Math.floor((b.pageX-g.offsetLeft-h.offsetLeft)/e),l=Math.floor((b.pageY-g.offsetTop-h.offsetTop)/e);d.draw_line(k,l,c)}"start"==a&&(k=Math.floor((b.targetTouches[0].pageX-f.offsetLeft-h.offsetLeft-g.offsetLeft)/e),l=Math.floor((b.targetTouches[0].pageY-f.offsetTop-h.offsetTop-g.offsetTop)/e),0<=k&&0<=l&&d.draw_line(k,
l,c));"move"==a&&(k=Math.floor((b.pageX-f.offsetLeft-h.offsetLeft-g.offsetLeft)/e),l=Math.floor((b.pageY-f.offsetTop-h.offsetTop-g.offsetTop)/e),d.draw_line(k,l,c))}},drawFillword:function(a){var c=this.fillwordsObjL[a],b=c.ctx;a=c.ArrowData;for(var d=c.cellSize,e=c.cellData,f=1*c.cellN,g=0,k=0,h=0,m=0;m<a.length;m++)0==a[m]&&(b.beginPath(),b.strokeRect(1*g,1*k,1*d,1*d),b.fillText(e[m],d/2-8*gScaleValue+g,k+d/2,d)),g+=1*d,h+=1,h==f&&(k+=1*d,g=h=0);if(void 0!=c.frontimage){var l=new Image;l.src=c.frontimage;
l.onload=function(){b.drawImage(l,0,0,c.width,c.height);b.moveTo(0,0);b.closePath()}}},draw_beg:function(a,c,b){b=this.fillwordsObjL[b];var d=b.ctx_e,e=1*b.cellSize,f=1*b.delta_x,g=1*b.delta_y,k=b.beg_square;tek_w=b.allData[1*b.cellN*c+a];d.beginPath();d.moveTo(0,0);d.strokeRect(a*e+f,c*e+g,k,k)},draw_line:function(a,c,b){var d=this.fillwordsObjL[b],e=d.ctx_e,f=d.allData,g=d.cellN,k=d.cellSize,h=d.delta_x,m=d.delta_y,l=d.beg_square,n=this.prov_1(c,a,b);if(0<n)for(var n=d.areasActionsList[1*n-1],p=
0;p<n.length;p++){var r=n[p],r=r.split(":");1<r.length&&$.lacerta.actions.prepareDispatchAction2("","onPress",r,1)}if(1==this.prov_0(c,a,b))this.clear_e(b);else{var s,q,t,n=0,p=[],p=[a,c];if(0==d.eachData.length)d.eachData.push(p),this.draw_beg(a,c,b);else if(tek_w=f[g*c+a],f=[],f=d.eachData.pop(),d.eachData.push(f),yyy=xxx=yy=xx=0,f[0]==p[0]&&(xx=1),f[1]==p[1]&&(yy=1),1!=xx||1!=yy)0==xx&&0==yy?(this.clear_e(b),d.eachData.push(p),this.draw_beg(a,c,b)):(1==xx&&(t=s=f[0]*k+k/2,p[1]==f[1]+1&&(yyy=1,
q=f[1]*k+l+m,n=p[1]*k+m),p[1]==f[1]-1&&(yyy=-1,q=f[1]*k+m,n=p[1]*k+l+m)),1==yy&&(n=q=f[1]*k+k/2,f[0]==p[0]+1&&(xxx=1,s=f[0]*k+h,t=p[0]*k+l+h),f[0]==p[0]-1&&(xxx=-1,s=f[0]*k+l+h,t=p[0]*k+h)),1==xx&&0==yyy?(this.clear_e(b),d.eachData.push(p),this.draw_beg(a,c,b)):1==yy&&0==xxx?(this.clear_e(b),d.eachData.push(p),this.draw_beg(a,c,b)):1!=this.prov_replay(p,b)&&(d.eachData.push(p),e.moveTo(s,q),e.lineTo(t,n),e.lineCap="round",e.stroke(),this.prov_eachData(b)))}},clear_e:function(a){a=this.fillwordsObjL[a];
a.ctx_e.clearRect(0,0,a.width,a.height);a.eachData=[]},prov_0:function(a,c,b){b=this.fillwordsObjL[b];var d=1;0==b.ArrowData[a*b.cellN+c]&&(d=0);return d},prov_1:function(a,c,b){var d=this.fillwordsObjL[b];b=d.ArrowData;var e=0;a=a*d.cellN+c;0<b[a]&&(e=b[a]);return e},prov_eachData:function(a){var c=this.fillwordsObjL[a],b=c.eachData,d=c.allData,e=c.cellN,f=c.arr_wordN,g=c.ArrowData;c.allLetters==b.length&&this.clear_e(a);var k=1,h=1,m=[],m=b[0],l;l=m[1]*e+m[0];for(var m=d[l],n=1;n<b.length;n++)l=
b[n],l=l[1]*e+l[0],m==d[l]?h+=1:h=100;h==f[m]&&0==this.truth_way(a)&&(k=0);if(0==k){this.truth_word(a);this.clear_e(a);b=c.wordsActionsList[1*m-1];for(e=0;e<b.length;e++)f=b[e],f=f.split(":"),1<f.length&&$.lacerta.actions.prepareDispatchAction2("","onWordComplete",f,1);for(n=0;n<g.length;n++)d[n]==m&&(g[n]=-1);c.nomberWord==c.wordN&&$.lacerta.actions.searchEvInObjArray(a,"onFillwordComplete","fillword")}return k},truth_way:function(a){a=this.fillwordsObjL[a];var c=a.eachData,b=a.cellN,d=a.allData,
e=a.arr_RightW;a=1;for(var f=[],g=0;g<c.length;g++)f.push(c[g][1]*b+c[g][0]);b=d[f[0]];c=[].concat(e[b]);e=[].concat(e[b]);e.reverse();f.join("|")==c.join("|")&&(a=0);f.join("|")==e.join("|")&&(a=0);return a},truth_word:function(a){a=this.fillwordsObjL[a];var c=a.ctx,b=a.strokeStyleArr,d=a.eachData,e=a.cellSize,f=a.beg_square,g=a.delta_y,k=a.delta_x,h=a.ctx_e;c.beginPath();c.lineWidth=10*gScaleValue;c.fillStyle=b[a.nomberWord];c.strokeStyle=b[a.nomberWord];var m,l,n,p,r,s=d.length-1;if(0<d.length){for(var q=
0;q<s;q++)m=b=0,d[q][0]==d[q+1][0]&&(b=1),d[q][1]==d[q+1][1]&&(m=1),1==b&&(p=l=d[q][0]*e+e/2,d[q+1][1]==d[q][1]+1&&(n=d[q][1]*e+f+g,r=d[q+1][1]*e+g),d[q+1][1]==d[q][1]-1&&(n=d[q][1]*e+g,r=d[q+1][1]*e+f+g)),1==m&&(r=n=d[q][1]*e+e/2,d[q][0]==d[q+1][0]+1&&(l=d[q][0]*e+k,p=d[q+1][0]*e+f+k),d[q][0]==d[q+1][0]-1&&(l=d[q][0]*e+f+k,p=d[q+1][0]*e+k)),c.moveTo(l,n),c.lineTo(p,r);c.lineCap="round";c.stroke();c.closePath();h.closePath();a.nomberWord+=1;l=a.nomberWord/a.wordN;1<l&&(l=1);jQuery.lacerta.calculation.update_template(a.fillwordId,
l)}},prov_replay:function(a,c){var b=this.fillwordsObjL[c].eachData,d=0;if(0<b.length)for(var e=0;e<b.length;e++)b[e][0]==a[0]&&b[e][1]==a[1]&&(d=1);return d},runAction:function(a,c,b){$.lacerta.actions.searchEvInObjArray(c,b,"sfillword")},setCurrentDirecton:function(a,c){this.fillwordsObjL[a].currentDirecton=c},getCurrentDirecton:function(a){return this.fillwordsObjL[a].currentDirecton},getPrevLetterIdIfReadOnly:function(a,c,b){a=this.fillwordsObjL[a].wordsObj[c].lettersObj[b-1];return a.readOnly?
a.inputId:!1},isValidChar:function(a){return"A"<=a&&"Я">=a||" "==a}};jQuery.lacerta.account={$currentId:void 0,accountId:void 0,accountObjL:[],steps_count:0,$commonTab1:void 0,$commonTab2:void 0,$div:void 0,res_in_currentStep:!1,startTimeStamp:jQuery.lacerta.timer.startTimer(),purgeAccount:function(){this.res_in_currentStep&&$("#resultViewer").hide()},composeAccount:function(a){this.accountId=a.keyId+$id;var c=new this.createAccount(a,this,this.accountId);c.initializeAccount();this.accountObjL[this.accountId]={id:this.accountId,resData:a,obj:c}},createAccount:function(a,
c,b){var d=this;d.parent=c;d.keyId=a.keyId;d.dom=a.dom;d.accountId=jQuery.lacerta.design.putGroupeToHTML(a,"account");d.accountId!=b&&log("!!! ERROR: Teg <div> with id == "+d.accountId+" has not been created!!!");$("#"+d.accountId).bind("resetObject",function(a,b){$("#"+d.accountId).children().remove();d.initializeAccount()});d.initializeAccount=function(){var a=$(d.dom).children();$.each(a,function(b,c){var k=a[b].nodeName;if("param"!=k|"actions"!=k)var h={dom:a[b],parentId:d.accountId,sectionType:k,
keyId:d.keyId,templateName:void 0};var m=a[b];switch(k){case "text":jQuery.lacerta.design.putTextToHTML(h);break;case "image":jQuery.lacerta.design.putImageToHTML(h);break;case "groupe":jQuery.lacerta.design.putGroupeToHTML(h);break;case "item":var k=$(m).attr("mask"),m=jQuery.lacerta.calculation.getData(k),l=jQuery.lacerta.design.putTextToHTML(h,m);if("%Duration%"==k){var n;n=setInterval(function(){if($("#"+l).hasClass("item_res")){var a=jQuery.lacerta.calculation.getData("%Duration%");$("#"+l).text(a)}else clearInterval(n)},
1E3)}break;case "button":jQuery.lacerta.design.putButtonToHTML(h)}})};return this},createResultAccount:function(){if(void 0!=this.$div)return this.$div;var a=$("<div/>");a.attr({id:"resultViewer"});a.css({display:"none"});var c=jQuery.lacerta.getAllStepCount(),b=void 0;"true"==jQuery.lacerta.calculation.get_showResultTab()&&void 0==this.$commonTab1&&(b=this.$commonTab1=this.createCommonRTable());1<c&&void 0==this.$commonTab2&&(this.$commonTab2=this.createObjRTable(c));var d=this.$commonTab2,e=$("<p/>");
e.attr({id:"top_block"});e.appendTo(a);void 0!=b&&b.appendTo(a);b=$("<p/>");b.attr({id:"midle_block"});b.appendTo(a);1<c&&!1!=d&&d.appendTo(a);c=$("<p/>");c.attr({id:"bottom_block"});c.appendTo(a);return this.$div=a},appendDivToCurrentStep:function(){!1==this.res_in_currentStep&&(this.createResultAccount().appendTo("#scene"),this.res_in_currentStep=!0)},sowResultAccount:function(){!1==this.res_in_currentStep&&this.appendDivToCurrentStep();this.updateResult();$("#resultViewer").show()},hideResultAccount:function(){this.res_in_currentStep&&
$("#resultViewer").hide()},createCommonRTable:function(){var a;a=$("<table/>");a.attr({id:"commonResultTable"});var c=$("<tr></tr>");c.append("<th width =25%>Статус завершения</th>");c.append("<th width =25%>Статус успешности</th>");c.append("<th width =25%>Время</th>");c.append("<th width =25%>Балл</th>");var b=$("<thead/>");b.append(c);c=$("<tr></tr>");c.append("<td id='result_completion_status'>Не завершенo</th>");c.append("<td id='result_success_status'>Не усвоенo</th>");c.append("<td id='result_time'></th>");
c.append("<td id='result_ball'>score_raw</th>");var d=$("<tbody/>");d.append(c);a.append(b);a.append(d);return a},createObjRTable:function(a){this.steps_count=a;var c;c=$("<table/>");c.attr({id:"objResultTable"});var b=$("<tr></tr>");b.append("<th width =41%>Описание</th>");b.append("<th width =16%>Статус завершения</th>");b.append("<th width =16%>Статус успешности</th>");b.append("<th width =16%>Время</th>");b.append("<th width =11%>Балл</th>");var d=$("<thead/>");d.append(b);for(var b=$("<tbody/>"),
e=!1,f=0;f<a;f++){var g=jQuery.lacerta.calculation.get_obj_short_name(f);if(void 0!=g&&""!=g){var e=!0,k=$("<tr></tr>");k.append("<td id='result_short_name_"+f+"'>"+g+"</td>");k.append("<td id='result_completion_status_"+f+"'>Не завершено</td>");k.append("<td id='result_success_status_"+f+"'>Не усвоено</td>");k.append("<td id='result_time_"+f+"'>0</td>");k.append("<td id='result_ball_"+f+"'>0</td>");b.append(k)}}return!0==e?(c.append(d),c.append(b),c):!1},updateResult:function(){var a=this.steps_count;
if(1<a)for(var c=0;c<a;c++)$("#result_completion_status_"+c).text(jQuery.lacerta.calculation.get_obj_completion_status(c)),$("#result_success_status_"+c).text(jQuery.lacerta.calculation.get_obj_success_status(c)),$("#result_time_"+c).text(jQuery.lacerta.calculation.get_obj_result_time(c)),$("#result_ball_"+c).text(jQuery.lacerta.calculation.get_obj_result_ball(c));else jQuery.lacerta.calculation.get_obj_result_time(0);"true"==jQuery.lacerta.calculation.get_showResultTab()&&($("#result_completion_status").text(jQuery.lacerta.calculation.get_completion_status()),
$("#result_success_status").text(jQuery.lacerta.calculation.get_success_status()),$("#result_time").text(jQuery.lacerta.timer.translateSecondsToString((new Date).getTime()-this.startTimeStamp)),$("#result_ball").text(jQuery.lacerta.calculation.get_result_ball()))}};
